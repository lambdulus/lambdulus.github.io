{"version":3,"sources":["misc/index.ts","AppTypes.ts","components/MenuBar.tsx","components/MacroSpace.tsx","components/Settings.tsx","components/Editor.tsx","components/TreeComparator.ts","components/EmptyExpression.tsx","components/ReactPrinter.tsx","components/ReductionMessage.tsx","components/DataInjector.tsx","components/Step.tsx","components/MethodInjector.tsx","components/InactiveExpression.tsx","components/Controls.tsx","components/Expression.tsx","components/ExpressionBox.tsx","components/MacroDefinition.tsx","components/Note.tsx","components/Box.tsx","components/CreateBox.tsx","components/BoxSpace.tsx","components/EvaluatorSpace.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["getSavedMacros","JSON","parse","window","localStorage","getItem","trimStr","str","trim","EvaluationStrategy","Screen","PromptPlaceholder","HANDY_MACROS","updateMacros","macroTable","setItem","stringify","reportEvent","category","action","label","ga","getAll","send","exception","console","log","error","BoxType","DEFAULT_STATE","Object","objectSpread","submittedBoxes","screen","main","activeBoxIndex","MenuBar","props","state","onImport","onScreenChange","dehydrated","map","dehydrateBox","dehydrate","link","content","data","Blob","type","URL","createObjectURL","createURL","react_default","a","createElement","id","className","onClick","macrolist","href","download","setTimeout","revokeObjectURL","accept","onChange","e","event","files","target","file","reader","FileReader","onload","result","box","EXPRESSION","_ref","singleLetterNames","ast","expression","config","singleLetterVars","tokens","tokenize","lambdaLetters","parseExpression","history","lastReduction","None","step","message","isNormalForm","hydrateBox","hydrate","readAsText","onFiles","htmlFor","isRunning","breakpoints","timeoutID","undefined","MacroSpace","removeMacro","entries","builtinMacros","_ref2","slicedToArray","macroName","macroExpression","key","_ref3","_ref4","require","Switch","Radio","Settings","checked","getActiveSingleLetterNames","disabled","shape","changeActiveSingleLetterNames","name","style","getActiveStrategy","ABSTRACTION","changeActiveStrategy","ActionType","TreeComparator","roots","classCallCheck","this","translator","Map","equals","context","_roots","_roots2","toArray","slice","compare","createClass","value","_this$context","left","right","Lambda","backup","set","argument","Application","Macro","ChurchNumeral","Variable","get","Editor","placeholder","caretPosition","syntaxError","isMarkDown","onContent","onEnter","onExecute","lines","split","length","concat","InputField","selectionEnd","replace","onKeyDown","shiftKey","ctrlKey","preventDefault","wrap","autoComplete","autoCorrect","autoCapitalize","spellCheck","rows","Math","max","ref","element","selectionStart","focus","EmptyExpression","_this","_this$props","isActive","editor","MakeActiveContext","Consumer","makeActive","onDoubleClick","Editor_Editor","PureComponent","ReactPrinter","tree","reduction","possibleConstructorReturn","getPrototypeOf","call","rendered","visit","assertThisInitialized","lambda","accumulator","_this2","body","isBreakpoint","Alpha","Array","from","conversions","some","conversion","identifier","args","Symbol","Beta","broken","Set","printMultiLambda","node","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","iterator","next","done","err","return","application","leftClassName","rightClassName","redex","_this3","acc","churchNumber","_this4","Expansion","Gama","find","arg","macro","_this5","redexClass","redexes","variable","ASTVisitor","ReductionMessage","Eta","StateContext","createContext","SLIContext","StrategyContext","NORMAL","DataInjector","SLI","strategy","children","Provider","StepMemo","memo","stepRecord","addBreakpoint","strategyToEvaluator","nextReduction","printer","print","lastStep","StepWrapper","assign","AddBoxContext","boxState","AddEmptyBoxContext","ChangeActiveBoxContext","SetBoxStateContext","index","DefineMacroContext","definition","MethodInjector","addBox","addEmptyBox","changeActiveBox","setBoxState","defineMacro","InactiveExpression","createBoxFrom","Controls","isExercise","makeExercise","endExercise","Controls_Switch","Expression","Controls_Controls","VALIDATE_MODE","EVAL_MODE","to","sequence","fn","i","mapLeftFromTo","toString","breakpoint","_this$props2","toConsumableArray","NormalEvaluator","APPLICATIVE","ApplicativeEvaluator","OPTIMISATION","OptimizeEvaluator","NormalAbstractionEvaluator","ExpressionBox","bind","onSubmitExpression","onExerciseStep","onStep","onRun","onStop","shouldBreak","EmptyExpression_EmptyExpression","Expression_Expression","InactiveExpression_InactiveExpression","__key","Date","now","clone","timeout","_this$props$state","_this$props3","_this$props4","userAst","normal","perform","_this$props5","_this$props6","push","_this$props7","pop","add","clearTimeout","_this$props8","has","MacroDefinition","_state$editor","useContext","_content$split$map","_content$split$map2","Error","root","isValidName","isValidExpression","ReactMarkdown","Note","_props$state","note","_props$state$editor","isEditing","SetBoxContext","onSubmitNote","source","Box","MacroTableContext","ExpressionBox_ExpressionBox","MACRO","NOTE","CreateBox","INIT","createEmptyExp","createEmptyMacro","BoxSpace","EvaluatorSpace","App","createBoxFromURL","addEventListener","_this$state","MenuBar_MenuBar","setState","hash","decodeURI","location","substring","indexOf","expPrefix","pushState","encodeURI","_this$state2","activeBoxState","_this$state3","_this$state4","enabled","_this$state5","newMacroTable","defineProperty","Component","Boolean","hostname","match","ReactDOM","render","App_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.215698b1.chunk.js","sourcesContent":["import { MacroMap } from \"@lambdulus/core\"\n\n\nexport function debounce (fn : Function, treshold : number)\n : [ (...args : Array<any>) => void, () => void ] {\n  let timer : number\n  \n  return [\n    function debounced (...args : Array<any>) : void {\n      window.clearTimeout(timer)\n\n      timer = window.setTimeout(() => {\n        fn(...args)\n      }, treshold)\n    },\n    function cancel () : void {\n      window.clearTimeout(timer)\n    }\n  ]\n}\n\nexport function getSavedMacros () : MacroMap {\n  return JSON.parse(window.localStorage.getItem('macrotable') || '{}')\n}\n\nexport function trimStr (str : string) : string {\n  return str.trim()\n}\n\nexport function mapLeftFromTo(\n  from : number,\n  to : number,\n  sequence : Array<any>,\n  fn : (...args : Array<any>) => any) {\n    const result : Array<any> = new Array(to - from + 1)\n\n    for (let e = 0, i = from; i <= to; ++i) {\n      result[e++] = fn(sequence[i], i)\n    }\n\n    return result\n  }\n\nexport const HANDY_MACROS : MacroMap = {\n  // FACT : '(Y (λ f n . (<= n 1) 1 (* n (f (- n 1)))))',\n  // FACCT : '(λ n . (Y (λ f n a . IF (= n 1) a (f (- n 1) (* n a)))) (- n 1) (n))',\n  // FIB : '(Y (λ f n . (= n 0) 0 ((= n 1) 1 ( + (f (- n 1)) (f (- n 2))))))',\n  // // SHORTLIST : 'CON 3 (CONS 5 (CONS 1 NIL))',\n  // // LONGLIST :  '(CONS 3 (CONS 5 (CONS 1 (CONS 10 (CONS 7 (CONS 2 (CONS 4 (CONS 9 (CONS 4 (CONS 6 (CONS 8 NIL)))))))))))',\n  // APPEND : 'Y (λ fn listA listB . IF (NULL listA) (listB) (CONS (FIRST listA) (fn (SECOND listA) listB)))',\n  // LISTGREQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (>= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  // LISTLESS : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (< (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  // LISTGR : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (> (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  // LISTEQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  // QUICKSORT : 'Y (λ fn list . IF (NULL list) (NIL) ( IF (NULL (SECOND list)) (list) ( APPEND (fn (LISTLESS (FIRST list) list)) ( APPEND (LISTEQ (FIRST list) list) (fn (LISTGR (FIRST list) list)) ) ) ) )',\n  // INFLIST : '(λ n . (Y (λ x . (λ f s g . g f s) n x)))',\n  // REMOVENTH : 'Y (λ fn list n . IF (= n 0) (SECOND list) (IF (NULL list) NIL (CONS (FIRST list) (fn (SECOND list) (- n 1) ) ) ) )',\n  // NTH : 'Y (λ fn list n . IF (= n 0) (FIRST list) (IF (NULL (list)) NIL (fn (SECOND list) (- n 1)) ) )',\n  // LEN : 'Y (λ fn list . IF (NULL list) (0) (+ 1 (fn (SECOND list) )) )',\n  // GETNTH : '(λ end . (Y (λ f n i . (end i) (i) ( (= n 0) (Y (λ f a . (end a) (i) (f) ) ) (f (- n 1)) ) )) )',\n  // MAP : '(λ fn l . (Y (λ f it . IF (NULL it) (NIL) (CONS (fn (FIRST it)) (f (SECOND it))) )) l )',\n  // REDUCE : '(λ fn l init . Y (λ f it acc . IF (NULL it) (acc) (f (SECOND it) (fn (FIRST it) acc)) ) l init )',\n  // APPLY : '(λ f args . Y (λ ff f l . (NULL l) (f) (ff (f (FIRST l)) (SECOND l)) ) f args )',\n  // RANGE : '(λ m n . Y (λ f e . (= e n) (CONS e NIL) (CONS e (f (+ e 1))) ) m )',\n  // LISTCOMPR : '(λ args . APPLY (λ op in rng cond . Y (λ f l . (NULL l) (NIL) ( (cond (FIRST l)) (CONS (op (FIRST l)) (f (SECOND l))) (CONS (FIRST l) (f (SECOND l))) ) ) rng ) args )',\n  // MOD : '(λ n m . (n (λ n . (= n (- m 1)) (0) (+ n 1)) (0)) )',\n  // INFIX : 'APPLY (λ l op r . op l r)',\n}\n\nexport function updateMacros (macroTable : MacroMap) : void {\n  window.localStorage.setItem('macrotable', JSON.stringify(macroTable))\n}\n\nexport function reportEvent (category : string, action : string, label : string) : void {\n  try {\n    const tracker = (window as any).ga.getAll()[0]\n    \n    tracker.send('event', category, action, label )\n  }\n  catch (exception) {\n    console.log(\"\")\n    console.log('PLEASE DISABLE YOUR ADBLOCKER OR ALLOW GOOGLE ANALYTICS FOR THIS SITE')\n    console.log(\"\")\n    console.error(exception)\n  }\n}","import { MacroMap, AST, ASTReduction, NormalEvaluator, ApplicativeEvaluator, OptimizeEvaluator } from \"@lambdulus/core\"\n\nimport { HANDY_MACROS, getSavedMacros } from \"./misc\"\n\n\n//////////////////////////////////\n\nexport enum EvaluationStrategy {\n  NORMAL = 'Normal Evaluation',\n  APPLICATIVE = 'Applicative Evaluation',\n  OPTIMISATION = 'Optimisation - η Conversion',\n  ABSTRACTION = 'Abstraction / Simplified Evaluation'\n}\n\nexport enum Screen {\n  main,\n  macrolist,\n  // notebooks,\n}\n\nexport enum PromptPlaceholder {\n  INIT = 'Type λ expression and hit enter',\n  EVAL_MODE = 'Hit enter for next step',\n  VALIDATE_MODE = 'Write next step and hit enter for validation',\n  MACRO = 'Define Macro like: `NAME := [λ expression]` and hit enter',\n  NOTE = 'Type note and hit shift enter'\n}\n\nexport interface AppState {  \n  macroTable : MacroMap\n  submittedBoxes : Array<BoxState>\n  screen : Screen\n  activeBoxIndex : number\n}\n\nexport const DEFAULT_STATE : AppState = {\n  macroTable : { ...HANDY_MACROS, ...getSavedMacros() },\n  submittedBoxes : [],\n  screen : Screen.main,\n  activeBoxIndex : -1,\n}\n\n//////////////////////////////////\n\nexport type Evaluator = NormalEvaluator | ApplicativeEvaluator | OptimizeEvaluator\n\nexport type Breakpoint = {\n  type : ASTReduction,\n  context : AST,\n  broken : Set<AST>,\n}\n\nexport interface StepRecord {\n  ast : AST\n  lastReduction : ASTReduction | null\n  step : number\n  message : string\n  isNormalForm : boolean\n}\n\nexport interface EvaluationState {\n  __key : string\n  type : BoxType\n  expression : string\n  ast : AST | null\n  history : Array<StepRecord>\n  isRunning : boolean\n  breakpoints : Array<Breakpoint>\n  timeoutID : number | undefined\n  timeout : number\n  isExercise : boolean\n  strategy : EvaluationStrategy\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\n//////////////////////////////////\n\nexport enum BoxType {\n  EXPRESSION,\n  MACRO,\n  NOTE\n}\n\nexport type BoxState = EvaluationState | MacroDefinitionState | NoteState\n\n//////////////////////////////////\n\nexport interface MacroDefinitionState {\n  __key : string\n  type : BoxType\n  macroName : string\n  macroExpression : string\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\n//////////////////////////////////\n\nexport interface NoteState {\n  __key : string\n  type : BoxType\n  note : string\n  isEditing : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\n//////////////////////////////////","// TODOs\n// hydratace a dehydratace kompletniho statu\n//\n//\n\nimport React, { ChangeEvent } from 'react'\nimport { AST, tokenize, parse, Token, MacroMap, None } from '@lambdulus/core'\n\nimport { AppState, Screen, BoxState, BoxType, EvaluationState } from '../AppTypes'\n\nimport '../styles/MenuBar.css'\n\ninterface MenuBarProperties {\n  state : AppState\n  onImport (state : AppState) : void\n  onScreenChange (screen : Screen) : void\n}\n\nexport default function MenuBar (props : MenuBarProperties) : JSX.Element {\n  const { state, onImport, onScreenChange } : MenuBarProperties = props\n  const { screen } = state\n\n  const dehydrated : object = dehydrate(state)\n\n  const serialized : string = JSON.stringify(dehydrated)\n  const link : string = createURL(serialized)\n\n  return (\n    <div id=\"topbar\">\n      {/* <div>\n        <i id='notebooks' className=\"icon fas fa-book-open fa-2x\" />\n        <p className='iconLabel'>Notebooks</p>\n      </div> */}\n\n      <div>\n        {\n          screen === Screen.main ?\n            <i className=\"icon fas fa-list-ul fa-2x\" onClick={ () => onScreenChange(Screen.macrolist) } />\n            :\n            <i className=\"icon far fa-window-close fa-2x\" onClick={ () => onScreenChange(Screen.main) } />\n        }\n        <p className='iconLabel'>Macros</p>\n      </div>        \n        \n      <div>\n        <a\n          className='export'\n          href={ link }\n          download=\"notebook_lambdulus.json\"\n          onClick={ () => setTimeout(() => window.URL.revokeObjectURL(link), 10) }\n        >\n          <i id='download' className=\"icon fas fa-cloud-download-alt fa-2x\" />\n        </a>\n        <p className='iconLabel'>Export</p>\n      </div>\n      \n      <div>\n        <input type=\"file\" accept=\"application/json\" id=\"input\" onChange={ (e) => onFiles(e, onImport) } />\n        <label htmlFor=\"input\"><i className=\"icon fas fa-cloud-upload-alt fa-2x\"></i></label>\n        <p className='iconLabel'>Import</p>\n      </div>      \n    </div>\n  )\n}\n\nfunction dehydrateBox (box : BoxState) : BoxState {\n  const { type } : BoxState = box\n\n  if (type === BoxType.EXPRESSION) {\n\n    return {\n      ...box,\n      ast : null as any, // TODO: don't\n      history : [], // TODO: don't\n      isRunning : false,\n      breakpoints : [], // TODO: solve how to don't\n      timeoutID : undefined,\n    }\n  }\n\n  return box\n}\n\nfunction dehydrate (state : AppState) : AppState {\n  return {\n    ...state,\n    submittedBoxes : state.submittedBoxes.map(dehydrateBox)\n  }\n}\n\nfunction hydrateBox (box : BoxState, macroTable : MacroMap) : BoxState {\n  const { type } : BoxState = box\n  \n  if (type === BoxType.EXPRESSION) {\n    const { singleLetterNames } = box as EvaluationState\n    const ast : AST = parseExpression((box as EvaluationState).expression, { macroTable, singleLetterNames })\n\n    return {\n      ...box,\n      ast,\n      history : [ { ast, lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n    }\n  }\n\n  return box\n}\n\nfunction hydrate (dehydrated : AppState) : AppState {\n  const { macroTable } = dehydrated\n  const config = { macroTable }\n\n  return {\n    ...dehydrated,\n    submittedBoxes : dehydrated.submittedBoxes.map((box) => hydrateBox(box, macroTable))\n  }\n}\n\ninterface Config {\n  singleLetterNames : boolean\n  macroTable : MacroMap\n}\n\nfunction parseExpression (expression : string, config : Config) : AST {\n  const { singleLetterNames : singleLetterVars, macroTable } : Config = config\n  \n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction onFiles (event : ChangeEvent<HTMLInputElement>, onImport : (state : AppState) => void) : void {\n  const { target : { files } } = event\n  if (files === null) {\n    return\n  }\n\n  const file : File = files[0]\n  const reader : FileReader = new FileReader\n  reader.onload = (event : Event) => {\n    const state : AppState = JSON.parse(reader.result as string)\n\n    onImport(hydrate(state))\n  }\n\n  reader.readAsText(file) \n}\n\nfunction createURL (content : string) : string {\n  const data = new Blob([ content ], {\n    type: 'application/json'\n  })\n\n  return window.URL.createObjectURL(data);\n}","import React from 'react'\nimport { MacroMap, builtinMacros } from '@lambdulus/core'\n\n\nexport interface MacroProperties {\n  macroTable : MacroMap\n  removeMacro (name : string) : void\n}\n\nexport default function MacroSpace (props : MacroProperties) : JSX.Element {\n  const { macroTable, removeMacro } = props\n\n  return (\n    <div className='macroSpace'>\n      <div className='builtinMacros'>\n        <p>Built-in Macros</p>\n        <ul className='UL'>\n          { Object.entries(builtinMacros).map(([macroName, macroExpression]) =>\n            <div key={ macroName }>\n              <li className='LI'>\n                <div className='box boxMacro'>\n                  { macroName } := { macroExpression }\n                </div>\n              </li>\n            </div>\n          ) }\n        </ul>\n      </div>\n\n      <div className='userMacros'>      \n        <p>User-defined Macros</p>\n        <ul>\n          { Object.entries(macroTable).map(([macroName, macroExpression]) =>\n              <div key={ macroName }>\n                <li className='LI'>\n                  <div className='box boxMacro'>\n                    { macroName } := { macroExpression }\n                    <i className=\"hiddenMacroIcon far fa-trash-alt\" onClick={ () => removeMacro(macroName) } />\n                  </div>\n                </li>\n              </div>\n            ) }\n        </ul>\n      </div>\n    </div>\n  )\n}","import React, { ChangeEvent } from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\nimport { EvaluationStrategy } from '../AppTypes'\n\n\ninterface SettingsProperties {\n  getActiveSingleLetterNames () : boolean\n  changeActiveSingleLetterNames (enabled : boolean) : void\n  getActiveStrategy () : EvaluationStrategy\n  changeActiveStrategy (strategy : EvaluationStrategy) : void\n}\n\nexport default function Settings (props : SettingsProperties) {\n  return (\n    <div className='editorSettings'>\n      <Switch\n        checked={ props.getActiveSingleLetterNames() }\n        disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n        shape=\"fill\"\n        \n        onChange={ (e : ChangeEvent<HTMLInputElement>) => // taky nejakej pattern\n          props.changeActiveSingleLetterNames(e.target.checked)\n        }\n      >\n        Single Letter Names\n      </Switch>\n\n      <div className='strategies inlineblock'>\n        <p className='stratsLabel inlineblock'>Evaluation Strategies:</p>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={ props.getActiveStrategy() === EvaluationStrategy.ABSTRACTION }\n          \n          onChange={ () => props.changeActiveStrategy(EvaluationStrategy.ABSTRACTION) }\n        >\n          Simplified Abstraction\n        </Radio>\n        {/* <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={ props.getActiveStrategy() === EvaluationStrategy.NORMAL }\n          \n          onChange={ () => props.changeActiveStrategy(EvaluationStrategy.NORMAL) }\n        >\n          Normal\n        </Radio>\n        <Radio\n          name=\"strategy\"\n          style=\"fill\"\n          checked={ props.getActiveStrategy() === EvaluationStrategy.APPLICATIVE }\n          \n          onChange={ () => props.changeActiveStrategy(EvaluationStrategy.APPLICATIVE) }\n        >\n          Applicative\n        </Radio> */}\n      </div>\n    </div>\n  )\n}","import React, { ChangeEvent, useState, SetStateAction, Dispatch, KeyboardEvent } from 'react'\n\nimport '../styles/Editor.css'\n\n// import { EvaluationStrategy } from '../App'\n\n\nexport enum ActionType {\n  ENTER_EXPRESSION = 'Enter Expression',\n  ENTER_EXERCISE = 'Enter Exercise',\n  NEXT_STEP = 'Next Step',\n  RUN = 'Run',\n  ENTER_MD = 'Enter MarkDown',\n}\n\ninterface EditorProperties {\n  placeholder: string\n  content : string\n  caretPosition : number\n  syntaxError : Error | null\n  isMarkDown : boolean\n  \n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n  // onReset () : void\n}\n\nexport default function Editor (props : EditorProperties) : JSX.Element {\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n    isMarkDown,\n\n    onContent,\n    onEnter,\n    onExecute,\n  } : EditorProperties = props\n  const lines : number = content.split('\\n').length\n\n  const onChange = (event : ChangeEvent<HTMLTextAreaElement>) => {\n    let { target : { value : content } } : { target : { value : string } } = event\n    const caretPosition : number = event.target.selectionEnd\n\n    content = content.replace(/\\\\/g, 'λ')\n\n    onContent(content, caretPosition)\n  }\n\n  // TODO: Editor should not decide that - it should only implement onEnter onShiftEnter onCtrlEnter\n  const onKeyDown = (event : KeyboardEvent<HTMLTextAreaElement>) => {\n    if ( ! event.shiftKey && ! event.ctrlKey && event.key === 'Enter') {\n      \n      if (isMarkDown) {\n        return\n      }\n\n      event.preventDefault()\n      onEnter()\n    }\n\n    if (event.shiftKey && event.key === 'Enter' && isMarkDown) {\n      event.preventDefault()\n      onEnter()\n    }\n    if (event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onExecute()\n    }\n\n    // TODO: not yet\n    // if (event.ctrlKey && event.key === 'r') {\n    //   event.preventDefault()\n    //   onReset()\n    // }\n  }\n\n  return (\n    <div className='editorContainer'>\n      {\n        syntaxError ?\n        <p className='editorError'>\n          { `${syntaxError}` }\n        </p>\n        :\n        null\n      }\n\n      <div className=\"editor\">\n        <InputField\n          placeholder={ placeholder }\n          content={ content }\n          lines={ lines }\n          caretPosition={ caretPosition }\n          onChange={ onChange }\n          onKeyDown={ onKeyDown }\n        />\n      </div>\n    </div>\n  )\n}\n\ninterface InputProps {\n  placeholder : string\n  content : string\n  lines : number\n  caretPosition : number\n  onChange (event : ChangeEvent<HTMLTextAreaElement>) : void\n  onKeyDown (event : KeyboardEvent<HTMLTextAreaElement>) : void\n}\n\nfunction InputField (props : InputProps) : JSX.Element {\n  const { placeholder, content, lines, onChange, onKeyDown, caretPosition } : InputProps = props\n\n  return (\n    <textarea\n      className='prompt'\n      onKeyDown={ onKeyDown }\n      onChange={ onChange }\n      value={ content }\n      placeholder={ placeholder }\n      wrap='hard'\n      autoComplete=\"off\"\n      autoCorrect=\"off\"\n      autoCapitalize=\"off\"\n      spellCheck={ false }\n      rows={ Math.max(lines, 1) } \n      ref={ (element : HTMLTextAreaElement) => {\n        if (element !== null) {\n          element.selectionStart = caretPosition\n          element.selectionEnd = caretPosition\n          element.focus()\n        }\n      } }\n    />\n  )\n}","import { AST, Lambda, Application, Macro, ChurchNumeral, Variable } from \"@lambdulus/core\";\n\n///////////////////////////////////////////////////////////////////////////////////////\n\ntype Pair<T> = [T, T]\ntype Triple<T> = [T, T, T]\n\n\n// TODO: fix the public equals interface, maybe public get and private set?\n// maybe implement public get method and bool itself leave private?\n//\n// first I need more trees, I need the previous AST\nexport class TreeComparator {\n  private translator : Map<string, string> = new Map\n  public equals : boolean = true\n  private context : Pair<AST>\n\n  constructor (readonly roots : Pair<AST> ) {\n    [ ...this.context ] = roots\n    // TODO: I need to compare roots first\n    this.compare()\n  }\n\n  compare () : void {\n    /**\n    TODO: compare need to compare both children if got\n    if one of them is incorrect\n    then solve that problem\n    if both of them is incorrect\n    then solve both problems and then decide how both come together\n\n    then I have an instance of knowledge system\n    I can fire up that system in this context (this node with invalid children)\n    system will need to get instance of something to call methods on\n    because system needs to ask questions - like, is this possible,\n    is this error applicable?\n    so instead of human, code will look up the AST and answer the questions\n    so it will be some kind of class which is able to observe all 3 ASTs at the same time\n    it will also have implemented query methods,\n    probably wont be many of them, just few\n    **/\n    \n    const [ left, right ] : Pair<AST> = this.context\n\n    if (left instanceof Lambda && right instanceof Lambda) {\n      const backup : Map<string, string> = new Map(this.translator.entries())\n\n      this.translator.set(left.argument.name(), right.argument.name())\n      this.context = [ left.right, right.right ]\n      this.compare()\n\n      this.translator = backup\n    }\n    else if (left instanceof Application && right instanceof Application) {\n      this.context = [ left.left, right.left ]\n      this.compare()\n\n      if ( ! this.equals) {\n        return\n      }\n\n      this.context = [ left.right, right.right ]\n      this.compare()\n    }\n    else if (left instanceof Macro && right instanceof Macro) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof ChurchNumeral && right instanceof ChurchNumeral) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof Variable && right instanceof Variable) {\n      this.equals = this.translator.get(left.name()) === right.name()\n    }\n    else {\n      this.equals = false\n    }\n  }\n}","import React, { PureComponent } from 'react'\n\nimport Editor from './Editor'\nimport { MakeActiveContext } from './BoxSpace'\nimport { StepRecord } from '../AppTypes'\n\ninterface EmptyExpressionProps {\n  className : string\n  isActive : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  history : Array<StepRecord>\n\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n}\n\n\nexport default class EmptyExpression extends PureComponent<EmptyExpressionProps> {\n  render () : JSX.Element {\n    const { className, isActive, editor } = this.props\n    const {\n      placeholder,\n      content,\n      caretPosition,\n      syntaxError,\n    } = editor\n\n    return (\n      <MakeActiveContext.Consumer>\n        {\n          (makeActive : () => void) =>\n          <div\n            className={ `${className} ${isActive ? '' : ' inactiveBox'}` }\n            onDoubleClick={ makeActive } >\n              {/* <p className='emptyStep'>Empty expression box.</p> */}\n              {\n                isActive ?\n                  (\n                    <Editor\n                      placeholder={ placeholder } // data\n                      content={ content } // data\n                      caretPosition={ caretPosition } // data\n                      syntaxError={ syntaxError } // data\n                      isMarkDown={ false } // data\n\n                      onContent={ this.props.onContent } // fn\n                      onEnter={ this.props.onEnter } // fn // tohle asi bude potreba\n                      onExecute={ this.props.onExecute } // fn // tohle asi bude potreba\n                    />\n                  )\n                  :\n                  (\n                    <p className='inactiveMessage'>\n                      Collapsing { Math.max(0, this.props.history.length - 1) } { this.props.history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n                    </p>\n                  )\n              }\n          </div>\n        }\n      </MakeActiveContext.Consumer>\n      \n    )\n  }\n}","import React from 'react'\n\nimport { ASTVisitor, Lambda, Variable, Beta, AST, Application, ChurchNumeral, Expansion, Macro, ASTReduction, None, Alpha, Gama } from \"@lambdulus/core\"\nimport { Breakpoint } from '../AppTypes';\nimport { GamaArg } from '@lambdulus/core/dist/reductions';\n\n\nexport default class ReactPrinter extends ASTVisitor {\n  private rendered : JSX.Element | null = null\n  private argument : Variable | null = null\n\n  private printMultiLambda (lambda : Lambda, accumulator : JSX.Element) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.body.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.body.argument)) {\n        className += ' breakpoint'\n      }\n\n      // bug@highlight-alpha\n      let set = false\n      if (this.reduction instanceof Alpha\n            &&\n          Array.from(this.reduction.conversions).some((conversion : Lambda) => {\n            return conversion.identifier === lambda.body.identifier\n          })\n          ) {\n              this.argument = context\n              set = true\n      }\n\n      // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n      let argument : Variable | null = this.argument\n      if (this.argument !== lambda.body.argument\n          &&\n          this.argument !== null\n          &&\n          this.argument.name() === lambda.body.argument.name()) {\n        this.argument = null\n      } // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n\n      // TODO: same here\n      if (this.argument\n          &&\n          this.argument.name() === context.name()) {\n            className += ' substitutedArg'\n        }\n\n      const args : JSX.Element = (\n        <span className='arguments'>\n          { accumulator } {' '}\n          <span\n            className={ className }\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              this.onClick({ type : Beta, context, broken : new Set }) }\n            }\n          >\n            { context.name() }\n          </span>\n        </span>\n      )\n      \n      this.printMultiLambda(lambda.body, args)\n      if (set === true) {\n        this.argument = null\n      }\n      this.argument = argument // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n    }\n    else {\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n      this.rendered = accumulator\n\n      this.rendered = (\n        <span className='function'>\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          { accumulator } . { body }\n          )\n        </span>\n      )\n    }\n  }\n\n  isBreakpoint (node : AST) : boolean {\n    for (const breakpoint of this.breakpoints) {\n      if (breakpoint.context.identifier === node.identifier) {\n        return true\n      }\n    }\n    return false\n  }\n\n  constructor (\n    public readonly tree : AST,\n    private readonly onClick : (breakpoint : Breakpoint) => void,\n    private readonly reduction : ASTReduction,\n    private readonly breakpoints : Array<Breakpoint>,\n  ) {\n    super()\n    this.tree.visit(this)\n  }\n\n  print () : JSX.Element | null {\n    return this.rendered\n  }\n\n  // TODO: little bit refactored, maybe keep going\n  onApplication (application: Application) : void {\n    let leftClassName : string = 'left'\n    let rightClassName : string = 'right'\n    let set : boolean = false\n    let redex : AST | null = null\n\n    if (this.reduction instanceof Beta) {\n      redex = this.reduction.redex\n    }\n    // else if (this.reduction instanceof Expansion) {\n    //   redex = this.reduction.target\n    // } // to asi neni uplne potreba tady\n\n    if (redex !== null\n          &&\n        redex.identifier === application.identifier // tohle je asi trosku useles\n          &&\n        redex === application\n      ) {\n        leftClassName += ' redex'\n        rightClassName += ' redex'\n\n        // TODO: this is probably not good and should be done other way\n\n        if (application.left instanceof Lambda) {\n          this.argument = application.left.argument\n          set = true\n        }\n    }\n\n    if (application.right instanceof Application) {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3 a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>( { this.rendered } )</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n    else {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>{ this.rendered }</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onLambda (lambda: Lambda) : void {\n    // TODO: this also seems not so elegant and clean\n    let argument : Variable | null = this.argument\n    if (this.argument !== lambda.argument\n        &&\n        this.argument !== null\n        &&\n        this.argument.name() === lambda.argument.name()) {\n      this.argument = null\n    }\n\n\n    // multilambda\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      const acc : JSX.Element = (\n        <span\n          className={ className }\n          onClick={ () => {\n            (context as any).identifier = Symbol()\n            this.onClick({ type : Beta, context, broken : new Set }) }\n          }\n        >\n          { lambda.argument.name() }\n        </span>\n      )\n\n      this.printMultiLambda(lambda, acc)\n    }\n    else {\n      const context : Variable = lambda.argument\n\n      lambda.argument.visit(this)\n      const args : JSX.Element | null = this.rendered\n\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      this.rendered = (\n        <span className='function' >\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          <span\n            className={ className }\n            onClick={ () => {\n              (context as any).identifier = Symbol()              \n              this.onClick({ type : Beta, context, broken : new Set }) }\n            }\n          >\n            { args } { ' ' }\n          </span>\n          . { body } \n          )\n        </span>\n      )\n    }\n\n    if (argument !== null) {\n      this.argument = argument\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onChurchNumeral (churchNumber: ChurchNumeral) : void {\n    let className : string = 'churchnumeral'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    }\n\n    if (this.reduction instanceof Gama && this.reduction.args.find((arg : GamaArg) => churchNumber.identifier === arg.identifier)) {\n      className += ' redex abstraction argument'\n    }\n\n    if (redex !== null\n          &&\n        redex.identifier === churchNumber.identifier\n          &&\n        redex === churchNumber\n      ) {\n        className += redexClass\n    }\n\n    if (this.isBreakpoint(churchNumber)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => {\n          (churchNumber as any).identifier = Symbol()\n          this.onClick({ type: Expansion, context : churchNumber, broken : new Set }) }\n        }\n      >\n        { churchNumber.name() }\n      </span>\n    )\n  }\n\n  // TODO: little bit refactored, maybe keep going  \n  onMacro (macro: Macro) : void {\n    let className = 'macro'\n    let redex : AST | null = null\n    let redexClass : string = ' redex'\n\n    if (this.reduction instanceof Expansion) {\n      redex = this.reduction.target\n    } \n\n    if (this.reduction instanceof Gama) {\n      [ redex ] = this.reduction.redexes\n      redexClass += ' abstraction'\n    }\n\n    if (redex !== null\n          &&\n        redex.identifier === macro.identifier\n          &&\n        redex === macro\n        ) {\n      className += redexClass\n    }\n\n    if (this.isBreakpoint(macro)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => {\n          (macro as any).identifier = Symbol()\n          this.onClick({ type: Expansion, context : macro, broken : new Set }) }\n        }\n      >\n        { macro.name() }\n      </span>\n    )\n  }\n  \n  onVariable (variable: Variable): void {\n    // TODO: same here - not so clean\n    let className : string = 'variable'\n\n    if (this.argument\n        &&\n        this.argument.name() === variable.name()) {\n          className += ' substitutedArg'\n      }\n\n    this.rendered = <span className={ className } >{ variable.name() }</span>\n  }\n}","import React from 'react'\nimport { ASTReduction, Beta, Alpha, Expansion, Gama } from '@lambdulus/core';\nimport { Eta } from '@lambdulus/core/dist/reductions/eta';\n\n\ninterface ReductionMessageProperties {\n  lastReduction : ASTReduction | null\n}\n\nexport default function ReductionMessage (props : ReductionMessageProperties) : JSX.Element {\n  const { lastReduction } = props\n\n  if (lastReduction === null) {\n    return null as any\n  }\n\n  if (lastReduction instanceof Beta) {\n    return (\n      <p className='lastReduction'>\n        β reduction\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Alpha) {\n    return (\n      <p className='lastReduction'>\n        α conversion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Expansion) {\n    return (\n      <p className='lastReduction'>\n        Macro expansion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Eta) {\n    return (\n      <p className='lastReduction'>\n        η conversion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Gama) {\n    return (\n      <p className='lastReduction'>\n        Simplified Application\n      </p>\n    )\n  }\n\n  else {\n    return null as any\n  }\n  \n}","import React, { createContext, ReactNode } from \"react\"\n\nimport { DEFAULT_STATE, EvaluationStrategy, AppState } from \"../AppTypes\"\n\n\nexport const StateContext = createContext(DEFAULT_STATE)\nexport const SLIContext = createContext(true)\nexport const StrategyContext = createContext(EvaluationStrategy.NORMAL)\n\ninterface InjectorProps {\n  state : AppState\n  SLI : boolean\n  strategy : EvaluationStrategy\n  children : ReactNode\n}\n\nexport function DataInjector (props : InjectorProps) : JSX.Element {\n  const { state, SLI, strategy, children } = props\n\n  return (\n    <StateContext.Provider value={ state }>\n      <StrategyContext.Provider value={ strategy }>\n        <SLIContext.Provider value={ SLI }>\n          { children }\n        </SLIContext.Provider>\n      </StrategyContext.Provider>\n    </StateContext.Provider>\n  )\n}","import React, { memo } from 'react'\nimport { ASTReduction } from '@lambdulus/core'\n\nimport '../styles/Step.css'\n\nimport { strategyToEvaluator } from './ExpressionBox'\nimport ReactPrinter from './ReactPrinter'\nimport ReductionMessage from './ReductionMessage'\nimport { EvaluationStrategy, StepRecord, Breakpoint, Evaluator } from '../AppTypes'\nimport { StrategyContext } from './DataInjector'\n\n\ninterface StepWrapperProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  lastStep : boolean\n}\n\ninterface StepProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  strategy : EvaluationStrategy\n  lastStep : boolean\n}\n\n// This is done because of highlighting - if Strategy is changed ->\n// old steps should not be re-highlighted with changed Strategy - but stay same\nconst StepMemo = memo(Step, (props : StepProperties) => !props.lastStep)\n\nexport default function StepWrapper (props : StepWrapperProperties) : JSX.Element {\n  return(\n    <StrategyContext.Consumer>\n      { \n        (strategy : EvaluationStrategy) => <StepMemo { ...props } strategy={ strategy } />\n      }\n    </StrategyContext.Consumer>\n  )\n}\n\nfunction Step (props : StepProperties) : JSX.Element | null {\n  const { stepRecord, addBreakpoint, breakpoints, children, strategy } = props\n  const { ast : tree, lastReduction, step, message } = stepRecord\n\n  if (tree === null) {\n    return null\n  }\n\n  const evaluator : Evaluator = new (strategyToEvaluator(strategy) as any)(tree)\n  const reduction : ASTReduction = evaluator.nextReduction\n  const printer : ReactPrinter = new ReactPrinter(tree, addBreakpoint, reduction, breakpoints)\n\n  return (\n    <span className='step'>\n      <ReductionMessage lastReduction={ lastReduction } />\n      <div className='inlineblock' >\n        <p className='stepNumber' >\n          { step } :\n        </p>\n        { printer.print() }\n        { children }\n        {\n          stepRecord.message === '' ?\n            null\n            :\n            <p className='stepMessage'>\n              { stepRecord.message }\n            </p>\n        }\n      </div>\n    </span>\n  )\n}","import React, { createContext, ReactNode } from \"react\"\nimport { BoxState } from \"../AppTypes\";\n\n\nexport const AddBoxContext = createContext((boxState : BoxState) => {})\nexport const AddEmptyBoxContext = createContext((boxState : BoxState) => {})\nexport const ChangeActiveBoxContext = createContext((activeBoxIndex : number) => {} )\nexport const SetBoxStateContext = createContext((index : number, boxState : BoxState) => {})\nexport const DefineMacroContext = createContext((name : string, definition : string) => {})\n\ninterface InjectorProps {\n  addBox (boxState : BoxState) : void\n  addEmptyBox (boxState: BoxState) : void\n  changeActiveBox (activeBoxIndex: number) : void\n  defineMacro (name: string, definition: string) : void\n  setBoxState (index: number, boxState: BoxState) : void\n  children : ReactNode\n}\n\nexport function MethodInjector (props : InjectorProps) : JSX.Element {\n  const { addBox, addEmptyBox, changeActiveBox, setBoxState, defineMacro, children } = props\n\n  return (\n    <AddBoxContext.Provider value={ addBox }>\n      <AddEmptyBoxContext.Provider value={ addEmptyBox }>\n        <ChangeActiveBoxContext.Provider value={ changeActiveBox }>\n          <SetBoxStateContext.Provider value={ setBoxState }>\n            <DefineMacroContext.Provider value={ defineMacro }>\n            { children }\n            </DefineMacroContext.Provider>\n          </SetBoxStateContext.Provider>\n        </ChangeActiveBoxContext.Provider>\n      </AddEmptyBoxContext.Provider>\n    </AddBoxContext.Provider>\n  )\n}","import React, { PureComponent } from 'react'\n\nimport Step from './Step'\nimport { AddBoxContext } from './MethodInjector'\nimport { Breakpoint, StepRecord, EvaluationState, BoxState } from '../AppTypes'\n\ninterface InactiveExpressionProps {\n  className : string\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n\n  makeActive () : void\n  createBoxFrom (stepRecord : StepRecord) : EvaluationState\n}\n\n\nexport default class InactiveExpression extends PureComponent<InactiveExpressionProps> {\n  render () : JSX.Element {\n    const { className } = this.props\n\n    return (\n      <div className={ className + ' inactiveBox' } onDoubleClick={ this.props.makeActive } >\n          <ul className='UL'>\n            <li key={ 0 } className='activeStep LI'>\n              <Step\n                breakpoints={ this.props.breakpoints }\n                addBreakpoint={ () => {} } // blank function - NOOP\n                stepRecord={ this.props.history[0] }\n                lastStep={ false }\n              >\n                \n                <AddBoxContext.Consumer>\n                  {\n                    (addBox : (boxState : BoxState) => void) => <i\n                      className=\"hiddenIcon fas fa-pencil-alt\"\n                      onClick={ () => addBox(this.props.createBoxFrom(this.props.history[0])) }\n                    />\n                  }\n                </AddBoxContext.Consumer>\n                \n              </Step>\n            </li>\n          </ul>\n          <p className='inactiveMessage'>\n            Collapsing { this.props.history.length - 1 } { this.props.history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n          </p>\n        </div>\n    )\n  }\n}","import React, { ChangeEvent } from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\n\nimport 'pretty-checkbox'\nimport '../styles/Controls.css'\n\n\nexport interface ControlsProps {\n  isExercise : boolean\n  makeExercise () : void\n  endExercise () : void\n}\n\n// TODO: maybe not really needed or rename it accordingly\nexport default function Controls (props : ControlsProps) : JSX.Element {\n  const {\n    isExercise,\n    makeExercise,\n    endExercise,\n  } : ControlsProps = props\n\n  return (\n    <div id=\"controls\">\n      <div>\n        <Switch\n          className='exerciseSwitch'\n          checked={ isExercise }\n          onChange={ (e : ChangeEvent<HTMLInputElement>) =>\n            e.target.checked ? makeExercise() : endExercise()\n          }\n          shape=\"fill\"\n        >\n          Exercise\n        </Switch>\n      </div>\n    </div>\n  )\n}","import React, { PureComponent } from 'react'\n\nimport Controls from './Controls'\nimport Step from './Step'\nimport { PromptPlaceholder, EvaluationState, Breakpoint, StepRecord, BoxState } from '../AppTypes'\nimport { mapLeftFromTo } from '../misc'\nimport Editor from './Editor'\nimport { AddBoxContext } from './MethodInjector'\n\n\ninterface EvaluatorProps {\n  className : string\n  isExercise : boolean\n  state : EvaluationState\n  breakpoints : Array<Breakpoint>\n  history : Array<StepRecord>\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n  isNormalForm : boolean\n\n  createBoxFrom (stepRecord : StepRecord) : EvaluationState\n  setBoxState (state : EvaluationState) : void\n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n}\n\nexport default class Expression extends PureComponent<EvaluatorProps> {\n  render () : JSX.Element {\n    const { className, isExercise, state, editor } = this.props\n\n    const {\n      placeholder,\n      content,\n      caretPosition,\n      syntaxError,\n    } = editor\n\n    return (\n      <div className={ className }>\n        <Controls\n          isExercise={ isExercise }\n          makeExercise={ () =>\n            this.props.setBoxState({\n              ...state,\n              isExercise : true,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.VALIDATE_MODE,\n              },\n            })\n          }\n          endExercise={ () =>\n            this.props.setBoxState({\n              ...state,\n              isExercise : false,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.EVAL_MODE,\n              },\n            })\n          }\n        />\n        <AddBoxContext.Consumer>\n          {\n            (addBox : (boxState : BoxState) => void) =>\n            <ul className='UL'>\n              {\n                mapLeftFromTo(0, this.props.history.length - 2, this.props.history, (stepRecord : StepRecord, i : Number) =>\n                  <li key={ i.toString() } className='inactiveStep LI' >\n                    <Step\n                      breakpoints={ this.props.breakpoints }\n                      addBreakpoint={ () => {} }\n                      stepRecord={ stepRecord }\n                      lastStep={ false }\n                    >\n                      <i\n                        className=\"hiddenIcon fas fa-pencil-alt\"\n                        onClick={ () => addBox(this.props.createBoxFrom(stepRecord)) }\n                      />\n                    </Step>\n                  </li>)\n              }\n              <li key={this.props.history.length - 1} className='activeStep LI'>\n                <Step\n                  breakpoints={ this.props.breakpoints }\n                  addBreakpoint={ this.addBreakpoint }\n                  stepRecord={ this.props.history[this.props.history.length - 1] }\n                  lastStep={ true }\n                >\n                    <i\n                      className=\"hiddenIcon fas fa-pencil-alt\"\n                      onClick={ () => addBox(this.props.createBoxFrom(this.props.history[this.props.history.length - 1])) }\n                    />\n                </Step>\n              </li>\n            </ul>\n          }\n        </AddBoxContext.Consumer>\n\n        {\n          this.props.isNormalForm ?\n          null\n            :\n          <Editor\n            placeholder={ placeholder } // data\n            content={ content } // data\n            caretPosition={ caretPosition } // data\n            syntaxError={ syntaxError } // data\n            isMarkDown={ false } // data\n\n            onContent={ this.props.onContent } // fn\n            onEnter={ this.props.onEnter } // fn // tohle asi bude potreba\n            onExecute={ this.props.onExecute } // fn // tohle asi bude potreba\n          />\n        }\n      </div>\n    )\n  }\n\n  addBreakpoint (breakpoint : Breakpoint) : void {\n    let { state, setBoxState } = this.props\n  \n    setBoxState({\n      ...state,\n      breakpoints : [ ...state.breakpoints, breakpoint ],\n    })\n  }\n}","import React, { PureComponent } from 'react'\nimport {\n  AST,\n  ASTReduction,\n  None,\n  NormalEvaluator,\n  Beta,\n  Lambda,\n  Variable,\n  Expansion,\n  ChurchNumeral,\n  Macro,\n  Token,\n  tokenize,\n  parse,\n  ApplicativeEvaluator,\n  OptimizeEvaluator,\n  MacroMap,\n  NormalAbstractionEvaluator,\n} from \"@lambdulus/core\"\n\nimport '../styles/EvaluatorBox.css'\n\nimport { TreeComparator } from './TreeComparator'\nimport EmptyEvaluator from './EmptyExpression'\nimport InactiveEvaluator from './InactiveExpression'\nimport Expression from './Expression'\nimport { MakeActiveContext } from './BoxSpace'\nimport { EvaluationStrategy, PromptPlaceholder, EvaluationState, Evaluator, StepRecord, BoxType, Breakpoint } from '../AppTypes'\nimport { reportEvent } from '../misc';\n\n\nexport function strategyToEvaluator (strategy : EvaluationStrategy) : Evaluator {\n  switch (strategy) {\n    case EvaluationStrategy.NORMAL:\n      return NormalEvaluator as any\n \n    case EvaluationStrategy.APPLICATIVE:\n      return ApplicativeEvaluator as any\n\n    case EvaluationStrategy.OPTIMISATION:\n      return OptimizeEvaluator as any\n\n    case EvaluationStrategy.ABSTRACTION:\n      return NormalAbstractionEvaluator as any\n  }\n}\n\nexport interface EvaluationProperties {\n  state : EvaluationState\n  isActive : boolean\n  macroTable : MacroMap\n\n  setBoxState (state : EvaluationState) : void\n}\n\nexport default class ExpressionBox extends PureComponent<EvaluationProperties> {\n  constructor (props : EvaluationProperties) {\n    super(props)\n\n    this.onContent = this.onContent.bind(this)\n    this.onSubmitExpression = this.onSubmitExpression.bind(this)\n    this.parseExpression = this.parseExpression.bind(this)\n    this.onEnter = this.onEnter.bind(this)\n    this.onExerciseStep = this.onExerciseStep.bind(this)\n    this.onStep = this.onStep.bind(this)\n    this.onExecute = this.onExecute.bind(this)\n    this.onRun = this.onRun.bind(this)\n    this.onStop = this.onStop.bind(this)\n    this.shouldBreak = this.shouldBreak.bind(this)\n    this.createBoxFrom = this.createBoxFrom.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { state, isActive } : EvaluationProperties = this.props\n    const {\n      history,\n      breakpoints,\n      isExercise,\n      strategy,\n      expression,\n      editor,\n    } : EvaluationState = state\n\n    let className : string = 'box boxEval'\n    const { isNormalForm } = history.length ? history[history.length - 1] : { isNormalForm : false }\n\n    if (expression === '') {\n      return (\n        <EmptyEvaluator\n          className={ className }\n          isActive={ this.props.isActive }\n          editor={ editor }\n          history={ history }\n\n          onContent={ this.onContent }\n          onEnter={ this.onEnter }\n          onExecute={ this.onExecute }\n        />\n      )\n    }\n\n    if (isExercise) {\n      className += ' boxExercise'\n    }\n\n    if ( ! isActive) {\n      return (\n        <MakeActiveContext.Consumer>\n          {\n            (makeActive : () => void) =>\n              <InactiveEvaluator\n                className={ className }\n                breakpoints={ breakpoints }\n                history={ history }\n                \n                makeActive={ makeActive }\n                createBoxFrom={ this.createBoxFrom }\n              />\n          }\n        </MakeActiveContext.Consumer>\n      )\n    }\n\n    return (\n      <Expression\n        className={ className }\n        isExercise={ isExercise }\n        state={ state }\n        breakpoints={ breakpoints }\n        history={ history }\n        editor={ editor }\n        isNormalForm={ isNormalForm }\n\n        createBoxFrom={ this.createBoxFrom }\n        setBoxState={ this.props.setBoxState }\n        onContent={ this.onContent }\n        onEnter={ this.onEnter }\n        onExecute={ this.onExecute }\n      />\n    )\n  }\n\n  createBoxFrom (stepRecord : StepRecord) : EvaluationState {\n    const { state } : EvaluationProperties = this.props\n    const {\n      strategy,\n      singleLetterNames,\n    } : EvaluationState = state\n    const { ast } = stepRecord\n\n    return {\n      type : BoxType.EXPRESSION,\n      __key : Date.now().toString(),\n      expression : ast.toString(),\n      ast : ast.clone(),\n      history : [ {\n        ast : ast.clone(),\n        lastReduction : null,\n        step : 0,\n        message : '',\n        isNormalForm : false,\n      } ],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      isExercise : false,\n      strategy,\n      singleLetterNames,\n      editor : {\n        placeholder : PromptPlaceholder.EVAL_MODE,\n        content : '',\n        caretPosition : 0,\n        syntaxError : null,\n      }\n    }\n  }\n\n  onContent (content : string, caretPosition : number) : void {\n    const { state, setBoxState } = this.props\n\n    setBoxState({\n      ...state,\n      editor : {\n        ...state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  onEnter () : void {\n    const { expression, isExercise, editor : { content } } = this.props.state\n\n    if (expression === '') {\n      this.onSubmitExpression()\n    }\n    else if (content !== '' && isExercise) {\n      this.onExerciseStep()\n    }\n    else if (content === '' && (! isExercise)) {\n      this.onStep()\n    }\n    else {\n      console.log('Error: Something unexpected just happened. A')\n    }\n  }\n\n  onSubmitExpression () : void {\n    const { state, setBoxState } = this.props\n    const {\n      editor : { content },\n    } = state\n\n    try {\n      const ast : AST = this.parseExpression(content)\n\n      setBoxState({\n        ...state,\n        ast,\n        expression : content,\n        history : [ {\n          ast : ast.clone(),\n          lastReduction : None,\n          step : 0,\n          message : '',\n          isNormalForm : false\n        } ],\n        editor : {\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.EVAL_MODE,\n          syntaxError : null,\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit valid', content)\n    } catch (exception) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : exception.toString(),\n        }\n      })\n\n      reportEvent('Submit Expression', 'submit invalid', content)\n    }\n  }\n\n  onExerciseStep () {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    \n    try {\n      const userAst : AST = this.parseExpression(content)\n      const stepRecord : StepRecord = history[history.length - 1]\n      const { isNormalForm, step } = stepRecord\n      let { ast, lastReduction } = stepRecord\n      ast = ast.clone()\n\n      if (isNormalForm) {\n        // TODO: do something about it\n        // say user - there are no more steps and it is in normal form        \n        // TODO: consider immutability\n        stepRecord.message = 'No more steps available. Expression is in normal form.'\n\n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in normal form', content)\n\n        return\n      }\n    \n      const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n      lastReduction = normal.nextReduction\n    \n      if (normal.nextReduction instanceof None) {\n        // TODO: refactor PLS - update history\n        // TODO: say user it is in normal form and they are mistaken\n        stepRecord.isNormalForm = true\n        stepRecord.message = 'Expression is already in normal form.'\n        \n        setBoxState({\n          ...state,\n        })\n\n        reportEvent('Exercise Step', 'Step Already in Normal Form', content)\n        \n        return\n      }\n    \n      ast = normal.perform()\n    \n      let message : string = ''\n      const comparator : TreeComparator = new TreeComparator([ userAst, ast ])\n      if (comparator.equals) {\n        ast = userAst\n        message = 'Correct.'\n\n        reportEvent('Exercise Step', 'Valid Step', content)\n      }\n      else {\n        // TODO: say user it was incorrect\n        // TODO: na to se pouzije uvnitr EvaluatorState prop messages nebo tak neco\n        console.log('Incorrect step')\n        message = `Incorrect step. ${content}`\n\n        reportEvent('Exercise Step', 'Invalid Step', content)\n      }\n\n      setBoxState({\n        ...state,\n        history : [ ...history, { ast, lastReduction, step : step + 1, message, isNormalForm : false } ],\n        editor : {\n          ...state.editor,\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.VALIDATE_MODE,\n          syntaxError : null,\n        }\n      })\n    } catch (exception) {\n      // TODO: print syntax error\n      // TODO: do it localy - no missuse of onSubmit\n\n      // TODO: print syntax error\n\n      reportEvent('Exercise Step', 'Syntax error in Step', content)\n    }\n  }\n\n  onStep () : void {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    const stepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { ast, lastReduction } = stepRecord\n    ast = ast.clone()\n  \n    if (isNormalForm) {\n      return\n    }\n\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n  \n    if (normal.nextReduction instanceof None) {\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n      \n      setBoxState({\n        ...state,\n      })\n      \n      reportEvent('Evaluation Step', 'Step Normal Form Reached', ast.toString())\n\n      return\n    }\n  \n    ast = normal.perform()\n  \n    setBoxState({\n      ...state,\n      history : [ ...history, { ast, lastReduction, step : step + 1, message : '', isNormalForm : false } ],\n\n    })\n\n    reportEvent('Evaluation Step', 'Step', ast.toString())\n  }\n\n  onExecute () : void {\n    const { state, setBoxState } = this.props\n    const { isRunning, isExercise } = state\n\n    if (isExercise) {\n      // TODO: exercises can not be run - some message to user???\n      return\n    }\n\n    if (isRunning) {\n      this.onStop()\n    }\n    else {\n      const { timeout, history } = state\n      const stepRecord = history[history.length - 1]\n  \n      if (stepRecord.isNormalForm) {\n        return\n      }\n      \n      const { ast, step, lastReduction, isNormalForm, message } = stepRecord\n      history.push(history[history.length - 1])\n      history[history.length - 2] = { ast : ast.clone(), step, lastReduction, message : 'Skipping some steps...', isNormalForm }\n\n      setBoxState({\n        ...state,\n        isRunning : true,\n        timeoutID : window.setTimeout(this.onRun, timeout),\n      })\n\n      reportEvent('Execution', 'Run Evaluation', ast.toString())\n    }\n  }\n\n  onRun () : void {\n    const { state, setBoxState } = this.props\n    const { strategy } = state\n    let { history, isRunning, breakpoints, timeoutID, timeout } = state\n    const stepRecord : StepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { lastReduction } = stepRecord\n\n    if ( ! isRunning) {\n      return\n    }\n    \n    if (isNormalForm) {\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    let { ast } = stepRecord\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n    \n    if (normal.nextReduction instanceof None) {\n      // TODO: consider immutability\n      history.pop()\n      history.push({\n        ast,\n        lastReduction : stepRecord.lastReduction,\n        step,\n        message : 'Expression is in normal form.',\n        isNormalForm : true\n      })\n  \n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    // TODO: maybe refactor a little\n    const breakpoint : Breakpoint | undefined = breakpoints.find(\n      (breakpoint : Breakpoint) =>\n        this.shouldBreak(breakpoint, normal.nextReduction)\n    )\n\n    if (breakpoint !== undefined) {\n      // TODO: consider immutability\n      if (normal.nextReduction instanceof Expansion) {\n        breakpoint.broken.add(normal.nextReduction.target)\n      }\n      if (normal.nextReduction instanceof Beta && normal.nextReduction.redex.left instanceof Lambda) {\n        breakpoint.broken.add(normal.nextReduction.redex.left.argument)\n      }\n\n      window.clearTimeout(timeoutID)\n\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID,\n      })\n\n      return\n    }\n  \n    ast = normal.perform()\n\n    history[history.length - 1] = { ast, lastReduction, step : step + 1, message : '', isNormalForm }\n    \n    setBoxState({\n      ...state,\n      timeoutID : window.setTimeout(this.onRun, timeout)\n    })\n  }\n\n  onStop () : void {\n    const { state, setBoxState } = this.props\n    const { timeoutID } = state\n  \n    window.clearTimeout(timeoutID)\n  \n    setBoxState({\n      ...state,\n      isRunning : false,\n      timeoutID : undefined\n    })\n  }\n\n  // TODO: breakpointy se pak jeste musi predelat\n  shouldBreak (breakpoint : Breakpoint, reduction : ASTReduction) : boolean {\n    // if (reduction instanceof (breakpoint.type as any)\n    //     && reduction instanceof Beta && breakpoint.context instanceof Lambda\n    //     && reduction.target.identifier === breakpoint.context.body.identifier\n    //   ) {\n    //     return true\n    // }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Beta && breakpoint.context instanceof Variable\n        && reduction.redex.left instanceof Lambda\n        && reduction.redex.left.argument.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.redex.left.argument)\n    ) {\n      return true\n    }\n\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof ChurchNumeral\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof Macro\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n  \n    return false\n  }\n\n  // THROWS Exceptions\n  parseExpression (expression : string) : AST {\n    const { macroTable } = this.props\n\n    const { singleLetterNames : singleLetterVars } = this.props.state\n\n    const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n    const ast : AST = parse(tokens, macroTable)\n\n    return ast\n  }\n}","import React, { useContext } from 'react'\n\nimport { trimStr } from '../misc'\nimport Editor from './Editor'\nimport { tokenize, parse, AST, Token, Variable, builtinMacros } from '@lambdulus/core'\nimport { DefineMacroContext } from './MethodInjector'\nimport { MacroDefinitionState, BoxState } from '../AppTypes'\n\n\nexport interface MacroDefinitionProperties {\n  state : MacroDefinitionState\n  setBoxState (boxState : BoxState) : void\n  // addBox (boxState : BoxState) : void\n}\n\nexport default function MacroDefinition (props : MacroDefinitionProperties) : JSX.Element {\n  const { state, setBoxState } = props\n  const { macroName, macroExpression, singleLetterNames } = state\n  const { editor : { content, caretPosition, placeholder, syntaxError } } = state\n\n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  const defineMacro = useContext(DefineMacroContext)\n\n  const onSubmit = () => {\n    const [ macroName, macroExpression ] : Array<string> = content.split(':=').map(trimStr)\n\n    // TODO: refactor later - this is just dirty little quick fix\n    if ( ! isMacroUnambigous(macroName)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro name is not valid. It redefines built-in Macro.`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidName(macroName, singleLetterNames)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError :\n          // TODO: please fix this - only dirty quick impl\n            new Error(`Macro name is not valid.\n            ${singleLetterNames && macroName.length !== 1 ? 'Name should be single letter.' : '' }`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidExpression(macroExpression, singleLetterNames)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro expression is not valid.`)\n        }\n      })\n\n      return\n    }\n\n    setBoxState({\n      ...state,\n      macroName,\n      macroExpression,\n    })\n\n    defineMacro(macroName, macroExpression)\n  \n    // const newMacroTable : MacroMap = {\n    //   ...macroTable,\n    //   [macroName] : macroExpression\n    // }\n    // this.updateMacros(newMacroTable)\n  }\n\n  // TODO: implement same as Evaluator - editor and stuff\n  if (macroName === '' && macroExpression === '') {\n    return (\n      <div className='box boxMacro inactiveBox'>\n          {/* <p className='emptyStep'>Empty macro box.</p> */}\n          <Editor\n            placeholder={ placeholder } // data\n            content={ content } // data\n            caretPosition={ caretPosition } // data\n            syntaxError={ syntaxError } // data\n            isMarkDown={ false } // data\n\n            onContent={ onContent } // fn\n            onEnter={ onSubmit } // fn // tohle asi bude potreba\n            onExecute={ () => {} } // fn // TODO: tohle Macro nepotrebuje\n          />\n          </div>\n    )\n  }\n\n  return (\n    <div className='box boxMacro'>\n      { macroName } := { macroExpression }\n    </div>\n  )\n}\n\n// TODO: in the future there should be more then boolean to indicate validity\nfunction isValidName (name : string, singleLetterNames : boolean) : boolean {\n  try {\n    const root : AST = parseExpression(name, singleLetterNames)\n\n    return root instanceof Variable\n  }\n  catch (exception) {\n    return false\n  }\n}\n\n// THROWS Exceptions\nfunction parseExpression (expression : string, singleLetterNames : boolean) : AST {\n  const macroTable = {}\n  const singleLetterVars : boolean = singleLetterNames\n\n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction isMacroUnambigous (name : string) : boolean {\n  return ! (name in builtinMacros)\n}\n\nfunction isValidExpression (expression : string, singleLetterNames : boolean) : boolean {\n  try {\n    parseExpression(expression, singleLetterNames)\n\n    return true\n  }\n  catch (exception) {\n    return false\n  }\n}","import React, { useContext } from 'react'\nconst ReactMarkdown = require('react-markdown')\nimport 'github-markdown-css'\n\nimport Editor from './Editor'\nimport { MakeActiveContext, SetBoxContext } from './BoxSpace'\nimport { NoteState } from '../AppTypes'\n\n\nexport interface NoteProperties {\n  state : NoteState\n  isActive : boolean\n\n  // addBox (boxState : BoxState) : void\n}\n\nexport default function Note (props : NoteProperties) : JSX.Element {\n  const {\n    state : {\n      note,\n      editor : { placeholder, content, caretPosition, syntaxError },\n      isEditing,\n    },\n    isActive,\n  } = props\n  \n  const makeActive = useContext(MakeActiveContext)\n  const setBoxState = useContext(SetBoxContext)\n\n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n    // this.updateURL(expression) // tohle musim nejak vyresit - mozna ta metoda setBoxState v APP bude checkovat propisovat do URL\n  }\n\n  const onSubmitNote = () => {\n    setBoxState({\n      ...props.state,\n      note : content,\n      isEditing : false,\n    })\n  }\n\n\n  if (isEditing && isActive) {\n    return (\n      <div className='box boxNoteEditor'>\n        {/* <p className='emptyStep'>Empty note box.</p>         */}\n        <Editor\n          placeholder={ placeholder } // data\n          content={ content } // data\n          caretPosition={ caretPosition } // data\n          syntaxError={ syntaxError } // data\n          isMarkDown={ true } // data\n          \n          onContent={ onContent } // fn\n          onEnter={ onSubmitNote } // fn\n          onExecute={ () => {} } // fn\n          // onReset={ this.onClear } // fn not yet\n        />\n\n\n        <div id=\"controls\">\n          <button onClick={ () => onSubmitNote() }>\n            Save\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n\n  return (\n    <div className='box boxNote markdown-body'>\n      {/* {\n        note === '' ? \n          <p className='emptyStep'>Empty note box.</p>\n        :\n          null\n      } */}\n      <ReactMarkdown source={ note } />\n      <div id=\"controls\">\n          <button onClick={ () => {\n            setBoxState({\n              ...props.state,\n              isEditing : true,\n            })\n            makeActive()            \n          }\n          }\n            \n          >\n            Edit\n          </button>\n        </div>\n    </div>\n  )\n}","import React from 'react'\n\nimport { MacroMap } from '@lambdulus/core'\n\nimport Evaluator from './ExpressionBox'\nimport MacroDefinition from './MacroDefinition'\nimport Note from './Note'\nimport { MacroTableContext } from './EvaluatorSpace'\nimport { SetBoxContext } from './BoxSpace'\nimport { BoxState, BoxType, EvaluationState, MacroDefinitionState, NoteState } from '../AppTypes'\n\n\ninterface BoxProperties {\n  state : BoxState\n  isActive : boolean\n\n  // removeExpression () : void // not yet\n}\n\nexport default function Box (props : BoxProperties) : JSX.Element {\n  const { state, isActive } : BoxProperties = props\n  const { type } = state\n\n  if (type === BoxType.EXPRESSION) {\n    return (\n      <div className=''>\n        <MacroTableContext.Consumer>\n          {\n            (macroTable : MacroMap) =>\n              <SetBoxContext.Consumer>\n                {\n                  (setBoxState : (boxState : BoxState) => void) =>\n                    <Evaluator\n                      state={ state as EvaluationState }\n                      isActive={ isActive }\n                      macroTable={ macroTable }\n                      \n                      setBoxState={ setBoxState }\n                    />\n                }\n              </SetBoxContext.Consumer>\n          }\n        </MacroTableContext.Consumer>\n      </div>\n    )\n  }\n\n  if (type === BoxType.MACRO) {\n    return (\n      <div className=''>\n        <SetBoxContext.Consumer>\n          {\n            (setBoxState : (boxState : BoxState) => void) =>\n              <MacroDefinition\n                state={ state as MacroDefinitionState }\n                setBoxState={ setBoxState }\n      \n                // addBox={ addBox }\n              />\n          }\n        </SetBoxContext.Consumer>\n      </div>\n    )\n  }\n\n  if (type === BoxType.NOTE) {\n    return (\n      <div className=''>\n        <Note\n          state={ state as NoteState }\n          isActive={ isActive }\n\n          // addBox={ addBox }\n        />\n      </div>\n    )\n  }\n\n  return null as any // never happens\n}","import React, { useContext } from 'react'\n\nimport { createEmptyExp, createEmptyMacro, createEmptyNote } from './BoxSpace'\nimport { EvaluationStrategy } from '../AppTypes'\nimport { AddEmptyBoxContext } from './MethodInjector'\nimport { StrategyContext, SLIContext } from './DataInjector'\n\n\nexport function CreateBox () : JSX.Element {\n  const strategy : EvaluationStrategy = useContext(StrategyContext)\n  const singleLetterNames : boolean = useContext(SLIContext)\n  const addEmptyBox = useContext(AddEmptyBoxContext)\n\n  return (\n    <div className='emptyC'>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => addEmptyBox(createEmptyExp(strategy, singleLetterNames)) }\n      >\n        <i>+ λ</i>\n      </p>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => addEmptyBox(createEmptyMacro(singleLetterNames)) }\n      >\n        <i>+ Macro\n        </i></p>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => addEmptyBox(createEmptyNote()) }\n      >\n        <i>+ MD</i>\n      </p>\n    </div>\n  )\n}","import React, { useContext, createContext } from 'react'\n\nimport Box from './Box'\n\nimport { CreateBox } from './CreateBox'\nimport { PromptPlaceholder, EvaluationStrategy, BoxState, BoxType, EvaluationState, MacroDefinitionState, NoteState } from '../AppTypes'\nimport { ChangeActiveBoxContext, SetBoxStateContext } from './MethodInjector'\n\n\nexport interface BoxSpaceProperties {\n  submittedBoxes : Array<BoxState>\n  activeBoxIndex : number\n  \n  // removeExpression (index : number) : void // not yet\n}\n\nexport const MakeActiveContext = createContext(() => {})\nexport const SetBoxContext = createContext((boxState : BoxState) => {})\n\nexport default function BoxSpace (props: BoxSpaceProperties) : JSX.Element {\n  const {\n    submittedBoxes,\n    activeBoxIndex,\n  } = props\n  const makeActive = useContext(ChangeActiveBoxContext)\n  const setBoxState = useContext(SetBoxStateContext)\n\n  if (submittedBoxes.length === 0) {\n    return (\n      <div className='evaluatorSpace'>\n        <div className='bigEmpty'>\n          { <CreateBox /> }\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className='evaluatorSpace'>\n      <ul className='evaluatorList UL'>\n        { submittedBoxes.map((boxState : BoxState, i : number) =>\n          <li className='LI' key={ boxState.__key }>\n            <MakeActiveContext.Provider value={ () => makeActive(i) }>\n              <SetBoxContext.Provider value={ (boxState : BoxState) => setBoxState(i, boxState) }>\n                <Box\n                  state={ boxState }\n                  isActive={ i === activeBoxIndex }\n                  \n                  // removeExpression={ () => removeExpression(i) }\n                />\n              </SetBoxContext.Provider>\n            </MakeActiveContext.Provider>\n          </li>\n          ) }\n          <div className='smallEmpty'>\n          { <CreateBox /> }\n          </div>\n      </ul>\n    </div>\n  )\n}\n\nexport function createEmptyExp (strategy : EvaluationStrategy, singleLetterNames : boolean) : EvaluationState {\n  return {\n    type : BoxType.EXPRESSION,\n    __key : Date.now().toString(),\n    expression : '',\n    ast : null,\n    history : [],\n    isRunning : false,\n    breakpoints : [],\n    timeoutID : undefined,\n    timeout : 10,\n    isExercise : false,\n    strategy,\n    singleLetterNames,\n    editor : {\n      placeholder : PromptPlaceholder.INIT,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}\n\nexport function createEmptyMacro (singleLetterNames : boolean) : MacroDefinitionState {\n  return {\n    type : BoxType.MACRO,\n    __key : Date.now().toString(),\n    macroName : '',\n    macroExpression : '',\n    singleLetterNames,\n    editor : {\n      placeholder : PromptPlaceholder.MACRO,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null\n    }\n  }\n}\n\nexport function createEmptyNote () : NoteState {\n  return {\n    type : BoxType.NOTE,\n    __key : Date.now().toString(),\n    note : '',\n    isEditing : true,\n    editor : {\n      placeholder : PromptPlaceholder.NOTE,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}","import React, { createContext, useContext } from 'react'\n\nimport BoxSpace from './BoxSpace'\nimport { HANDY_MACROS, getSavedMacros } from '../misc'\nimport { AppState } from '../AppTypes'\nimport { StateContext } from './DataInjector'\n\n\nexport const MacroTableContext = createContext({ ...HANDY_MACROS, ...getSavedMacros() })\n\nexport function EvaluatorSpace (props : {}) : JSX.Element {\n  const state : AppState = useContext(StateContext)\n  const {\n    macroTable,\n    submittedBoxes,\n    activeBoxIndex,\n  } : AppState = state\n\n\n  return (\n    <MacroTableContext.Provider value={ macroTable }>\n      <BoxSpace\n        submittedBoxes={ submittedBoxes } // 1 LEVEL\n        activeBoxIndex={ activeBoxIndex } // 1 LEVEL\n\n        // removeExpression={ this.onRemoveExpression } // to bude asi potreba az zbytek bude hotovej \n        // onEnter={ this.onEnter } // ten se presune dolu do Boxu\n        // onEditNote={ this.onEditNote } // zmeni se na onChangeActiveBox a isEditing se udela v Boxu\n      />\n    </MacroTableContext.Provider>\n  )\n}","import React, { Component } from 'react'\n\nimport './App.css'\n\nimport MenuBar from './components/MenuBar'\nimport MacroSpace from './components/MacroSpace'\nimport Settings from './components/Settings'\nimport { EvaluatorSpace } from './components/EvaluatorSpace'\nimport { MethodInjector } from './components/MethodInjector'\nimport { DataInjector } from './components/DataInjector'\nimport { DEFAULT_STATE, AppState, Screen, PromptPlaceholder, EvaluationStrategy, BoxState, BoxType, EvaluationState, MacroDefinitionState } from './AppTypes'\nimport { updateMacros } from './misc'\n\n\nexport default class App extends Component<{}, AppState> {\n  constructor (props : object) {\n    super(props)\n\n    this.setBoxState = this.setBoxState.bind(this)\n    this.addEmptyBox = this.addEmptyBox.bind(this)\n    this.changeActiveBox = this.changeActiveBox.bind(this)\n    this.changeActiveStrategy = this.changeActiveStrategy.bind(this)\n    this.changeActiveSingleLetterNames = this.changeActiveSingleLetterNames.bind(this)\n    this.getActiveStrategy = this.getActiveStrategy.bind(this)\n    this.getActiveSingleLetterNames = this.getActiveSingleLetterNames.bind(this)\n    this.addBox = this.addBox.bind(this)\n    this.removeMacro = this.removeMacro.bind(this)\n    this.defineMacro = this.defineMacro.bind(this)\n    this.createBoxFromURL = this.createBoxFromURL.bind(this)\n\n    this.state = DEFAULT_STATE\n\n    window.addEventListener('hashchange', this.createBoxFromURL)\n  }\n\n  componentDidMount () : void {\n    this.createBoxFromURL()\n  }\n\n  render () : JSX.Element {\n    const {\n      macroTable,\n      screen,\n    } : AppState = this.state\n\n    return (\n      <div className='app'>\n        <MenuBar\n          state={ this.state }\n          onImport={ (state : AppState) => this.setState(state) }\n          onScreenChange={(screen : Screen) => // mozna tohle zmenit nejakym patternem\n            this.setState({\n              ...this.state,\n              screen,\n            })\n          }\n         />\n\n        <Settings\n          getActiveSingleLetterNames={ this.getActiveSingleLetterNames }\n          getActiveStrategy={ this.getActiveStrategy }\n          changeActiveSingleLetterNames={ this.changeActiveSingleLetterNames }\n          changeActiveStrategy={ this.changeActiveStrategy }\n        />\n\n        {\n          screen === Screen.main ?\n          <DataInjector\n            SLI={ this.getActiveSingleLetterNames() }\n            strategy={ this.getActiveStrategy() }\n            state={ this.state }\n          >\n            <MethodInjector\n              addBox={ this.addBox }\n              addEmptyBox={ this.addEmptyBox }\n              changeActiveBox={ this.changeActiveBox }\n              defineMacro={ this.defineMacro }\n              setBoxState={ this.setBoxState }\n            >\n              <EvaluatorSpace />\n            </MethodInjector>\n          </DataInjector>\n          :\n          <MacroSpace macroTable={ macroTable } removeMacro={ this.removeMacro } />\n        }\n      </div>\n    )\n  }\n\n  createBoxFromURL () {\n    const hash : string = decodeURI(window.location.hash.substring(1))\n    const isExercise : boolean = hash.indexOf('exercise:') !== -1\n\n    const expression : string = isExercise ? hash.substring(9) : hash\n\n    if (expression === '') {\n      return\n    }\n\n    const box : BoxState = {\n      type : BoxType.EXPRESSION,\n      __key : Date.now().toString(),\n      expression : '',\n      ast : null,\n      history : [],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      isExercise : isExercise,\n      strategy : this.getActiveStrategy(),\n      singleLetterNames : this.getActiveSingleLetterNames(),\n      editor : {\n        placeholder : PromptPlaceholder.INIT,\n        content : expression,\n        caretPosition : expression.length,\n        syntaxError : null,\n      }\n    }\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ box ],\n      activeBoxIndex : 0,\n    })\n  }\n\n  setBoxState (index : number, boxState : BoxState) : void {\n    const { submittedBoxes } = this.state\n    \n    const expression : string = boxState.editor.content || (boxState as EvaluationState).expression // TODO: DIRTY DIRTY BIG TIME\n    const expPrefix : string = boxState.type === BoxType.EXPRESSION && (boxState as EvaluationState).isExercise ? 'exercise:' : '' \n    \n    history.pushState({}, \"page title?\", \"#\" + expPrefix + encodeURI(expression))\n\n    // TODO: doresit update URL\n\n    // TODO: consider immutability\n    submittedBoxes[index] = boxState\n\n    this.setState({\n      ...this.state,\n      submittedBoxes,\n    })\n\n  }\n\n  addEmptyBox (boxState : BoxState) : void {\n    const { submittedBoxes } = this.state\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ ...submittedBoxes, boxState ],\n      activeBoxIndex : Math.max(0, submittedBoxes.length),\n    })\n  }\n\n  addBox (boxState : BoxState) : void {\n    const { submittedBoxes } = this.state\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ ...submittedBoxes, boxState ],\n      activeBoxIndex : submittedBoxes.length\n    })\n  }\n\n  changeActiveBox (activeBoxIndex : number) : void {\n    this.setState({\n      ...this.state,\n      activeBoxIndex,\n    })\n  }\n\n  getActiveStrategy () : EvaluationStrategy {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    if (activeBoxIndex === -1) {\n      return JSON.parse(window.localStorage.getItem('strategy') || JSON.stringify(EvaluationStrategy.ABSTRACTION)) as EvaluationStrategy\n    }\n\n    const activeBoxState : BoxState = submittedBoxes[activeBoxIndex]\n\n    if (activeBoxState.type !== BoxType.EXPRESSION) {\n      return JSON.parse(window.localStorage.getItem('strategy') || JSON.stringify(EvaluationStrategy.ABSTRACTION)) as EvaluationStrategy\n    }\n\n    return (activeBoxState as EvaluationState).strategy\n  }\n\n  getActiveSingleLetterNames () : boolean {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    if (activeBoxIndex === -1) {\n      return JSON.parse(window.localStorage.getItem('SLI') || 'true')\n    }\n\n    const activeBoxState : BoxState = submittedBoxes[activeBoxIndex]\n\n    if (activeBoxState.type === BoxType.NOTE) {\n      return JSON.parse(window.localStorage.getItem('SLI') || 'true')\n    }\n\n    if (activeBoxState.type === BoxType.EXPRESSION) {\n      return (activeBoxState as EvaluationState).singleLetterNames\n    }\n\n    if (activeBoxState.type === BoxType.MACRO) {\n      return (activeBoxState as MacroDefinitionState).singleLetterNames\n    }\n\n    return JSON.parse(window.localStorage.getItem('SLI') || 'true') // to nikdy nenastane doufam\n  }\n\n  changeActiveStrategy (strategy : EvaluationStrategy) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n    // TODO: consider immutability\n    submittedBoxes[activeBoxIndex] = {\n      ...submittedBoxes[activeBoxIndex],\n      strategy,\n    }\n    \n    this.setState({\n      ...this.state,\n    })\n\n    window.localStorage.setItem('strategy', JSON.stringify(strategy))\n  }\n\n  changeActiveSingleLetterNames (enabled : boolean) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n    // TODO: consider immutability\n    submittedBoxes[activeBoxIndex] = {\n      ...submittedBoxes[activeBoxIndex],\n      singleLetterNames : enabled,\n    }\n\n    this.setState({\n      ...this.state\n    })\n\n    window.localStorage.setItem('SLI', JSON.stringify(enabled))\n  }\n\n  removeMacro (name : string) : void {\n    const { macroTable } = this.state\n    \n    const newMacroTable = { ...macroTable }\n    delete newMacroTable[name]\n\n    this.setState({\n      ...this.state,\n      macroTable : newMacroTable\n    })\n\n    updateMacros(newMacroTable)\n  }\n\n  defineMacro (name : string, definition : string) : void {\n    const { macroTable } = this.state\n\n    this.setState({\n      ...this.state,\n      macroTable : { ...macroTable, [name] : definition }\n    })\n\n    updateMacros({ ...macroTable, [name] : definition })\n  }\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}