{"version":3,"sources":["misc/index.ts","components/Controls.tsx","components/ReactPrinter.tsx","components/ReductionMessage.tsx","components/Step.tsx","components/Editor.tsx","components/TreeComparator.ts","components/Evaluator.tsx","components/MacroDefinition.tsx","components/Box.tsx","components/Note.tsx","components/MenuBar.tsx","components/BoxSpace.tsx","components/MacroSpace.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["trimStr","str","trim","HANDY_MACROS","FACT","FACCT","FIB","APPEND","LISTGREQ","LISTLESS","LISTGR","LISTEQ","QUICKSORT","INFLIST","REMOVENTH","NTH","LEN","GETNTH","MAP","REDUCE","APPLY","RANGE","LISTCOMPR","MOD","INFIX","require","Switch","Radio","Controls","props","isExercise","makeExercise","endExercise","react_default","a","createElement","id","className","checked","onChange","e","target","shape","ReactPrinter","tree","onClick","reduction","breakpoints","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","rendered","argument","visit","assertThisInitialized","lambda","accumulator","_this2","body","Lambda","context","isBreakpoint","set","Alpha","Array","from","conversions","some","conversion","identifier","name","args","Symbol","type","Beta","broken","Set","printMultiLambda","node","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","iterator","next","done","value","err","return","application","leftClassName","rightClassName","redex","left","right","Application","_this3","acc","churchNumber","_this4","Expansion","macro","_this5","variable","ASTVisitor","ReductionMessage","lastReduction","Eta","Step","stepRecord","addBreakpoint","children","strategy","ast","step","message","strategyToEvaluator","nextReduction","printer","print","ActionType","Editor","placeholder","content","caretPosition","syntaxError","isMarkDown","onContent","onEnter","onExecute","lines","split","length","concat","InputField","event","selectionEnd","replace","onKeyDown","shiftKey","ctrlKey","key","preventDefault","wrap","autoComplete","autoCorrect","autoCapitalize","spellCheck","rows","Math","max","ref","element","selectionStart","focus","TreeComparator","roots","translator","Map","equals","_roots","_roots2","toArray","slice","compare","createClass","_this$context","slicedToArray","backup","entries","Macro","ChurchNumeral","Variable","get","EvaluationStrategy","NORMAL","NormalEvaluator","APPLICATIVE","ApplicativeEvaluator","OPTIMISATION","OptimizeEvaluator","Evaluator","bind","onSubmitExpression","parseExpression","onExerciseStep","onStep","onRun","onStop","shouldBreak","createBoxFrom","_this$props","state","isActive","addBox","history","__key","isRunning","expression","singleLetterNames","_state$editor","editor","isNormalForm","onDoubleClick","makeActive","Editor_Editor","Controls_Controls","setBoxState","objectSpread","PromptPlaceholder","VALIDATE_MODE","EVAL_MODE","to","sequence","fn","result","i","mapLeftFromTo","toString","Step_Step","globalStrategy","BoxType","EXPRESSION","Date","now","clone","timeoutID","timeout","breakpoint","_this$props2","toConsumableArray","_this$props3","_this$props$state","console","log","_this$props4","None","exception","_this$props5","userAst","normal","perform","_this$props6","_this$props7","push","window","setTimeout","_this$props8","pop","find","add","clearTimeout","_this$props9","has","macroTable","singleLetterVars","tokens","tokenize","lambdaLetters","parse","PureComponent","MacroDefinition","defineMacro","macroName","macroExpression","_content$split$map","map","_content$split$map2","builtinMacros","Error","root","isValidName","isValidExpression","ReactMarkdown","Note","_props$state","note","_props$state$editor","isEditing","onSubmitNote","source","Box","Evaluator_Evaluator","MACRO","NOTE","MenuBar","onImport","onScreenChange","screen","dehydrated","submittedBoxes","dehydrateBox","dehydrate","link","data","Blob","URL","createObjectURL","createURL","JSON","stringify","Screen","main","macrolist","href","download","revokeObjectURL","accept","files","file","reader","FileReader","onload","box","_ref","config","hydrateBox","hydrate","readAsText","onFiles","htmlFor","BoxSpace","activeBoxIndex","addBoxControls","addEmptyBox","INIT","createEmptyExp","createEmptyMacro","boxState","_setBoxState","_x","apply","arguments","_makeActive","MacroSpace","removeMacro","_ref2","_ref3","_ref4","App","changeActiveBox","changeActiveStrategy","changeActiveSingleLetterNames","getActiveStrategy","getActiveSingleLetterNames","updateMacros","createBoxFromURL","localStorage","getItem","addEventListener","_this$state","MenuBar_MenuBar","setState","App_Switch","disabled","App_Radio","style","hash","decodeURI","location","substring","indexOf","index","_this$state2","expPrefix","pushState","encodeURI","_this$state3","_this$state4","_this$state5","activeBoxState","_this$state6","_this$state7","setItem","enabled","_this$state8","newMacroTable","definition","defineProperty","Component","Boolean","hostname","match","ReactDOM","render","App_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.46364d3e.chunk.js","sourcesContent":["import { MacroMap } from \"lambdulus-core\"\n\n\nexport function debounce (fn : Function, treshold : number)\n : [ (...args : Array<any>) => void, () => void ] {\n  let timer : number\n  \n  return [\n    function debounced (...args : Array<any>) : void {\n      window.clearTimeout(timer)\n\n      timer = window.setTimeout(() => {\n        fn(...args)\n      }, treshold)\n    },\n    function cancel () : void {\n      window.clearTimeout(timer)\n    }\n  ]\n}\n\nexport function getSavedMacros () : MacroMap {\n  return JSON.parse(window.localStorage.getItem('macrotable') || '{}')\n}\n\nexport function trimStr (str : string) : string {\n  return str.trim()\n}\n\nexport function mapLeftFromTo(\n  from : number,\n  to : number,\n  sequence : Array<any>,\n  fn : (...args : Array<any>) => any) {\n    const result : Array<any> = new Array(to - from + 1)\n\n    for (let e = 0, i = from; i <= to; ++i) {\n      result[e++] = fn(sequence[i], i)\n    }\n\n    return result\n  }\n\nexport const HANDY_MACROS : MacroMap = {\n  FACT : '(Y (λ f n . (<= n 1) 1 (* n (f (- n 1)))))',\n  FACCT : '(λ n . (Y (λ f n a . IF (= n 1) a (f (- n 1) (* n a)))) (- n 1) (n))',\n  FIB : '(Y (λ f n . (= n 0) 0 ((= n 1) 1 ( + (f (- n 1)) (f (- n 2))))))',\n  // SHORTLIST : 'CON 3 (CONS 5 (CONS 1 NIL))',\n  // LONGLIST :  '(CONS 3 (CONS 5 (CONS 1 (CONS 10 (CONS 7 (CONS 2 (CONS 4 (CONS 9 (CONS 4 (CONS 6 (CONS 8 NIL)))))))))))',\n  APPEND : 'Y (λ fn listA listB . IF (NULL listA) (listB) (CONS (FIRST listA) (fn (SECOND listA) listB)))',\n  LISTGREQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (>= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTLESS : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (< (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTGR : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (> (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTEQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  QUICKSORT : 'Y (λ fn list . IF (NULL list) (NIL) ( IF (NULL (SECOND list)) (list) ( APPEND (fn (LISTLESS (FIRST list) list)) ( APPEND (LISTEQ (FIRST list) list) (fn (LISTGR (FIRST list) list)) ) ) ) )',\n  INFLIST : '(λ n . (Y (λ x . (λ f s g . g f s) n x)))',\n  REMOVENTH : 'Y (λ fn list n . IF (= n 0) (SECOND list) (IF (NULL list) NIL (CONS (FIRST list) (fn (SECOND list) (- n 1) ) ) ) )',\n  NTH : 'Y (λ fn list n . IF (= n 0) (FIRST list) (IF (NULL (list)) NIL (fn (SECOND list) (- n 1)) ) )',\n  LEN : 'Y (λ fn list . IF (NULL list) (0) (+ 1 (fn (SECOND list) )) )',\n  GETNTH : '(λ end . (Y (λ f n i . (end i) (i) ( (= n 0) (Y (λ f a . (end a) (i) (f) ) ) (f (- n 1)) ) )) )',\n  MAP : '(λ fn l . (Y (λ f it . IF (NULL it) (NIL) (CONS (fn (FIRST it)) (f (SECOND it))) )) l )',\n  REDUCE : '(λ fn l init . Y (λ f it acc . IF (NULL it) (acc) (f (SECOND it) (fn (FIRST it) acc)) ) l init )',\n  APPLY : '(λ f args . Y (λ ff f l . (NULL l) (f) (ff (f (FIRST l)) (SECOND l)) ) f args )',\n  RANGE : '(λ m n . Y (λ f e . (= e n) (CONS e NIL) (CONS e (f (+ e 1))) ) m )',\n  LISTCOMPR : '(λ args . APPLY (λ op in rng cond . Y (λ f l . (NULL l) (NIL) ( (cond (FIRST l)) (CONS (op (FIRST l)) (f (SECOND l))) (CONS (FIRST l) (f (SECOND l))) ) ) rng ) args )',\n  MOD : '(λ n m . (n (λ n . (= n (- m 1)) (0) (+ n 1)) (0)) )',\n  INFIX : 'APPLY (λ l op r . op l r)',\n}","import React, { ChangeEvent } from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\n\nimport 'pretty-checkbox'\nimport '../styles/Controls.css'\n\n\nexport interface ControlsProps {\n  isExercise : boolean\n  makeExercise () : void\n  endExercise () : void\n}\n\n// TODO: maybe not really needed or rename it accordingly\nexport default function Controls (props : ControlsProps) : JSX.Element {\n  const {\n    isExercise,\n    makeExercise,\n    endExercise,\n  } : ControlsProps = props\n\n  return (\n    <div id=\"controls\">\n      <div>\n        <Switch\n          className='exerciseSwitch'\n          checked={ isExercise }\n          onChange={ (e : ChangeEvent<HTMLInputElement>) =>\n            e.target.checked ? makeExercise() : endExercise()\n          }\n          shape=\"fill\"\n        >\n          Exercise\n        </Switch>\n      </div>\n    </div>\n  )\n}","import React from 'react'\n\nimport { ASTVisitor, Lambda, Variable, Beta, AST, Application, ChurchNumeral, Expansion, Macro, ASTReduction, None, Alpha } from \"lambdulus-core\";\n\nimport { Breakpoint } from \"./Evaluator\";\n\n\nexport default class ReactPrinter extends ASTVisitor {\n  private rendered : JSX.Element | null = null\n  private argument : Variable | null = null\n\n  private printMultiLambda (lambda : Lambda, accumulator : JSX.Element) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.body.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.body.argument)) {\n        className += ' breakpoint'\n      }\n\n      // bug@highlight-alpha\n      let set = false\n      if (this.reduction instanceof Alpha\n            &&\n          Array.from(this.reduction.conversions).some((conversion : Lambda) => {\n            return conversion.identifier === lambda.body.identifier\n          })\n          ) {\n              this.argument = context\n              set = true\n      }\n\n      // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n      let argument : Variable | null = this.argument\n      if (this.argument !== lambda.body.argument\n          &&\n          this.argument !== null\n          &&\n          this.argument.name() === lambda.body.argument.name()) {\n        this.argument = null\n      } // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n\n      // TODO: same here\n      if (this.argument\n          &&\n          this.argument.name() === context.name()) {\n            className += ' substitutedArg'\n        }\n\n      const args : JSX.Element = (\n        <span className='arguments'>\n          { accumulator } {' '}\n          <span\n            className={ className }\n            onClick={ () => {\n              (context as any).identifier = Symbol()\n              this.onClick({ type : Beta, context, broken : new Set }) }\n            }\n          >\n            { context.name() }\n          </span>\n        </span>\n      )\n      \n      this.printMultiLambda(lambda.body, args)\n      if (set === true) {\n        this.argument = null\n      }\n      this.argument = argument // TO JE KVULI FIXU MULTILAMBDA FACCT 3 beta redukce nad shadowingem\n    }\n    else {\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n      this.rendered = accumulator\n\n      this.rendered = (\n        <span className='function'>\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          { accumulator } . { body }\n          )\n        </span>\n      )\n    }\n  }\n\n  isBreakpoint (node : AST) : boolean {\n    for (const breakpoint of this.breakpoints) {\n      if (breakpoint.context.identifier === node.identifier) {\n        return true\n      }\n    }\n    return false\n  }\n\n  constructor (\n    public readonly tree : AST,\n    private readonly onClick : (breakpoint : Breakpoint) => void,\n    private readonly reduction : ASTReduction,\n    private readonly breakpoints : Array<Breakpoint>,\n  ) {\n    super()\n    this.tree.visit(this)\n  }\n\n  print () : JSX.Element | null {\n    return this.rendered\n  }\n\n  // TODO: little bit refactored, maybe keep going\n  onApplication (application: Application) : void {\n    let leftClassName : string = 'left'\n    let rightClassName : string = 'right'\n    let set : boolean = false\n    let redex : AST | null = null\n\n    if (this.reduction instanceof Beta) {\n      redex = this.reduction.redex\n    }\n    // else if (this.reduction instanceof Expansion) {\n    //   redex = this.reduction.target\n    // } // to asi neni uplne potreba tady\n\n    if (redex !== null\n          &&\n        redex.identifier === application.identifier // tohle je asi trosku useles\n          &&\n        redex === application\n      ) {\n        leftClassName += ' redex'\n        rightClassName += ' redex'\n\n        // TODO: this is probably not good and should be done other way\n\n        if (application.left instanceof Lambda) {\n          this.argument = application.left.argument\n          set = true\n        }\n    }\n\n    if (application.right instanceof Application) {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3 a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>( { this.rendered } )</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n    else {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      // tohle delam proto, ze se nesmi vypnout this.argument u libovolne aplikace, jenom u te ktera ho setnula\n      // priklad + 2 3a krokuj - zakomentuj a krokuj znovu Y se bude chovat spatne hned v prvnich krocich\n      if (set) {\n        this.argument = null\n      }\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>{ this.rendered }</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onLambda (lambda: Lambda) : void {\n    // TODO: this also seems not so elegant and clean\n    let argument : Variable | null = this.argument\n    if (this.argument !== lambda.argument\n        &&\n        this.argument !== null\n        &&\n        this.argument.name() === lambda.argument.name()) {\n      this.argument = null\n    }\n\n\n    // multilambda\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      // TODO: same here\n      if (this.argument\n        &&\n        this.argument.name() === context.name()) {\n          className += ' substitutedArg'\n      }\n\n      const acc : JSX.Element = (\n        <span\n          className={ className }\n          onClick={ () => {\n            (context as any).identifier = Symbol()\n            this.onClick({ type : Beta, context, broken : new Set }) }\n          }\n        >\n          { lambda.argument.name() }\n        </span>\n      )\n\n      this.printMultiLambda(lambda, acc)\n    }\n    else {\n      const context : Variable = lambda.argument\n\n      lambda.argument.visit(this)\n      const args : JSX.Element | null = this.rendered\n\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      this.rendered = (\n        <span className='function' >\n          (\n          <span\n            className='lambda'\n            >\n              λ { ' ' }\n          </span>\n          <span\n            className={ className }\n            onClick={ () => {\n              (context as any).identifier = Symbol()              \n              this.onClick({ type : Beta, context, broken : new Set }) }\n            }\n          >\n            { args } { ' ' }\n          </span>\n          . { body } \n          )\n        </span>\n      )\n    }\n\n    if (argument !== null) {\n      this.argument = argument\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onChurchNumeral (churchNumber: ChurchNumeral) : void {\n    let className : string = 'churchnumeral'\n    const redex : AST | null = this.reduction instanceof Expansion ? this.reduction.target : null\n\n    if (redex !== null\n          &&\n        redex.identifier === churchNumber.identifier\n          &&\n        redex === churchNumber\n      ) {\n        className += ' redex'\n    }\n\n    if (this.isBreakpoint(churchNumber)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => {\n          (churchNumber as any).identifier = Symbol()\n          this.onClick({ type: Expansion, context : churchNumber, broken : new Set }) }\n        }\n      >\n        { churchNumber.name() }\n      </span>\n    )\n  }\n\n  // TODO: little bit refactored, maybe keep going  \n  onMacro (macro: Macro) : void {\n    let className = 'macro'\n    const redex : AST | null = this.reduction instanceof Expansion ? this.reduction.target : null\n\n    if (redex !== null\n          &&\n        redex.identifier === macro.identifier\n          &&\n        redex === macro\n        ) {\n      className += ' redex'\n    }\n\n    if (this.isBreakpoint(macro)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => {\n          (macro as any).identifier = Symbol()\n          this.onClick({ type: Expansion, context : macro, broken : new Set }) }\n        }\n      >\n        { macro.name() }\n      </span>\n    )\n  }\n  \n  onVariable (variable: Variable): void {\n    // TODO: same here - not so clean\n    let className : string = 'variable'\n\n    if (this.argument\n        &&\n        this.argument.name() === variable.name()) {\n          className += ' substitutedArg'\n      }\n\n    this.rendered = <span className={ className } >{ variable.name() }</span>\n  }\n}","import React from 'react'\nimport { ASTReduction, Beta, Alpha, Expansion } from 'lambdulus-core';\nimport { Eta } from 'lambdulus-core/dist/reductions/eta';\n\n\ninterface ReductionMessageProperties {\n  lastReduction : ASTReduction | null\n}\n\nexport default function ReductionMessage (props : ReductionMessageProperties) : JSX.Element {\n  const { lastReduction } = props\n\n  if (lastReduction === null) {\n    return null as any\n  }\n\n  if (lastReduction instanceof Beta) {\n    return (\n      <p className='lastReduction'>\n        β reduction\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Alpha) {\n    return (\n      <p className='lastReduction'>\n        α conversion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Expansion) {\n    return (\n      <p className='lastReduction'>\n        Macro expansion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Eta) {\n    return (\n      <p className='lastReduction'>\n        η conversion\n      </p>\n    )\n  }\n\n  else {\n    return null as any\n  }\n  \n}","import React from 'react'\nimport { AST, Beta, Expansion, NormalEvaluator, ASTReduction, Alpha } from 'lambdulus-core'\n\nimport '../styles/Step.css'\n\nimport { Breakpoint, StepRecord, _Evaluator, strategyToEvaluator } from './Evaluator'\nimport ReactPrinter from './ReactPrinter'\nimport ReductionMessage from './ReductionMessage'\nimport { EvaluationStrategy, } from '../App';\n\n\ninterface StepProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n  strategy : EvaluationStrategy\n}\n\nexport default function Step (props : StepProperties) : JSX.Element | null {\n  const { stepRecord, addBreakpoint, breakpoints, children, strategy } = props\n  const { ast : tree, lastReduction, step, message } = stepRecord\n\n  if (tree === null) {\n    return null\n  }\n\n  // TODO: tohle se musi fixnout\n  // validni redex se musi dostat ze statu a ne si ho tedka vymyslet sam\n\n  // let redex : AST | null  = null\n  const evaluator : _Evaluator = new (strategyToEvaluator(strategy) as any)(tree)\n  const reduction : ASTReduction = evaluator.nextReduction\n  // if (normal.nextReduction instanceof Beta) {\n  //   redex = normal.nextReduction.redex\n  // }\n  \n  // if (normal.nextReduction instanceof Expansion) {\n  //   redex = normal.nextReduction.target\n  // }\n\n  // if (normal.nextReduction instanceof Alpha) {\n    \n  // }\n\n  const printer : ReactPrinter = new ReactPrinter(tree, addBreakpoint, reduction, breakpoints)\n\n  return (\n    <span className='step'>\n      <ReductionMessage lastReduction={ lastReduction } />\n      <div className='inlineblock' >\n        <p className='stepNumber' >\n          { step } :\n        </p>\n        { printer.print() }\n        { children }\n        {\n          stepRecord.message === '' ?\n            null\n            :\n            <p className='stepMessage'>\n              { stepRecord.message }\n            </p>\n        }\n      </div>\n    </span>\n  )\n}","import React, { ChangeEvent, useState, SetStateAction, Dispatch, KeyboardEvent } from 'react'\n\nimport '../styles/Editor.css'\n\n// import { EvaluationStrategy } from '../App'\n\n\nexport enum ActionType {\n  ENTER_EXPRESSION = 'Enter Expression',\n  ENTER_EXERCISE = 'Enter Exercise',\n  NEXT_STEP = 'Next Step',\n  RUN = 'Run',\n  ENTER_MD = 'Enter MarkDown',\n}\n\ninterface EditorProperties {\n  placeholder: string\n  content : string\n  caretPosition : number\n  syntaxError : Error | null\n  isMarkDown : boolean\n  \n  onContent (content : string, caretPosition : number) : void\n  onEnter () : void\n  onExecute () : void\n  // onReset () : void\n}\n\nexport default function Editor (props : EditorProperties) : JSX.Element {\n  const {\n    placeholder,\n    content,\n    caretPosition,\n    syntaxError,\n    isMarkDown,\n\n    onContent,\n    onEnter,\n    onExecute,\n  } : EditorProperties = props\n  const lines : number = content.split('\\n').length\n\n  const onChange = (event : ChangeEvent<HTMLTextAreaElement>) => {\n    let { target : { value : content } } : { target : { value : string } } = event\n    const caretPosition : number = event.target.selectionEnd\n\n    content = content.replace(/\\\\/g, 'λ')\n\n    onContent(content, caretPosition)\n  }\n\n  // TODO: Editor should not decide that - it should only implement onEnter onShiftEnter onCtrlEnter\n  const onKeyDown = (event : KeyboardEvent<HTMLTextAreaElement>) => {\n    if ( ! event.shiftKey && ! event.ctrlKey && event.key === 'Enter') {\n      \n      if (isMarkDown) {\n        return\n      }\n\n      event.preventDefault()\n      onEnter()\n    }\n\n    if (event.shiftKey && event.key === 'Enter' && isMarkDown) {\n      event.preventDefault()\n      onEnter()\n    }\n    if (event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onExecute()\n    }\n\n    // TODO: not yet\n    // if (event.ctrlKey && event.key === 'r') {\n    //   event.preventDefault()\n    //   onReset()\n    // }\n  }\n\n  return (\n    <div className='editorContainer'>\n      {\n        syntaxError ?\n        <p className='editorError'>\n          { `${syntaxError}` }\n        </p>\n        :\n        null\n      }\n\n      <div className=\"editor\">\n        <InputField\n          placeholder={ placeholder }\n          content={ content }\n          lines={ lines }\n          caretPosition={ caretPosition }\n          onChange={ onChange }\n          onKeyDown={ onKeyDown }\n        />\n      </div>\n    </div>\n  )\n}\n\ninterface InputProps {\n  placeholder : string\n  content : string\n  lines : number\n  caretPosition : number\n  onChange (event : ChangeEvent<HTMLTextAreaElement>) : void\n  onKeyDown (event : KeyboardEvent<HTMLTextAreaElement>) : void\n}\n\nfunction InputField (props : InputProps) : JSX.Element {\n  const { placeholder, content, lines, onChange, onKeyDown, caretPosition } : InputProps = props\n\n  return (\n    <textarea\n      className='prompt'\n      onKeyDown={ onKeyDown }\n      onChange={ onChange }\n      value={ content }\n      placeholder={ placeholder }\n      wrap='hard'\n      autoComplete=\"off\"\n      autoCorrect=\"off\"\n      autoCapitalize=\"off\"\n      spellCheck={ false }\n      rows={ Math.max(lines, 1) } \n      ref={ (element : HTMLTextAreaElement) => {\n        if (element !== null) {\n          element.selectionStart = caretPosition\n          element.selectionEnd = caretPosition\n          element.focus()\n        }\n      } }\n    />\n  )\n}","import { AST, Lambda, Application, Macro, ChurchNumeral, Variable } from \"lambdulus-core\";\n\n///////////////////////////////////////////////////////////////////////////////////////\n\ntype Pair<T> = [T, T]\ntype Triple<T> = [T, T, T]\n\n\n// TODO: fix the public equals interface, maybe public get and private set?\n// maybe implement public get method and bool itself leave private?\n//\n// first I need more trees, I need the previous AST\nexport class TreeComparator {\n  private translator : Map<string, string> = new Map\n  public equals : boolean = true\n  private context : Pair<AST>\n\n  constructor (readonly roots : Pair<AST> ) {\n    [ ...this.context ] = roots\n    // TODO: I need to compare roots first\n    this.compare()\n  }\n\n  compare () : void {\n    /**\n    TODO: compare need to compare both children if got\n    if one of them is incorrect\n    then solve that problem\n    if both of them is incorrect\n    then solve both problems and then decide how both come together\n\n    then I have an instance of knowledge system\n    I can fire up that system in this context (this node with invalid children)\n    system will need to get instance of something to call methods on\n    because system needs to ask questions - like, is this possible,\n    is this error applicable?\n    so instead of human, code will look up the AST and answer the questions\n    so it will be some kind of class which is able to observe all 3 ASTs at the same time\n    it will also have implemented query methods,\n    probably wont be many of them, just few\n    **/\n    \n    const [ left, right ] : Pair<AST> = this.context\n\n    if (left instanceof Lambda && right instanceof Lambda) {\n      const backup : Map<string, string> = new Map(this.translator.entries())\n\n      this.translator.set(left.argument.name(), right.argument.name())\n      this.context = [ left.right, right.right ]\n      this.compare()\n\n      this.translator = backup\n    }\n    else if (left instanceof Application && right instanceof Application) {\n      this.context = [ left.left, right.left ]\n      this.compare()\n\n      if ( ! this.equals) {\n        return\n      }\n\n      this.context = [ left.right, right.right ]\n      this.compare()\n    }\n    else if (left instanceof Macro && right instanceof Macro) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof ChurchNumeral && right instanceof ChurchNumeral) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof Variable && right instanceof Variable) {\n      this.equals = this.translator.get(left.name()) === right.name()\n    }\n    else {\n      this.equals = false\n    }\n  }\n}","import React, { PureComponent } from 'react'\nimport {\n  AST,\n  ASTReduction,\n  None,\n  NormalEvaluator,\n  Beta,\n  Lambda,\n  Variable,\n  Expansion,\n  ChurchNumeral,\n  Macro,\n  Token,\n  tokenize,\n  parse,\n  ApplicativeEvaluator,\n  OptimizeEvaluator,\n  MacroMap,\n} from \"lambdulus-core\"\n\nimport '../styles/Evaluator.css'\n\nimport Controls from './Controls'\nimport Step from './Step'\nimport { mapLeftFromTo } from '../misc'\nimport { BoxType, BoxState } from './Box'\nimport { EvaluationStrategy, PromptPlaceholder } from '../App'\nimport Editor, { ActionType } from './Editor'\nimport { TreeComparator } from './TreeComparator'\n\n\nexport type _Evaluator = NormalEvaluator | ApplicativeEvaluator | OptimizeEvaluator\n\nexport function strategyToEvaluator (strategy : EvaluationStrategy) : _Evaluator {\n  switch (strategy) {\n    case EvaluationStrategy.NORMAL:\n      return NormalEvaluator as any\n \n    case EvaluationStrategy.APPLICATIVE:\n      return ApplicativeEvaluator as any\n\n    case EvaluationStrategy.OPTIMISATION:\n      return OptimizeEvaluator as any\n  }\n}\n\nexport type Breakpoint = {\n  type : ASTReduction,\n  context : AST,\n  broken : Set<AST>,\n}\n\nexport interface StepRecord {\n  ast : AST\n  lastReduction : ASTReduction | null\n  step : number\n  message : string\n  isNormalForm : boolean\n}\n\nexport interface EvaluationState {\n  __key : string\n  type : BoxType\n  expression : string\n  ast : AST | null\n  history : Array<StepRecord>\n  isRunning : boolean\n  breakpoints : Array<Breakpoint>\n  timeoutID : number | undefined\n  timeout : number\n  isExercise : boolean\n  strategy : EvaluationStrategy\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\ninterface EvaluationProperties {\n  state : EvaluationState\n  globalStrategy : EvaluationStrategy\n  isActive : boolean\n  macroTable : MacroMap\n\n  setBoxState (state : EvaluationState) : void\n  makeActive () : void\n  addBox (boxState : BoxState) : void\n}\n\nexport default class Evaluator extends PureComponent<EvaluationProperties> {\n  constructor (props : EvaluationProperties) {\n    super(props)\n\n    this.addBreakpoint = this.addBreakpoint.bind(this)\n    this.onContent = this.onContent.bind(this)\n    this.onSubmitExpression = this.onSubmitExpression.bind(this)\n    this.parseExpression = this.parseExpression.bind(this)\n    this.onEnter = this.onEnter.bind(this)\n    this.onExerciseStep = this.onExerciseStep.bind(this)\n    this.onStep = this.onStep.bind(this)\n    this.onExecute = this.onExecute.bind(this)\n    this.onRun = this.onRun.bind(this)\n    this.onStop = this.onStop.bind(this)\n    this.shouldBreak = this.shouldBreak.bind(this)\n    this.createBoxFrom = this.createBoxFrom.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { state, isActive, addBox } : EvaluationProperties = this.props\n    const {\n      __key,\n      history,\n      isRunning,\n      breakpoints,\n      isExercise,\n      strategy,\n      singleLetterNames,\n      expression,\n      editor : {\n        caretPosition,\n        content,\n        placeholder,\n        syntaxError,\n      },\n    } : EvaluationState = state\n\n    let className : string = 'box boxEval'\n    const { isNormalForm } = history.length ? history[history.length - 1] : { isNormalForm : false }\n\n    if (expression === '') {\n      return (\n        <div className={ `${className} ${isActive ? '' : ' inactiveBox'}` } onDoubleClick={ this.props.makeActive } >\n          {/* <p className='emptyStep'>Empty expression box.</p> */}\n          {\n            isActive ?\n              (\n                <Editor\n                  placeholder={ placeholder } // data\n                  content={ content } // data\n                  caretPosition={ caretPosition } // data\n                  syntaxError={ syntaxError } // data\n                  isMarkDown={ false } // data\n\n                  onContent={ this.onContent } // fn\n                  onEnter={ this.onEnter } // fn // tohle asi bude potreba\n                  onExecute={ this.onExecute } // fn // tohle asi bude potreba\n                />\n              )\n              :\n              (\n                <p className='inactiveMessage'>\n                  Collapsing { Math.max(0, history.length - 1) } { history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n                </p>\n              )\n          }\n        </div>\n      )\n    }\n\n    const stepRecord : StepRecord = history[history.length - 1]\n\n    if (isExercise) {\n      className += ' boxExercise'\n    }\n\n    if ( ! isActive) {\n      return (\n        <div className={ className + ' inactiveBox' } onDoubleClick={ this.props.makeActive } >\n          <ul className='UL'>\n            <li key={ 0 } className='activeStep LI'>\n              <Step\n                breakpoints={ breakpoints }\n                addBreakpoint={ () => {} } // blank function - NOOP\n                stepRecord={ history[0] }\n                strategy={ this.props.globalStrategy }\n              >\n                <i\n                  className=\"hiddenIcon fas fa-pencil-alt\"\n                  onClick={ () => addBox(this.createBoxFrom(history[0])) }\n                />\n              </Step>\n            </li>\n          </ul>\n          <p className='inactiveMessage'>\n            Collapsing { history.length - 1 } { history.length === 2 ? 'step' : 'steps' }. Double click to activate this box.\n          </p>\n        </div>\n      )\n    }\n\n    return (\n      <div className={ className }>\n        <Controls\n          isExercise={ isExercise }\n          makeExercise={ () =>\n            this.props.setBoxState({\n              ...state,\n              isExercise : true,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.VALIDATE_MODE,\n              },\n            })\n          }\n          endExercise={ () =>\n            this.props.setBoxState({\n              ...state,\n              isExercise : false,\n              editor: {\n                ...state.editor,\n                placeholder : PromptPlaceholder.EVAL_MODE,\n              },\n            })\n          }\n        />\n        <ul className='UL'>\n          {\n            mapLeftFromTo(0, history.length - 2, history, (stepRecord : StepRecord, i : Number) =>\n              <li key={ i.toString() } className='inactiveStep LI' >\n                <Step\n                  breakpoints={ breakpoints }\n                  addBreakpoint={ () => {} }\n                  stepRecord={ stepRecord }\n                  strategy={ this.props.globalStrategy }\n                >\n                  <i\n                    className=\"hiddenIcon fas fa-pencil-alt\"\n                    onClick={ () => addBox(this.createBoxFrom(stepRecord)) }\n                  />\n                </Step>\n              </li>)\n          }\n          <li key={history.length - 1} className='activeStep LI'>\n            <Step\n              breakpoints={ breakpoints }\n              addBreakpoint={ this.addBreakpoint }\n              stepRecord={ history[history.length - 1] }\n              strategy={ this.props.globalStrategy }\n            >\n                <i\n                  className=\"hiddenIcon fas fa-pencil-alt\"\n                  onClick={ () => addBox(this.createBoxFrom(history[history.length - 1])) }\n                />\n            </Step>\n          </li>\n        </ul>\n\n        {\n          isNormalForm ?\n            null\n            :\n            (\n              <Editor\n                placeholder={ placeholder } // data\n                content={ content } // data\n                caretPosition={ caretPosition } // data\n                syntaxError={ syntaxError } // data\n                isMarkDown={ false } // data\n\n                onContent={ this.onContent } // fn\n                onEnter={ this.onEnter } // fn // tohle asi bude potreba\n                onExecute={ this.onExecute } // fn // tohle asi bude potreba\n              />\n            )\n        }\n\n        \n\n      </div>\n    )\n  }\n\n  createBoxFrom (stepRecord : StepRecord) : EvaluationState {\n    const { state } : EvaluationProperties = this.props\n    const {\n      strategy,\n      singleLetterNames,\n    } : EvaluationState = state\n    const { ast } = stepRecord\n\n    return {\n      type : BoxType.EXPRESSION,\n      __key : Date.now().toString(),\n      expression : ast.toString(),\n      ast : ast.clone(),\n      history : [ {\n        ast : ast.clone(),\n        lastReduction : null,\n        step : 0,\n        message : '',\n        isNormalForm : false,\n      } ],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      isExercise : false,\n      strategy,\n      singleLetterNames,\n      editor : {\n        placeholder : PromptPlaceholder.EVAL_MODE,\n        content : '',\n        caretPosition : 0,\n        syntaxError : null,\n      }\n    }\n  }\n\n  addBreakpoint (breakpoint : Breakpoint) : void {\n    let { state, setBoxState } : EvaluationProperties = this.props\n  \n    setBoxState({\n      ...state,\n      breakpoints : [ ...state.breakpoints, breakpoint ],\n    })\n  }\n\n  onContent (content : string, caretPosition : number) : void {\n    const { state, setBoxState } = this.props\n\n    setBoxState({\n      ...state,\n      editor : {\n        ...state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    } )\n    // this.updateURL(expression) // tohle musim nejak vyresit - mozna ta metoda setBoxState v APP bude checkovat propisovat do URL\n  }\n\n  onEnter () : void {\n    const { expression, isExercise, editor : { content } } = this.props.state\n\n    if (expression === '') {\n      this.onSubmitExpression()\n    }\n    else if (content !== '' && isExercise) {\n      this.onExerciseStep()\n    }\n    else if (content === '' && (! isExercise)) {\n      this.onStep()\n    }\n    else {\n      console.log('TODO: deje se neco co si neosetril')\n    }\n  }\n\n  onSubmitExpression () : void {\n    const { state, setBoxState } = this.props\n    // TODO: maybe cancel and clear URL only after succsessful parsing\n    // this.cancelUpdate() // deal with it later\n    \n    const {\n      editor : { content },\n    } = state\n\n    // window.location.hash = encodeURI(expression)\n    // history.pushState({}, \"\", \"#\" + encodeURI(expression)) // TODO: deal with later\n\n    try {\n      const ast : AST = this.parseExpression(content)\n      // history.pushState({}, \"\", \"#\" + encodeURI('')) // // TODO: later\n\n      setBoxState({\n        ...state,\n        ast,\n        expression : content,\n        history : [ {\n          ast : ast.clone(),\n          lastReduction : None,\n          step : 0,\n          message : '',\n          isNormalForm : false\n        } ],\n        editor : {\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.EVAL_MODE,\n          syntaxError : null,\n        }\n      })\n\n    } catch (exception) {\n      // this.updateURL(expression) // TODO: later\n      // console.log(exception)\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : exception.toString(),\n        }\n      })\n    }\n  }\n\n  onExerciseStep () {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    try {\n      const userAst : AST = this.parseExpression(content)\n      const stepRecord : StepRecord = history[history.length - 1]\n      const { isNormalForm, step } = stepRecord\n      let { ast, lastReduction } = stepRecord\n      ast = ast.clone()\n\n      if (isNormalForm) {\n        // TODO: do something about it\n        // say user - there are no more steps and it is in normal form        \n        // TODO: consider immutability\n        stepRecord.message = 'No more steps available. Expression is in normal form.'\n\n        setBoxState({\n          ...state,\n        })\n\n        return\n      }\n    \n      const normal : _Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n      lastReduction = normal.nextReduction\n    \n      if (normal.nextReduction instanceof None) {\n        // TODO: refactor PLS - update history\n        // TODO: say user it is in normal form and they are mistaken\n        stepRecord.isNormalForm = true\n        stepRecord.message = 'Expression is already in normal form.'\n        \n        setBoxState({\n          ...state,\n        })\n        \n        return\n      }\n    \n      ast = normal.perform()\n    \n      let message : string = ''\n      const comparator : TreeComparator = new TreeComparator([ userAst, ast ])\n      if (comparator.equals) {\n        ast = userAst\n        message = 'Correct.'\n      }\n      else {\n        // TODO: say user it was incorrect\n        // TODO: na to se pouzije uvnitr EvaluatorState prop messages nebo tak neco\n        console.log('Incorrect step')\n        message = `Incorrect step. ${content}`\n      }\n\n      setBoxState({\n        ...state,\n        history : [ ...history, { ast, lastReduction, step : step + 1, message, isNormalForm : false } ],\n        editor : {\n          ...state.editor,\n          content : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.VALIDATE_MODE,\n          syntaxError : null,\n        }\n      })\n    } catch (exception) {\n      // TODO: print syntax error\n      // TODO: do it localy - no missuse of onSubmit\n\n      // TODO: print syntax error\n    }\n  }\n\n  onStep () : void {\n    const { state, setBoxState } = this.props\n    const { strategy, history, editor : { content } } = state\n    const stepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { ast, lastReduction } = stepRecord\n    ast = ast.clone()\n  \n    if (isNormalForm) {\n      return\n    }\n\n    const normal : _Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n  \n    if (normal.nextReduction instanceof None) {\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n      \n      setBoxState({\n        ...state,\n      })\n      \n      return\n    }\n  \n    ast = normal.perform()\n  \n    setBoxState({\n      ...state,\n      history : [ ...history, { ast, lastReduction, step : step + 1, message : '', isNormalForm : false } ],\n\n    })\n  }\n\n  onExecute () : void {\n    const { state, setBoxState } = this.props\n    const { isRunning, isExercise } = state\n\n    if (isExercise) {\n      // TODO: exercises can not be run - some message to user???\n      return\n    }\n\n    if (isRunning) {\n      this.onStop()\n    }\n    else {\n      const { timeout, history } = state\n      const stepRecord = history[history.length - 1]\n  \n      if (stepRecord.isNormalForm) {\n        return\n      }\n      \n      const { ast, step, lastReduction, isNormalForm, message } = stepRecord\n      history.push(history[history.length - 1])\n      history[history.length - 2] = { ast : ast.clone(), step, lastReduction, message : 'Skipping some steps...', isNormalForm }\n\n      setBoxState({\n        ...state,\n        isRunning : true,\n        timeoutID : window.setTimeout(this.onRun, timeout),\n      })\n    }\n  }\n\n  onRun () : void {\n    const { state, setBoxState } = this.props\n    const { strategy } = state\n    let { history, isRunning, breakpoints, timeoutID, timeout } = state\n    const stepRecord : StepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { lastReduction } = stepRecord\n\n    if ( ! isRunning) {\n      return\n    }\n    \n    if (isNormalForm) {\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    let { ast } = stepRecord\n    const normal : _Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n    \n    if (normal.nextReduction instanceof None) {\n      // TODO: consider immutability\n      history.pop()\n      history.push({\n        ast,\n        lastReduction : stepRecord.lastReduction,\n        step,\n        message : 'Expression is in normal form.',\n        isNormalForm : true\n      })\n  \n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    // TODO: maybe refactor a little\n    const breakpoint : Breakpoint | undefined = breakpoints.find(\n      (breakpoint : Breakpoint) =>\n        this.shouldBreak(breakpoint, normal.nextReduction)\n    )\n\n    if (breakpoint !== undefined) {\n      // TODO: consider immutability\n      if (normal.nextReduction instanceof Expansion) {\n        breakpoint.broken.add(normal.nextReduction.target)\n      }\n      if (normal.nextReduction instanceof Beta && normal.nextReduction.redex.left instanceof Lambda) {\n        breakpoint.broken.add(normal.nextReduction.redex.left.argument)\n      }\n\n      window.clearTimeout(timeoutID)\n\n      setBoxState({\n        ...state,\n        isRunning : false,\n        timeoutID,\n      })\n\n      return\n    }\n  \n    ast = normal.perform()\n    // steps++\n\n    history[history.length - 1] = { ast, lastReduction, step : step + 1, message : '', isNormalForm }\n    \n    setBoxState({\n      ...state,\n      timeoutID : window.setTimeout(this.onRun, timeout)\n    })\n  }\n\n  onStop () : void {\n    const { state, setBoxState } = this.props\n    const { timeoutID } = state\n  \n    window.clearTimeout(timeoutID)\n  \n    setBoxState({\n      ...state,\n      isRunning : false,\n      timeoutID : undefined\n    })\n  }\n\n  // TODO: breakpointy se pak jeste musi predelat\n  shouldBreak (breakpoint : Breakpoint, reduction : ASTReduction) : boolean {\n    // if (reduction instanceof (breakpoint.type as any)\n    //     && reduction instanceof Beta && breakpoint.context instanceof Lambda\n    //     && reduction.target.identifier === breakpoint.context.body.identifier\n    //   ) {\n    //     return true\n    // }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Beta && breakpoint.context instanceof Variable\n        && reduction.redex.left instanceof Lambda\n        && reduction.redex.left.argument.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.redex.left.argument)\n    ) {\n      return true\n    }\n\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof ChurchNumeral\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof Macro\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n  \n    return false\n  }\n\n  // THROWS Exceptions\n  parseExpression (expression : string) : AST {\n    const { macroTable } = this.props\n    const { singleLetterNames : singleLetterVars } = this.props.state\n\n    const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n    const ast : AST = parse(tokens, macroTable)\n\n    return ast\n  }\n}","import React from 'react'\n\nimport { BoxType, BoxState } from './Box'\nimport { trimStr } from '../misc'\nimport Editor from './Editor'\nimport { tokenize, parse, AST, Token, Variable, builtinMacros } from 'lambdulus-core'\n\n\nexport interface MacroDefinitionState {\n  __key : string\n  type : BoxType\n  macroName : string\n  macroExpression : string\n  singleLetterNames : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport interface MacroDefinitionProperties {\n  state : MacroDefinitionState\n  setBoxState (boxState : BoxState) : void\n  addBox (boxState : BoxState) : void\n  defineMacro (name : string, definition : string) : void\n}\n\nexport default function MacroDefinition (props : MacroDefinitionProperties) : JSX.Element {\n  const { state, setBoxState, defineMacro } = props\n  const { macroName, macroExpression, singleLetterNames } = state\n  const { editor : { content, caretPosition, placeholder, syntaxError } } = state\n\n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n  }\n\n  const onSubmit = () => {\n    const [ macroName, macroExpression ] : Array<string> = content.split(':=').map(trimStr)\n\n    // TODO: refactor later - this is just dirty little quick fix\n    if ( ! isMacroUnambigous(macroName)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro name is not valid. It redefines built-in Macro.`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidName(macroName, singleLetterNames)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError :\n          // TODO: please fix this - only dirty quick impl\n            new Error(`Macro name is not valid.\n            ${singleLetterNames && macroName.length !== 1 ? 'Name should be single letter.' : '' }`),\n        }\n      })\n\n      return\n    }\n\n    if ( ! isValidExpression(macroExpression, singleLetterNames)) {\n      setBoxState({\n        ...state,\n        editor : {\n          ...state.editor,\n          syntaxError : new Error(`Macro expression is not valid.`)\n        }\n      })\n\n      return\n    }\n\n    setBoxState({\n      ...state,\n      macroName,\n      macroExpression,\n    })\n\n    defineMacro(macroName, macroExpression)\n  \n    // const newMacroTable : MacroMap = {\n    //   ...macroTable,\n    //   [macroName] : macroExpression\n    // }\n    // this.updateMacros(newMacroTable)\n  }\n\n  // TODO: implement same as Evaluator - editor and stuff\n  if (macroName === '' && macroExpression === '') {\n    return (\n      <div className='box boxMacro inactiveBox'>\n          {/* <p className='emptyStep'>Empty macro box.</p> */}\n          <Editor\n            placeholder={ placeholder } // data\n            content={ content } // data\n            caretPosition={ caretPosition } // data\n            syntaxError={ syntaxError } // data\n            isMarkDown={ false } // data\n\n            onContent={ onContent } // fn\n            onEnter={ onSubmit } // fn // tohle asi bude potreba\n            onExecute={ () => {} } // fn // TODO: tohle Macro nepotrebuje\n          />\n          </div>\n    )\n  }\n\n  return (\n    <div className='box boxMacro'>\n      { macroName } := { macroExpression }\n    </div>\n  )\n}\n\n// TODO: in the future there should be more then boolean to indicate validity\nfunction isValidName (name : string, singleLetterNames : boolean) : boolean {\n  try {\n    const root : AST = parseExpression(name, singleLetterNames)\n\n    return root instanceof Variable\n  }\n  catch (exception) {\n    return false\n  }\n}\n\n// THROWS Exceptions\nfunction parseExpression (expression : string, singleLetterNames : boolean) : AST {\n  const macroTable = {}\n  const singleLetterVars : boolean = singleLetterNames\n\n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction isMacroUnambigous (name : string) : boolean {\n  return ! (name in builtinMacros)\n}\n\nfunction isValidExpression (expression : string, singleLetterNames : boolean) : boolean {\n  try {\n    parseExpression(expression, singleLetterNames)\n\n    return true\n  }\n  catch (exception) {\n    return false\n  }\n}","import React from 'react'\n\nimport Evaluator, { EvaluationState } from './Evaluator'\nimport MacroDefinition, { MacroDefinitionState } from './MacroDefinition'\nimport Note, { NoteState } from './Note'\nimport { EvaluationStrategy } from '../App'\nimport { MacroMap } from 'lambdulus-core'\n\n\n// TODO: rename EXPRESSION, MACRO, NOTE\nexport enum BoxType {\n  EXPRESSION,\n  MACRO,\n  NOTE\n}\n\nexport type BoxState = EvaluationState | MacroDefinitionState | NoteState\n\ninterface BoxProperties {\n  state : BoxState\n  globalStrategy : EvaluationStrategy\n  isActive : boolean\n  macroTable : MacroMap\n\n  setBoxState (state : BoxState) : void\n  makeActive () : void\n  addBox (boxState : BoxState) : void\n  defineMacro (name : string, definition : string) : void\n  // removeExpression () : void // not yet\n}\n\nexport default function Box (props : BoxProperties) : JSX.Element {\n  const { state, isActive, macroTable, setBoxState, makeActive, addBox, defineMacro } : BoxProperties = props\n  const { type } = state\n\n  if (type === BoxType.EXPRESSION) {\n    return (\n      <div className=''>\n        <Evaluator\n          state={ state as EvaluationState }\n          globalStrategy={ props.globalStrategy }\n          isActive={ isActive }\n          macroTable={ macroTable }\n          \n          setBoxState={ setBoxState }\n          makeActive={ props.makeActive }\n          addBox={ addBox }\n        />\n      </div>\n    )\n  }\n\n  if (type === BoxType.MACRO) {\n    return (\n      <div className=''>\n        <MacroDefinition\n          state={ state as MacroDefinitionState }\n          setBoxState={ setBoxState }\n\n          addBox={ addBox }\n          defineMacro={ defineMacro }\n        />\n      </div>\n    )\n  }\n\n  if (type === BoxType.NOTE) {\n    return (\n      <div className=''>\n        <Note\n          state={ state as NoteState }\n          isActive={ isActive }\n\n          setBoxState={ setBoxState }\n          makeActive={ props.makeActive }\n          addBox={ addBox }\n        />\n      </div>\n    )\n  }\n\n  return null as any // never happens\n}","import React from 'react'\nconst ReactMarkdown = require('react-markdown')\nimport 'github-markdown-css'\n\nimport { BoxType, BoxState } from './Box'\nimport Editor from './Editor'\n\n\nexport interface NoteState {\n  __key : string\n  type : BoxType\n  note : string\n  isEditing : boolean\n  editor : {\n    placeholder : string\n    content : string\n    caretPosition : number\n    syntaxError : Error | null\n  }\n}\n\nexport interface NoteProperties {\n  state : NoteState\n  isActive : boolean\n\n  setBoxState (state : BoxState) : void\n  makeActive () : void\n  addBox (boxState : BoxState) : void\n}\n\nexport default function Note (props : NoteProperties) : JSX.Element {\n  const {\n    state : {\n      note,\n      editor : { placeholder, content, caretPosition, syntaxError },\n      isEditing,\n    },\n    isActive,\n    setBoxState,\n    makeActive,\n  } = props\n\n  const onContent = (content : string, caretPosition : number) => {\n    setBoxState({\n      ...props.state,\n      editor : {\n        ...props.state.editor,\n        content,\n        caretPosition,\n        syntaxError : null,\n      }\n    })\n    // this.updateURL(expression) // tohle musim nejak vyresit - mozna ta metoda setBoxState v APP bude checkovat propisovat do URL\n  }\n\n  const onSubmitNote = () => {\n    setBoxState({\n      ...props.state,\n      note : content,\n      isEditing : false,\n    })\n  }\n\n\n  if (isEditing && isActive) {\n    return (\n      <div className='box boxNoteEditor'>\n        {/* <p className='emptyStep'>Empty note box.</p>         */}\n        <Editor\n          placeholder={ placeholder } // data\n          content={ content } // data\n          caretPosition={ caretPosition } // data\n          syntaxError={ syntaxError } // data\n          isMarkDown={ true } // data\n          \n          onContent={ onContent } // fn\n          onEnter={ onSubmitNote } // fn\n          onExecute={ () => {} } // fn\n          // onReset={ this.onClear } // fn not yet\n        />\n\n\n        <div id=\"controls\">\n          <button onClick={ () => onSubmitNote() }>\n            Save\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n\n  return (\n    <div className='box boxNote markdown-body'>\n      {/* {\n        note === '' ? \n          <p className='emptyStep'>Empty note box.</p>\n        :\n          null\n      } */}\n      <ReactMarkdown source={ note } />\n      <div id=\"controls\">\n          <button onClick={ () => {\n            setBoxState({\n              ...props.state,\n              isEditing : true,\n            })\n            makeActive()            \n          }\n          }\n            \n          >\n            Edit\n          </button>\n        </div>\n    </div>\n  )\n}","// TODOs\n// hydratace a dehydratace kompletniho statu\n//\n//\n\nimport React, { ChangeEvent } from 'react'\nimport { AST, tokenize, parse, Token, MacroMap, None } from 'lambdulus-core'\n\nimport { AppState, Screen } from '../App'\nimport { EvaluationState } from './Evaluator'\nimport { BoxState, BoxType } from './Box'\n\nimport '../styles/MenuBar.css'\n\ninterface MenuBarProperties {\n  state : AppState\n  onImport (state : AppState) : void\n  onScreenChange (screen : Screen) : void\n}\n\nexport default function MenuBar (props : MenuBarProperties) : JSX.Element {\n  const { state, onImport, onScreenChange } : MenuBarProperties = props\n  const { screen } = state\n\n  const dehydrated : object = dehydrate(state)\n\n  const serialized : string = JSON.stringify(dehydrated)\n  const link : string = createURL(serialized)\n\n  return (\n    <div id=\"topbar\">\n      {/* <div>\n        <i id='notebooks' className=\"icon fas fa-book-open fa-2x\" />\n        <p className='iconLabel'>Notebooks</p>\n      </div> */}\n\n      <div>\n        {\n          screen === Screen.main ?\n            <i className=\"icon fas fa-list-ul fa-2x\" onClick={ () => onScreenChange(Screen.macrolist) } />\n            :\n            <i className=\"icon far fa-window-close fa-2x\" onClick={ () => onScreenChange(Screen.main) } />\n        }\n        <p className='iconLabel'>Macros</p>\n      </div>        \n        \n      <div>\n        <a\n          className='export'\n          href={ link }\n          download=\"notebook_lambdulus.json\"\n          onClick={ () => setTimeout(() => window.URL.revokeObjectURL(link), 10) }\n        >\n          <i id='download' className=\"icon fas fa-cloud-download-alt fa-2x\" />\n        </a>\n        <p className='iconLabel'>Export</p>\n      </div>\n      \n      <div>\n        <input type=\"file\" accept=\"application/json\" id=\"input\" onChange={ (e) => onFiles(e, onImport) } />\n        <label htmlFor=\"input\"><i className=\"icon fas fa-cloud-upload-alt fa-2x\"></i></label>\n        <p className='iconLabel'>Import</p>\n      </div>      \n    </div>\n  )\n}\n\nfunction dehydrateBox (box : BoxState) : BoxState {\n  const { type } : BoxState = box\n\n  if (type === BoxType.EXPRESSION) {\n\n    return {\n      ...box,\n      ast : null as any, // TODO: don't\n      history : [], // TODO: don't\n      isRunning : false,\n      breakpoints : [], // TODO: solve how to don't\n      timeoutID : undefined,\n    }\n  }\n\n  return box\n}\n\nfunction dehydrate (state : AppState) : AppState {\n  return {\n    ...state,\n    submittedBoxes : state.submittedBoxes.map(dehydrateBox)\n  }\n}\n\nfunction hydrateBox (box : BoxState, macroTable : MacroMap) : BoxState {\n  const { type } : BoxState = box\n  \n  if (type === BoxType.EXPRESSION) {\n    const { singleLetterNames } = box as EvaluationState\n    const ast : AST = parseExpression((box as EvaluationState).expression, { macroTable, singleLetterNames })\n\n    return {\n      ...box,\n      ast,\n      history : [ { ast, lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n    }\n  }\n\n  return box\n}\n\nfunction hydrate (dehydrated : AppState) : AppState {\n  const { macroTable } = dehydrated\n  const config = { macroTable }\n\n  return {\n    ...dehydrated,\n    submittedBoxes : dehydrated.submittedBoxes.map((box) => hydrateBox(box, macroTable))\n  }\n}\n\ninterface Config {\n  singleLetterNames : boolean\n  macroTable : MacroMap\n}\n\nfunction parseExpression (expression : string, config : Config) : AST {\n  const { singleLetterNames : singleLetterVars, macroTable } : Config = config\n  \n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction onFiles (event : ChangeEvent<HTMLInputElement>, onImport : (state : AppState) => void) : void {\n  const { target : { files } } = event\n  if (files === null) {\n    return\n  }\n\n  const file : File = files[0]\n  const reader : FileReader = new FileReader\n  reader.onload = (event : Event) => {\n    const state : AppState = JSON.parse(reader.result as string)\n\n    onImport(hydrate(state))\n  }\n\n  reader.readAsText(file) \n}\n\nfunction createURL (content : string) : string {\n  const data = new Blob([ content ], {\n    type: 'application/json'\n  })\n\n  return window.URL.createObjectURL(data);\n}","import React from 'react'\n\nimport Box, { BoxState, BoxType } from './Box'\nimport { EvaluationState } from './Evaluator'\nimport { EvaluationStrategy, PromptPlaceholder } from '../App'\nimport { MacroDefinitionState } from './MacroDefinition'\nimport { NoteState } from './Note'\nimport { MacroMap } from 'lambdulus-core'\n\n\nexport interface BoxSpaceProperties {\n  submittedBoxes : Array<BoxState>\n  activeBoxIndex : number\n  globalStrategy : EvaluationStrategy\n  singleLetterNames : boolean\n  macroTable : MacroMap\n  \n  makeActive (index : number) : void\n  setBoxState (index : number, state : BoxState) : void\n  addEmptyBox (boxState : BoxState) : void\n  addBox (boxState : BoxState) : void\n  defineMacro (name : string, definition : string) : void\n  // removeExpression (index : number) : void // not yet\n}\n\nexport default function BoxSpace (props: BoxSpaceProperties) : JSX.Element {\n  const {\n    globalStrategy : strategy,\n    singleLetterNames,\n    submittedBoxes,\n    activeBoxIndex,\n    macroTable,\n    setBoxState,\n    makeActive,\n    addBox,\n    defineMacro,\n  } = props\n\n  const addBoxControls : JSX.Element = (\n    <div className='emptyC'>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => props.addEmptyBox(createEmptyExp(strategy, singleLetterNames)) }\n      >\n        <i>+ λ</i>\n      </p>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => props.addEmptyBox(createEmptyMacro(singleLetterNames)) }\n      >\n        <i>+ Macro\n        </i></p>\n      <p\n        className='plusBtn inlineblock'\n        onClick={ () => props.addEmptyBox(createEmptyNote()) }\n      >\n        <i>+ MD</i>\n      </p>\n    </div>\n  )\n\n  if (submittedBoxes.length === 0) {\n    return (\n      <div className='evaluatorSpace'>\n        <div className='bigEmpty'>\n          { addBoxControls }\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className='evaluatorSpace'>\n      <ul className='evaluatorList UL'>\n        { submittedBoxes.map((boxState : BoxState, i : number) =>\n          <li className='LI' key={ boxState.__key }>\n            <Box\n              state={ boxState }\n              globalStrategy={ props.globalStrategy }\n              isActive={ i === activeBoxIndex }\n              macroTable={ macroTable }\n              \n              setBoxState={ (state : EvaluationState) => setBoxState(i, state) }\n              makeActive={ () => makeActive(i) }\n              addBox={ addBox }\n              defineMacro={ defineMacro }\n              // removeExpression={ () => removeExpression(i) }\n            />\n          </li>\n          ) }\n          <div className='smallEmpty'>\n          { addBoxControls }\n          </div>\n      </ul>\n    </div>\n  )\n}\n\nfunction createEmptyExp (strategy : EvaluationStrategy, singleLetterNames : boolean) : EvaluationState {\n  return {\n    type : BoxType.EXPRESSION,\n    __key : Date.now().toString(),\n    expression : '',\n    ast : null,\n    history : [],\n    isRunning : false,\n    breakpoints : [],\n    timeoutID : undefined,\n    timeout : 10,\n    isExercise : false,\n    strategy,\n    singleLetterNames,\n    editor : {\n      placeholder : PromptPlaceholder.INIT,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}\n\nfunction createEmptyMacro (singleLetterNames : boolean) : MacroDefinitionState {\n  return {\n    type : BoxType.MACRO,\n    __key : Date.now().toString(),\n    macroName : '',\n    macroExpression : '',\n    singleLetterNames,\n    editor : {\n      placeholder : PromptPlaceholder.MACRO,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null\n    }\n  }\n}\n\nfunction createEmptyNote () : NoteState {\n  return {\n    type : BoxType.NOTE,\n    __key : Date.now().toString(),\n    note : '',\n    isEditing : true,\n    editor : {\n      placeholder : PromptPlaceholder.NOTE,\n      content : '',\n      caretPosition : 0,\n      syntaxError : null,\n    }\n  }\n}","import React from 'react'\nimport { MacroMap, builtinMacros } from 'lambdulus-core'\n\n\nexport interface MacroProperties {\n  macroTable : MacroMap\n  removeMacro (name : string) : void\n}\n\nexport default function MacroSpace (props : MacroProperties) : JSX.Element {\n  const { macroTable, removeMacro } = props\n\n  return (\n    <div className='macroSpace'>\n      <div className='builtinMacros'>\n        <p>Built-in Macros</p>\n        <ul className='UL'>\n          { Object.entries(builtinMacros).map(([macroName, macroExpression]) =>\n            <div key={ macroName }>\n              <li className='LI'>\n                <div className='box boxMacro'>\n                  { macroName } := { macroExpression }\n                </div>\n              </li>\n            </div>\n          ) }\n        </ul>\n      </div>\n\n      <div className='userMacros'>      \n        <p>User-defined Macros</p>\n        <ul>\n          { Object.entries(macroTable).map(([macroName, macroExpression]) =>\n              <div key={ macroName }>\n                <li className='LI'>\n                  <div className='box boxMacro'>\n                    { macroName } := { macroExpression }\n                    <i className=\"hiddenMacroIcon far fa-trash-alt\" onClick={ () => removeMacro(macroName) } />\n                  </div>\n                </li>\n              </div>\n            ) }\n        </ul>\n      </div>\n    </div>\n  )\n}","import React, { Component, ChangeEvent } from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\nimport {\n  AST,\n  MacroMap,\n  NormalEvaluator,\n  ApplicativeEvaluator,\n  OptimizeEvaluator,\n  Token,\n  tokenize,\n  parse\n} from 'lambdulus-core'\n\nimport './App.css'\n\nimport { HANDY_MACROS, getSavedMacros } from './misc'\nimport MenuBar from './components/MenuBar'\nimport BoxSpace from './components/BoxSpace'\nimport Editor, { ActionType } from './components/Editor'\nimport { BoxState, BoxType } from './components/Box'\nimport MacroSpace from './components/MacroSpace'\nimport { EvaluationState } from './components/Evaluator'\nimport { MacroDefinitionState } from './components/MacroDefinition';\n\n\nexport enum EvaluationStrategy {\n  NORMAL = 'Normal Evaluation',\n  APPLICATIVE = 'Applicative Evaluation',\n  OPTIMISATION = 'Optimisation - η Conversion',\n}\n\nexport enum Screen {\n  main,\n  macrolist,\n  // notebooks,\n}\n\nexport enum PromptPlaceholder {\n  INIT = 'Type λ expression and hit enter',\n  EVAL_MODE = 'Hit enter for next step',\n  VALIDATE_MODE = 'Write next step and hit enter for validation',\n  MACRO = 'Define Macro like: `NAME := [λ expression]` and hit enter',\n  NOTE = 'Type note and hit shift enter'\n}\n\n// zvazit jestli nechci vytvorit record type pro ruzne stavy settings\n// v pripade ze je to markdown tak nedava smysl mit strategy a podobne\n// na druhou stranu, melo by si to pamatovat po prepnuti z MD znova do expr strategy a podobne\nexport interface AppState {\n  // settings : {\n  //   strategy : EvaluationStrategy // podle me to tu nema co delat - je to specific pro aktivni Box\n  //   singleLetterNames : boolean // podle me to tu nema co delat - je to specific pro aktivni Box\n  //   isExercise : boolean // podle me to tu nema co delat - je to specific pro aktivni Box\n  //   isMarkDown : boolean // podle me to tu nema co delat - je to specific pro aktivni Box\n  // }\n  \n  macroTable : MacroMap\n\n  submittedBoxes : Array<BoxState>\n  screen : Screen\n  activeBoxIndex : number\n}\n\nexport default class App extends Component<{}, AppState> {\n  constructor (props : object) {\n    super(props)\n\n    this.setBoxState = this.setBoxState.bind(this)\n    this.addEmptyBox = this.addEmptyBox.bind(this)\n    this.changeActiveBox = this.changeActiveBox.bind(this)\n    this.changeActiveStrategy = this.changeActiveStrategy.bind(this)\n    this.changeActiveSingleLetterNames = this.changeActiveSingleLetterNames.bind(this)\n    this.getActiveStrategy = this.getActiveStrategy.bind(this)\n    this.getActiveSingleLetterNames = this.getActiveSingleLetterNames.bind(this)\n    this.addBox = this.addBox.bind(this)\n    this.removeMacro = this.removeMacro.bind(this)\n    this.updateMacros = this.updateMacros.bind(this)\n    this.defineMacro = this.defineMacro.bind(this)\n    this.createBoxFromURL = this.createBoxFromURL.bind(this)\n\n    this.state = {\n      macroTable : { ...HANDY_MACROS, ...getSavedMacros() },\n      submittedBoxes : [],\n      screen : Screen.main,\n      activeBoxIndex : -1,\n    }\n\n    setTimeout(this.createBoxFromURL, 1)\n    window.addEventListener('hashchange', this.createBoxFromURL)\n  }\n\n  render () : JSX.Element {\n    const {\n      // settings : { strategy, singleLetterNames },\n      macroTable,\n      submittedBoxes,\n      screen,\n      activeBoxIndex,\n    } : AppState = this.state\n\n    const getEvaluatorSpace = () =>\n    <BoxSpace\n      submittedBoxes={ submittedBoxes }\n      activeBoxIndex={ activeBoxIndex }\n      globalStrategy={ this.getActiveStrategy() }\n      singleLetterNames={ this.getActiveSingleLetterNames() }\n      macroTable={ macroTable }\n\n      makeActive={ this.changeActiveBox }\n      setBoxState={ this.setBoxState }\n      addEmptyBox={ this.addEmptyBox }\n      addBox={ this.addBox }\n      defineMacro={ this.defineMacro }\n      // removeExpression={ this.onRemoveExpression } // to bude asi potreba az zbytek bude hotovej \n      \n      \n      // onEnter={ this.onEnter } // ten se presune dolu do Boxu\n      // onEditNote={ this.onEditNote } // zmeni se na onChangeActiveBox a isEditing se udela v Boxu\n\n    />\n\n    const getMacroSpace = () =>\n    <MacroSpace\n      macroTable={ macroTable }\n\n      removeMacro={ this.removeMacro }\n    />\n\n    return (\n      <div className='app'>\n\n        <MenuBar\n          state={this.state} // to je nutny\n          \n          onImport={ (state : AppState) => this.setState(state) } // to je docela kratky OK\n          \n          onScreenChange={(screen : Screen) => // mozna tohle zmenit nejakym patternem\n            this.setState({\n              ...this.state,\n              screen,\n            })\n          }\n         />\n\n        {/* celou tuhle componentu bych klidne mohl wrapnout v nejaky custom comp */}\n        {/* taky je dulezity odkud bude tahle kompontnta brat stav - z aktivniho Boxu */}\n        {/* kdyz neni zadnej box - tedy neni zadnej aktivni - tak nejakej default */}\n        <div className='editorSettings'>\n          <Switch\n            checked={ this.getActiveSingleLetterNames() }\n            disabled={ false } // TODO: tohle bude rozhodne chtit prepsat\n            shape=\"fill\"\n            \n            onChange={ (e : ChangeEvent<HTMLInputElement>) => // taky nejakej pattern\n              this.changeActiveSingleLetterNames(e.target.checked)\n            }\n          >\n            Single Letter Names\n          </Switch>\n\n          <div className='strategies inlineblock'>\n            <p className='stratsLabel inlineblock'>Evaluation Strategies:</p>\n            <Radio\n              name=\"strategy\"\n              style=\"fill\"\n              checked={ this.getActiveStrategy() === EvaluationStrategy.NORMAL }\n              \n              onChange={ () => this.changeActiveStrategy(EvaluationStrategy.NORMAL) }\n            >\n              Normal\n            </Radio>\n            <Radio\n              style=\"fill\"\n              name=\"strategy\"\n              checked={ this.getActiveStrategy() === EvaluationStrategy.APPLICATIVE }\n              \n              onChange={ () => this.changeActiveStrategy(EvaluationStrategy.APPLICATIVE) }\n            >\n              Applicative\n            </Radio>\n          </div>\n          \n        </div>\n\n        {\n          screen === Screen.main ? getEvaluatorSpace()\n            :\n          getMacroSpace()\n        }\n\n      </div>\n    )\n  }\n\n  createBoxFromURL () {\n    const hash : string = decodeURI(window.location.hash.substring(1))\n    const isExercise : boolean = hash.indexOf('exercise') !== -1\n\n    const expression : string = isExercise ? hash.substring(8) : hash\n\n    if (expression === '') {\n      return\n    }\n\n    const box : BoxState = {\n      type : BoxType.EXPRESSION,\n      __key : Date.now().toString(),\n      expression : '',\n      ast : null,\n      history : [],\n      isRunning : false,\n      breakpoints : [],\n      timeoutID : undefined,\n      timeout : 10,\n      isExercise : isExercise,\n      strategy : this.getActiveStrategy(),\n      singleLetterNames : this.getActiveSingleLetterNames(),\n      editor : {\n        placeholder : PromptPlaceholder.INIT,\n        content : expression,\n        caretPosition : expression.length,\n        syntaxError : null,\n      }\n    }\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ box ],\n      activeBoxIndex : 0,\n    })\n  }\n\n  setBoxState (index : number, boxState : BoxState) : void {\n    // TODO: bude asi osetrovat update URL\n    const { submittedBoxes, activeBoxIndex } = this.state\n    \n    // const activeBox : BoxState = submittedBoxes[activeBoxIndex]\n    const expression : string = boxState.editor.content || (boxState as EvaluationState).expression // TODO: DIRTY DIRTY BIG TIME\n    const expPrefix : string = boxState.type === BoxType.EXPRESSION && (boxState as EvaluationState).isExercise ? 'exercise' : '' \n    \n    history.pushState({}, \"page title?\", \"#\" + expPrefix + encodeURI(expression))\n\n    // TODO: doresit update URL\n\n    // TODO: consider immutability\n    submittedBoxes[index] = boxState\n\n    this.setState({\n      ...this.state,\n      submittedBoxes,\n    })\n\n  }\n\n  addEmptyBox (boxState : BoxState) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ ...submittedBoxes, boxState ],\n      activeBoxIndex : Math.max(0, submittedBoxes.length),\n    })\n  }\n\n  addBox (boxState : BoxState) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    this.setState({\n      ...this.state,\n      submittedBoxes : [ ...submittedBoxes, boxState ],\n      activeBoxIndex : submittedBoxes.length\n    })\n  }\n\n  changeActiveBox (activeBoxIndex : number) : void {\n    this.setState({\n      ...this.state,\n      activeBoxIndex,\n    })\n  }\n\n  getActiveStrategy () : EvaluationStrategy {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    if (activeBoxIndex === -1) {\n      return JSON.parse(window.localStorage.getItem('strategy') || JSON.stringify(EvaluationStrategy.NORMAL)) as EvaluationStrategy\n    }\n\n    const activeBoxState : BoxState = submittedBoxes[activeBoxIndex]\n\n    if (activeBoxState.type !== BoxType.EXPRESSION) {\n      return JSON.parse(window.localStorage.getItem('strategy') || JSON.stringify(EvaluationStrategy.NORMAL)) as EvaluationStrategy\n    }\n\n    return (activeBoxState as EvaluationState).strategy\n  }\n\n  getActiveSingleLetterNames () : boolean {\n    const { submittedBoxes, activeBoxIndex } = this.state\n\n    if (activeBoxIndex === -1) {\n      return JSON.parse(window.localStorage.getItem('SLI') || 'true')\n    }\n\n    const activeBoxState : BoxState = submittedBoxes[activeBoxIndex]\n\n    if (activeBoxState.type === BoxType.NOTE) {\n      return JSON.parse(window.localStorage.getItem('SLI') || 'true')\n    }\n\n    if (activeBoxState.type === BoxType.EXPRESSION) {\n      return (activeBoxState as EvaluationState).singleLetterNames\n    }\n\n    if (activeBoxState.type === BoxType.MACRO) {\n      return (activeBoxState as MacroDefinitionState).singleLetterNames\n    }\n\n    return JSON.parse(window.localStorage.getItem('SLI') || 'true') // to nikdy nenastane doufam\n  }\n\n  changeActiveStrategy (strategy : EvaluationStrategy) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n    // TODO: consider immutability\n    submittedBoxes[activeBoxIndex] = {\n      ...submittedBoxes[activeBoxIndex],\n      strategy,\n    }\n    \n    this.setState({\n      ...this.state,\n    })\n\n    window.localStorage.setItem('strategy', JSON.stringify(strategy))\n  }\n\n  changeActiveSingleLetterNames (enabled : boolean) : void {\n    const { submittedBoxes, activeBoxIndex } = this.state\n    // TODO: consider immutability\n    submittedBoxes[activeBoxIndex] = {\n      ...submittedBoxes[activeBoxIndex],\n      singleLetterNames : enabled,\n    }\n\n    this.setState({\n      ...this.state\n    })\n\n    window.localStorage.setItem('SLI', JSON.stringify(enabled))\n  }\n\n  removeMacro (name : string) : void {\n    const { macroTable } = this.state\n    \n    const newMacroTable = { ...macroTable }\n    delete newMacroTable[name]\n\n    this.setState({\n      ...this.state,\n      macroTable : newMacroTable\n    })\n\n    this.updateMacros(newMacroTable)\n  }\n\n  updateMacros (macroTable : MacroMap) : void {\n    window.localStorage.setItem('macrotable', JSON.stringify(macroTable))\n  }\n\n  defineMacro (name : string, definition : string) : void {\n    const { macroTable } = this.state\n\n    this.setState({\n      ...this.state,\n      macroTable : { ...macroTable, [name] : definition }\n    })\n\n    this.updateMacros({ ...macroTable, [name] : definition })\n  }\n  \n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}