{"version":3,"sources":["components/Editor.tsx","misc/index.ts","components/Controls.tsx","components/ReactPrinter.tsx","components/ReductionMessage.tsx","components/Step.tsx","components/Box.tsx","components/Evaluator.tsx","components/MacroDefinition.tsx","components/Note.tsx","components/MenuBar.tsx","components/ExpressionSpace.tsx","components/MacroSpace.tsx","App.tsx","components/TreeComparator.ts","serviceWorker.ts","index.tsx"],"names":["require","Switch","Radio","Editor","props","placeholder","expression","caretPosition","onExpression","onEnter","onRun","onReset","syntaxError","strategy","onStrategy","lines","split","length","react_default","a","createElement","className","onChange","e","console","log","target","checked","shape","name","EvaluationStrategy","NORMAL","APPLICATIVE","OPTIMISATION","concat","InputField","event","value","selectionEnd","replace","onKeyDown","shiftKey","ctrlKey","key","preventDefault","wrap","autoFocus","autoComplete","autoCorrect","autoCapitalize","spellCheck","rows","Math","max","ref","element","selectionStart","focus","trimStr","str","trim","HANDY_MACROS","FACT","FACCT","FIB","APPEND","LISTGREQ","LISTLESS","LISTGR","LISTEQ","QUICKSORT","INFLIST","REMOVENTH","NTH","LEN","GETNTH","MAP","REDUCE","APPLY","RANGE","LISTCOMPR","MOD","INFIX","getExpressionFromURL","decodeURI","window","location","hash","substring","Controls","__key","isActive","makeActive","isExercise","makeExercise","endExercise","id","onClick","Controls_Radio","ReactPrinter","tree","redex","breakpoints","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","rendered","visit","assertThisInitialized","lambda","accumulator","_this2","body","Lambda","context","argument","isBreakpoint","args","type","Beta","broken","Set","printMultiLambda","node","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","identifier","err","return","application","leftClassName","rightClassName","right","Application","left","_this3","acc","churchNumber","_this4","Expansion","macro","_this5","variable","ASTVisitor","ReductionMessage","lastReduction","Alpha","Eta","Step","stepRecord","addBreakpoint","children","ast","step","message","normal","NormalEvaluator","nextReduction","printer","print","BoxType","Evaluator","bind","_this$props","state","updateState","history","isRunning","from","to","sequence","fn","result","Array","i","mapLeftFromTo","editExpression","breakpoint","_this$props2","toConsumableArray","PureComponent","MacroDefinition","_props$state","macroName","macroExpression","Note","note","Box","Evaluator_Evaluator","MenuBar","onImport","onScreenChange","screen","dehydrated","objectSpread","submittedExpressions","map","dehydrateBox","dehydrate","link","content","data","Blob","URL","createObjectURL","createURL","JSON","stringify","Screen","main","macrolist","href","download","setTimeout","revokeObjectURL","accept","files","file","reader","FileReader","onload","parse","singleLetterVars","macroTable","config","box","tokens","tokenize","lambdaLetters","parseExpression","None","isNormalForm","hydrateBox","hydrate","readAsText","onFiles","htmlFor","timeoutID","EvaluatorSpace","removeExpression","activeBox","_updateState","_x","apply","arguments","toString","_removeExpression","_makeActive","MacroSpace","removeMacro","entries","builtinMacros","_ref","_ref2","slicedToArray","_ref3","_ref4","PromptPlaceholder","TreeComparator","roots","translator","Map","equals","_roots","_roots2","toArray","slice","compare","createClass","_this$context","backup","set","Macro","ChurchNumeral","Variable","get","strategyToEvaluator","ApplicativeEvaluator","OptimizeEvaluator","App","updateFromURL","_debounce","treshold","timer","_len","_key","clearTimeout","debounce","updateURL","_debounce2","update","cancel","cancelUpdate","onSubmit","onRemoveExpression","updateMacros","onUpdateEvaluationState","onRemoveMacro","onStep","onRemoveLastStep","onExerciseStep","_onRun","__onRun","onStop","onClear","addEventListener","editorState","INIT","localStorage","getItem","_this$state","_this$state$editorSta","notebooks","setState","index","pushState","encodeURI","_this$state2","activeExpression","_this$state3","_this$state4","evalState","timeout","push","clone","onUpdateBoxState","_this$state5","pop","find","shouldBreak","add","perform","_this$state6","reduction","has","_this$state7","_this$state8","userAst","_this$state9","VALIDATE_MODE","exception","_this$state10","_this$state11","_this$state11$editorS","indexOf","isMacroDefinition","_expression$split$map","_expression$split$map2","macroState","Date","now","newMacroTable","defineProperty","isNote","noteState","evaluationState","EVAL_MODE","currentExpr","_this$state12","setItem","Component","Boolean","hostname","match","ReactDOM","render","App_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.41e970e4.chunk.js","sourcesContent":["import React, { ChangeEvent, useState, SetStateAction, Dispatch, KeyboardEvent } from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\nimport 'pretty-checkbox'\n\nimport './EditorStyle.css'\nimport { EvaluationStrategy } from '../App';\n\n\ninterface EditorProperties {\n  placeholder: string\n  expression : string\n  caretPosition : number\n  onExpression (newExpression : string, caretPosition : number) : void\n  onEnter () : void\n  onRun () : void\n  onReset () : void\n  onStrategy (strategy : EvaluationStrategy) : void\n  // onDelete () : void\n  // onStepBack () : void\n  syntaxError : Error | null\n  strategy : EvaluationStrategy\n}\n\nexport default function Editor (props : EditorProperties) : JSX.Element {\n  const {\n    placeholder,\n    expression,\n    caretPosition,\n    onExpression,\n    onEnter,\n    onRun,\n    onReset,\n    syntaxError,\n    strategy,\n    onStrategy,\n    // onDelete,\n    // onStepBack,\n  } : EditorProperties = props\n  const lines : number = expression.split('\\n').length\n  \n\n  const onChange = (event : ChangeEvent<HTMLTextAreaElement>) => {\n    let { target : { value : expression } } : { target : { value : string } } = event\n    const caretPosition : number = event.target.selectionEnd\n\n    expression = expression.replace(/\\\\/g, 'λ')\n\n    onExpression(expression, caretPosition)\n  }\n\n  const onKeyDown = (event : KeyboardEvent<HTMLTextAreaElement>) => {\n    if (! event.shiftKey && ! event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onEnter()\n    }\n    if (event.ctrlKey && event.key === 'Enter') {\n      event.preventDefault()\n      onRun()\n    }\n\n    if (event.ctrlKey && event.key === 'r') {\n      event.preventDefault()\n      onReset()\n    }\n\n  }\n\n  return (\n    <div className='editorContainer'>\n      <p className='badge'>ENTER for STEP</p>\n      <p className='badge'>CTRL + ENTER for RUN</p>\n      <p className='badge'>CTRL + R for RESET</p>\n\n      <div className='editorSettings'>\n        <Switch\n          onChange={ (e : any) => console.log(e.target.checked) }\n          shape=\"slim\"\n        >\n          Single letter names\n        </Switch>\n\n        <Switch\n          onChange={ (e : any) => console.log(e.target.checked) }\n          shape=\"slim\"\n        >\n          Exercise\n        </Switch>\n\n        <div className='strategies inlineblock'>\n          <Radio name=\"strategy\" checked={ strategy === EvaluationStrategy.NORMAL } onChange={ () => onStrategy(EvaluationStrategy.NORMAL) } >Normal Evaluation</Radio>\n          <Radio name=\"strategy\" checked={ strategy === EvaluationStrategy.APPLICATIVE } onChange={ () => onStrategy(EvaluationStrategy.APPLICATIVE) } >Applicative Evaluation</Radio>\n          <Radio name=\"strategy\" checked={ strategy === EvaluationStrategy.OPTIMISATION } onChange={ () => onStrategy(EvaluationStrategy.OPTIMISATION) } >Optimisation</Radio>\n        </div>\n      </div>\n      <p>\n        { syntaxError ? `${syntaxError}` : null }\n      </p>\n\n      <div className=\"editor\">\n        <InputField\n          placeholder={ placeholder }\n          expression={ expression }\n          lines={ lines }\n          caretPosition={ caretPosition }\n          onChange={ onChange }\n          onKeyDown={ onKeyDown }\n        />\n        </div>\n\n    </div>\n  )\n}\n\ninterface InputProps {\n  placeholder : string\n  expression : string\n  lines : number\n  caretPosition : number\n  onChange (event : ChangeEvent<HTMLTextAreaElement>) : void\n  onKeyDown (event : KeyboardEvent<HTMLTextAreaElement>) : void\n}\n\nfunction InputField (props : InputProps) : JSX.Element {\n  const { placeholder, expression, lines, onChange, onKeyDown, caretPosition } : InputProps = props\n\n  return (\n    <textarea\n      className='prompt'\n      onKeyDown={ onKeyDown }\n      onChange={ onChange }\n      value={ expression }\n      placeholder={ placeholder }\n      wrap='hard'\n      autoFocus\n      autoComplete=\"off\"\n      autoCorrect=\"off\"\n      autoCapitalize=\"off\"\n      spellCheck={ false }\n      rows={ Math.max(lines, 1) } \n      ref={ (element : HTMLTextAreaElement) => {\n        if (element !== null) {\n          element.selectionStart = caretPosition\n          element.selectionEnd = caretPosition\n          element.focus()\n        }\n      } }\n    />\n  )\n}","import { MacroMap } from \"lambdulus-core\";\n\nexport function debounce (fn : Function, treshold : number)\n : [ (...args : Array<any>) => void, () => void ] {\n  let timer : number\n  \n  return [\n    function debounced (...args : Array<any>) : void {\n      window.clearTimeout(timer)\n\n      timer = window.setTimeout(() => {\n        fn(...args)\n      }, treshold)\n    },\n    function cancel () : void {\n      window.clearTimeout(timer)\n    }\n  ]\n}\n\nexport function mapRightFromTo(\n  from : number,\n  to : number,\n  sequence : Array<any>,\n  fn : (...args : Array<any>) => any) {\n    const result : Array<any> = new Array(to - from + 1)\n\n    for (let e = 0, i = to; i >= from; --i) {\n      result[e++] = fn(sequence[i], i)\n    }\n\n    return result\n  }\n\n  export function mapLeftFromTo(\n    from : number,\n    to : number,\n    sequence : Array<any>,\n    fn : (...args : Array<any>) => any) {\n      const result : Array<any> = new Array(to - from + 1)\n  \n      for (let e = 0, i = from; i <= to; ++i) {\n        result[e++] = fn(sequence[i], i)\n      }\n  \n      return result\n    }\n\nexport function trimStr (str : string) : string {\n  return str.trim()\n}\n\nexport const HANDY_MACROS : MacroMap = {\n  FACT : '(Y (λ f n . (<= n 1) 1 (* n (f (- n 1)))))',\n  FACCT : '(λ n . (Y (λ f n a . IF (= n 1) a (f (- n 1) (* n a)))) (- n 1) (n))',\n  FIB : '(Y (λ f n . (= n 0) 0 ((= n 1) 1 ( + (f (- n 1)) (f (- n 2))))))',\n  // SHORTLIST : 'CON 3 (CONS 5 (CONS 1 NIL))',\n  // LONGLIST :  '(CONS 3 (CONS 5 (CONS 1 (CONS 10 (CONS 7 (CONS 2 (CONS 4 (CONS 9 (CONS 4 (CONS 6 (CONS 8 NIL)))))))))))',\n  APPEND : 'Y (λ fn listA listB . IF (NULL listA) (listB) (CONS (FIRST listA) (fn (SECOND listA) listB)))',\n  LISTGREQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (>= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTLESS : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (< (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTGR : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (> (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  LISTEQ : 'Y (λ fn piv list . IF (NULL list) (NIL) ( IF (= (FIRST list) piv) (CONS (FIRST list) (fn piv (SECOND list))) (fn piv (SECOND list)) ) )',\n  QUICKSORT : 'Y (λ fn list . IF (NULL list) (NIL) ( IF (NULL (SECOND list)) (list) ( APPEND (fn (LISTLESS (FIRST list) list)) ( APPEND (LISTEQ (FIRST list) list) (fn (LISTGR (FIRST list) list)) ) ) ) )',\n  INFLIST : '(λ n . (Y (λ x . (λ f s g . g f s) n x)))',\n  REMOVENTH : 'Y (λ fn list n . IF (= n 0) (SECOND list) (IF (NULL list) NIL (CONS (FIRST list) (fn (SECOND list) (- n 1) ) ) ) )',\n  NTH : 'Y (λ fn list n . IF (= n 0) (FIRST list) (IF (NULL (list)) NIL (fn (SECOND list) (- n 1)) ) )',\n  LEN : 'Y (λ fn list . IF (NULL list) (0) (+ 1 (fn (SECOND list) )) )',\n  GETNTH : '(λ end . (Y (λ f n i . (end i) (i) ( (= n 0) (Y (λ f a . (end a) (i) (f) ) ) (f (- n 1)) ) )) )',\n  MAP : '(λ fn l . (Y (λ f it . IF (NULL it) (NIL) (CONS (fn (FIRST it)) (f (SECOND it))) )) l )',\n  REDUCE : '(λ fn l init . Y (λ f it acc . IF (NULL it) (acc) (f (SECOND it) (fn (FIRST it) acc)) ) l init )',\n  APPLY : '(λ f args . Y (λ ff f l . (NULL l) (f) (ff (f (FIRST l)) (SECOND l)) ) f args )',\n  RANGE : '(λ m n . Y (λ f e . (= e n) (CONS e NIL) (CONS e (f (+ e 1))) ) m )',\n  LISTCOMPR : '(λ args . APPLY (λ op in rng cond . Y (λ f l . (NULL l) (NIL) ( (cond (FIRST l)) (CONS (op (FIRST l)) (f (SECOND l))) (CONS (FIRST l) (f (SECOND l))) ) ) rng ) args )',\n  MOD : '(λ n m . (n (λ n . (= n (- m 1)) (0) (+ n 1)) (0)) )',\n  INFIX : 'APPLY (λ l op r . op l r)',\n}\n\n// TODO: does not have to be in this class\nexport function getSavedMacros () : MacroMap {\n  return JSON.parse(window.localStorage.getItem('macrotable') || '{}')\n}\n\n// TODO: does not have to be in this class\nexport function isMacroDefinition (expression : string) : boolean {\n  // TODO: check if first part of macro assignment is valid identifier\n  // TODO: check if second part of macro assignment is valid lambda expression\n\n  try {\n    return expression.indexOf(':=') > 0\n  }\n  catch (exception) {\n    return false\n  }\n}\n\n// TODO: does not have to be in this class\nexport function isNote (expression : string) : boolean {\n  return expression.indexOf('#') === 0\n}\n\n// TODO: does not have to be in this class\nexport function getExpressionFromURL () : string {\n  return decodeURI(window.location.hash.substring(1))\n}","import React from 'react'\nconst { Switch, Radio } = require('pretty-checkbox-react')\n\n\nimport './ControlsStyle.css'\nimport { EvaluationStrategy } from '../App';\n\nexport interface ControlsProps {\n  __key : string\n  isRunning : boolean\n  isActive : boolean\n  makeActive () : void\n  isExercise : boolean\n  makeExercise () : void\n  endExercise () : void\n  strategy : EvaluationStrategy\n  onStrategy (strategy : EvaluationStrategy) : void\n}\n\nexport default function Controls (props : ControlsProps) : JSX.Element {\n  const {\n    __key,\n    isActive,\n    makeActive,\n    isExercise,\n    makeExercise,\n    endExercise,\n    strategy,\n    onStrategy,\n  } : ControlsProps = props\n\n  return (\n    <div id=\"controls\">\n      {\n        isActive ?\n          (\n            <div className='badge'>\n              active\n            </div>\n          )\n          :\n          (<div\n            className='badge makeBadge'\n            onClick={ makeActive }\n          >\n            make active\n          </div>)\n      }\n      {\n        isExercise ?\n          (\n            <div\n              className='badge makeBadge'\n              onClick={ endExercise }\n            >\n              end exercise\n            </div>\n          )\n          :\n          (<div\n            className='badge makeBadge'\n            onClick={ makeExercise }\n          >\n            make exercise\n          </div>)\n      }\n      <div\n        className='badge'\n      >\n        <div className='strategyName inlineblock'>\n          { strategy }\n        </div>\n        <div className='strategies inlineblock'>\n          <Radio name={ \"strategy\" + __key } checked={ strategy === EvaluationStrategy.NORMAL } onChange={ () => onStrategy(EvaluationStrategy.NORMAL) } >Normal Evaluation</Radio>\n          <Radio name={ \"strategy\" + __key } checked={ strategy === EvaluationStrategy.APPLICATIVE } onChange={ () => onStrategy(EvaluationStrategy.APPLICATIVE) } >Applicative Evaluation</Radio>\n          <Radio name={ \"strategy\" + __key } checked={ strategy === EvaluationStrategy.OPTIMISATION } onChange={ () => onStrategy(EvaluationStrategy.OPTIMISATION) } >Optimisation</Radio>\n        </div>\n      </div>\n      \n      \n      {/* <i\n        className=\"fas fa-redo-alt fa-2x\"\n        onClick={ onClear }\n       />\n\n      <button className='controlButton' onClick={ onClear } disabled={ isRunning }>CLEAR</button> */}\n    </div>\n  )\n}","import React from 'react'\n\nimport { ASTVisitor, Lambda, Variable, Beta, AST, Application, ChurchNumeral, Expansion, Macro } from \"lambdulus-core\";\n\nimport { Breakpoint } from \"./Evaluator\";\n\n\nexport default class ReactPrinter extends ASTVisitor {\n  private rendered : JSX.Element | null = null\n\n  private printMultiLambda (lambda : Lambda, accumulator : JSX.Element) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.body.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.body.argument)) {\n        className += ' breakpoint'\n      }\n\n      const args : JSX.Element = (\n        <span className='arguments'>\n          { accumulator } {' '}\n          <span\n            className={ className }\n            onClick={ () => this.onClick({ type : Beta, context, broken : new Set }) }\n          >\n            { lambda.body.argument.name() }\n          </span>\n        </span>\n      )\n      \n      this.printMultiLambda(lambda.body, args)\n    }\n    else {\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n      this.rendered = accumulator\n\n      this.rendered = (\n        <span className='function'>\n          (\n          <span\n            className='lambda'\n            onClick={ () => {\n              this.onClick({ type : Beta, context : lambda, broken : new Set })}\n            }>\n              λ { ' ' }\n          </span>\n          { accumulator } . { body }\n          )\n        </span>\n      )\n    }\n  }\n\n  isBreakpoint (node : AST) : boolean {\n    for (const breakpoint of this.breakpoints) {\n      if (breakpoint.context.identifier === node.identifier) {\n        return true\n      }\n    }\n    return false\n  }\n\n  constructor (\n    public readonly tree : AST,\n    private readonly onClick : (breakpoint : Breakpoint) => void,\n    private readonly redex : AST | null,\n    private readonly breakpoints : Array<Breakpoint>,\n  ) {\n    super()\n    this.tree.visit(this)\n  }\n\n  print () : JSX.Element | null {\n    return this.rendered\n  }\n\n  // TODO: little bit refactored, maybe keep going\n  onApplication(application: Application) : void {\n    let leftClassName : string = 'left'\n    let rightClassName : string = 'right'\n\n    if (this.redex !== null\n          &&\n        this.redex.identifier === application.identifier\n          &&\n        this.redex === application\n      ) {\n        leftClassName += ' redex'\n        rightClassName += ' redex'\n    }\n\n    if (application.right instanceof Application) {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>( { this.rendered } )</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n    else {\n      application.left.visit(this)\n      const left : JSX.Element | null = <span className={ leftClassName }>{this.rendered}</span>\n\n      application.right.visit(this)\n      const right : JSX.Element | null = <span className={ rightClassName }>{ this.rendered }</span>\n\n      this.rendered =\n      <span className='application'>\n        { left } { right }\n      </span>\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onLambda(lambda: Lambda) : void {\n    if (lambda.body instanceof Lambda) {\n      const context : Variable = lambda.argument\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      const acc : JSX.Element = (\n        <span\n          className={ className }\n          onClick={ () => this.onClick({ type : Beta, context, broken : new Set }) }\n        >\n          { lambda.argument.name() }\n        </span>\n      )\n\n      this.printMultiLambda(lambda, acc)\n    }\n    else {\n      const context : Variable = lambda.argument\n\n      lambda.argument.visit(this)\n      const args : JSX.Element | null = this.rendered\n\n      lambda.body.visit(this)\n      const body : JSX.Element | null = this.rendered\n\n      let className : string = 'argument'\n\n      if (this.isBreakpoint(lambda.argument)) {\n        className += ' breakpoint'\n      }\n\n      this.rendered = (\n        <span className='function' >\n          (\n          <span\n            className='lambda'\n            onClick={ () => {\n              this.onClick({ type: Beta, context: lambda, broken : new Set })}\n            }>\n              λ { ' ' }\n          </span>\n          <span\n            className={ className }\n            onClick={ () => this.onClick({ type : Beta, context, broken : new Set }) }\n          >\n            { args } { ' ' }\n          </span>\n          . { body } \n          )\n        </span>\n      )\n    }\n  }\n  \n  // TODO: little bit refactored, maybe keep going\n  onChurchNumeral(churchNumber: ChurchNumeral) : void {\n    let className : string = 'churchnumeral'\n\n    if (this.redex !== null\n          &&\n        this.redex.identifier === churchNumber.identifier\n          &&\n        this.redex === churchNumber\n      ) {\n        className += ' redex'\n    }\n\n    if (this.isBreakpoint(churchNumber)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => this.onClick({ type: Expansion, context : churchNumber, broken : new Set }) }\n      >\n        { churchNumber.name() }\n      </span>\n    )\n  }\n\n  // TODO: little bit refactored, maybe keep going  \n  onMacro(macro: Macro) : void {\n    let className = 'macro'\n\n    if (this.redex !== null && this.redex.identifier === macro.identifier && this.redex === macro) {\n      className += ' redex'\n    }\n\n    if (this.isBreakpoint(macro)) {\n      className += ' breakpoint'\n    }\n\n    this.rendered = (\n      <span\n        className={ className }\n        onClick={ () => this.onClick({ type: Expansion, context : macro, broken : new Set }) }\n      >\n        { macro.name() }\n      </span>\n    )\n  }\n  \n  onVariable(variable: Variable): void {\n    this.rendered = <span className='variable' >{ variable.name() }</span>\n  }\n}","import React from 'react'\nimport { ASTReduction, Beta, Alpha, Expansion } from 'lambdulus-core';\nimport { Eta } from 'lambdulus-core/dist/reductions/eta';\n\n\ninterface ReductionMessageProperties {\n  lastReduction : ASTReduction | null\n}\n\nexport default function ReductionMessage (props : ReductionMessageProperties) : JSX.Element {\n  const { lastReduction } = props\n\n  if (lastReduction === null) {\n    return null as any\n  }\n\n  if (lastReduction instanceof Beta) {\n    return (\n      <p className='lastReduction'>\n        β reduction\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Alpha) {\n    return (\n      <p className='lastReduction'>\n        α conversion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Expansion) {\n    return (\n      <p className='lastReduction'>\n        Macro expansion\n      </p>\n    )\n  }\n\n  if (lastReduction instanceof Eta) {\n    return (\n      <p className='lastReduction'>\n        η conversion\n      </p>\n    )\n  }\n\n  else {\n    return null as any\n  }\n  \n}","import React from 'react'\n\nimport { AST, Beta, Expansion, NormalEvaluator, ASTReduction } from 'lambdulus-core';\n\nimport './StepStyle.css'\nimport { Breakpoint, StepRecord } from './Evaluator'\nimport ReactPrinter from './ReactPrinter';\nimport ReductionMessage from './ReductionMessage';\n\n\ninterface StepProperties {\n  stepRecord : StepRecord\n  breakpoints : Array<Breakpoint>\n  addBreakpoint (breakpoint : Breakpoint) : void\n  children : JSX.Element\n}\n\nexport default function Step (props : StepProperties) : JSX.Element | null {\n  const { stepRecord, addBreakpoint, breakpoints, children } = props\n  const { ast : tree, lastReduction, step, message } = stepRecord\n\n  if (tree === null) {\n    return null\n  }\n\n  // TODO: tohle se musi fixnout\n  // validni redex se musi dostat ze statu a ne si ho tedka vymyslet sam\n\n  let redex : AST | null  = null\n  const normal : NormalEvaluator = new NormalEvaluator(tree)\n  \n  if (normal.nextReduction instanceof Beta) {\n    redex = normal.nextReduction.redex\n  }\n  \n  if (normal.nextReduction instanceof Expansion) {\n    redex = normal.nextReduction.target\n  }\n\n  const printer : ReactPrinter = new ReactPrinter(tree, addBreakpoint, redex, breakpoints)\n\n  return (\n    <span className='step'>\n      <ReductionMessage lastReduction={ lastReduction } />\n      <div className='inlineblock' >\n        <p className='stepNumber' >\n          { step } :\n        </p>\n        { printer.print() }\n        { children }\n        {\n          stepRecord.message === '' ?\n            null\n            :\n            <p className='stepMessage'>\n              { stepRecord.message }\n            </p>\n        }\n      </div>\n    </span>\n  )\n}","import React from 'react'\nimport Evaluator, { EvaluationState } from './Evaluator';\nimport MacroDefinition, { MacroDefinitionState } from './MacroDefinition';\nimport Note, { NoteState } from './Note';\nimport { AST } from 'lambdulus-core';\nimport { EvaluationStrategy } from '../App';\n\n\nexport enum BoxType {\n  expression,\n  macro,\n  note\n}\n\nexport type BoxState = EvaluationState | MacroDefinitionState | NoteState\n\ninterface BoxProperties {\n  state : BoxState\n  updateState (state : BoxState) : void\n  removeExpression () : void\n  editExpression (ast : AST, strategy : EvaluationStrategy) : void\n  isActive : boolean\n  makeActive () : void\n}\n\nexport default function Box (props : BoxProperties) : JSX.Element {\n  const { state, updateState, isActive } : BoxProperties = props\n  const { type } = state\n\n  if (type === BoxType.expression) {\n    return (\n      <div className=''>\n        <Evaluator\n          state={ state as EvaluationState }\n          updateState={ updateState }\n          editExpression={ props.editExpression }\n          isActive={ isActive }\n          makeActive={ props.makeActive }\n        />\n      </div>\n    )\n  }\n\n  if (type === BoxType.macro) {\n    return (\n      <div className=''>\n        <MacroDefinition state={ state as MacroDefinitionState } />\n      </div>\n    )\n  }\n\n  if (type === BoxType.note) {\n    return (\n      <div className=''>\n        <Note state={ state as NoteState } />\n      </div>\n    )\n  }\n\n  return (\n    <div>\n      I do not know what to do with this yet.\n    </div>\n  )\n}","import React, { PureComponent } from 'react'\n\nimport { AST, ASTReduction, None, NormalEvaluator, Beta, Lambda, Variable, Expansion, ChurchNumeral, Macro, } from \"lambdulus-core\";\n\nimport './EvaluatorStyle.css'\nimport Controls from './Controls';\nimport Step from './Step';\nimport { mapRightFromTo, mapLeftFromTo } from '../misc'\nimport { BoxType } from './Box';\nimport { EvaluationStrategy } from '../App';\n\n\nexport type Breakpoint = {\n  type : ASTReduction,\n  context : AST,\n  broken : Set<AST>,\n}\n\nexport interface StepRecord {\n  ast : AST\n  lastReduction : ASTReduction | null\n  step : number\n  message : string\n  isNormalForm : boolean\n}\n\nexport interface EvaluationState {\n  __key : string\n  type : BoxType\n  expression : string\n  ast : AST\n  history : Array<StepRecord>\n  // steps : number\n  isRunning : boolean\n  // lastReduction : ASTReduction | null\n  breakpoints : Array<Breakpoint>\n  timeoutID : number | undefined\n  timeout : number\n  isExercise : boolean\n  strategy : EvaluationStrategy\n}\n\nexport interface EvaluationStatePatch {\n  __key? : string\n  type? : BoxType\n  expression? : string\n  ast? : AST\n  history? : Array<StepRecord>\n  // steps? : number\n  isRunning? : boolean\n  // lastReduction? : ASTReduction | null\n  breakpoints? : Array<Breakpoint>\n  timeoutID? : number | undefined\n  timeout? : number\n  isExercise? : boolean\n  strategy? : EvaluationStrategy\n}\n\ninterface EvaluationProperties {\n  state : EvaluationState\n  updateState (state : EvaluationStatePatch) : void\n  editExpression (ast : AST, strategy : EvaluationStrategy) : void\n  makeActive () : void\n  isActive : boolean\n}\n\nexport default class Evaluator extends PureComponent<EvaluationProperties, EvaluationState> {\n  constructor (props : EvaluationProperties) {\n    super(props)\n\n    this.addBreakpoint = this.addBreakpoint.bind(this)\n  }\n\n  render () : JSX.Element {\n    const { state, updateState } : EvaluationProperties = this.props\n    const {\n      __key,\n      history,\n      isRunning,\n      breakpoints,\n      isExercise,\n      strategy,\n    } : EvaluationState = state\n\n    const stepRecord : StepRecord = history[history.length - 1]\n\n    return (\n      <div className='box boxEval'>\n        <ul>\n          {\n            mapLeftFromTo(0, history.length - 2, history, (stepRecord, i) =>\n              <li key={ i } className='inactiveStep' >\n                <Step\n                  breakpoints={ breakpoints }\n                  addBreakpoint={ () => {} }\n                  stepRecord={ stepRecord }\n                >\n                  <i\n                    className=\"hiddenIcon fas fa-pencil-alt\"\n                    onClick={ () => this.props.editExpression(stepRecord.ast, state.strategy) }\n                  />\n                </Step>\n              </li>)\n          }\n          <li key={history.length - 1} className='activeStep'>\n            <Step\n              breakpoints={ breakpoints }\n              addBreakpoint={ this.addBreakpoint }\n              stepRecord={ history[history.length - 1] }\n            >\n                <i\n                  className=\"hiddenIcon fas fa-pencil-alt\"\n                  onClick={ () => this.props.editExpression(history[history.length - 1].ast, state.strategy) }\n                />\n            </Step>\n          </li>\n        </ul>\n        <Controls\n          isRunning={ isRunning }\n          isActive={ this.props.isActive }\n          makeActive={ this.props.makeActive }\n          isExercise={ isExercise }\n          makeExercise={ () => this.props.updateState({ isExercise : true }) }\n          endExercise={ () => this.props.updateState({ isExercise : false })  }\n          strategy={ strategy }\n          onStrategy={ (strategy : EvaluationStrategy) => updateState({\n            strategy\n          })  }\n          __key={ __key }\n        />\n      </div>\n    )\n  }\n\n  addBreakpoint (breakpoint : Breakpoint) : void {\n    let { state, updateState } : EvaluationProperties = this.props\n  \n    updateState({\n      breakpoints : [ ...state.breakpoints, breakpoint ],\n    })\n  }\n}","import React from 'react'\nimport { BoxType, BoxState } from './Box';\n\n\nexport interface MacroDefinitionState {\n  __key : string\n  type : BoxType\n  macroName : string\n  macroExpression : string\n}\n\nexport interface MacroDefinitionProperties {\n  state : MacroDefinitionState\n}\n\nexport default function MacroDefinition (props : MacroDefinitionProperties) : JSX.Element {\n  const { state : { macroName, macroExpression } } : MacroDefinitionProperties = props\n\n  return (\n    <div className='box boxMacro'>\n      { macroName } := { macroExpression }\n    </div>\n  )\n}","import React from 'react'\nimport { BoxType, BoxState } from './Box';\n\n\nexport interface NoteState {\n  __key : string\n  type : BoxType\n  note : string\n}\n\nexport interface NoteProperties {\n  state : NoteState\n}\n\nexport default function Note (props : NoteProperties) : JSX.Element {\n  const { state : { note } } : NoteProperties = props\n\n  return (\n    <div className='box boxNote'>\n      { note }\n    </div>\n  )\n}","import React, { ChangeEvent } from 'react'\n\nimport './TopBarStyle.css'\n\nimport { AppState, Screen } from '../App'\nimport { EvaluationState } from './Evaluator';\nimport { AST, tokenize, parse, Token, MacroMap, None } from 'lambdulus-core';\nimport { BoxState, BoxType } from './Box';\n\n\ninterface MenuBarProperties {\n  state : AppState\n  onImport (state : AppState) : void\n  onScreenChange (screen : Screen) : void\n}\n\nexport default function MenuBar (props : MenuBarProperties) : JSX.Element {\n  const { state, onImport, onScreenChange } : MenuBarProperties = props\n  const { screen } = state\n\n  const dehydrated : object = dehydrate(state)\n\n  const serialized : string = JSON.stringify(dehydrated)\n  const link : string = createURL(serialized)\n\n  return (\n    <div id=\"topbar\">\n        {/* <i className=\"icon fas fa-cog fa-2x\" /> */}\n        <div>\n          <i id='notebooks' className=\"icon fas fa-book-open fa-2x\" />\n          <p className='iconLabel'>Notebooks</p>\n        </div>\n\n        <div>\n          {\n            screen === Screen.main ?\n              <i className=\"icon fas fa-list-ul fa-2x\" onClick={ () => onScreenChange(Screen.macrolist) } />\n              :\n              <i className=\"icon far fa-window-close fa-2x\" onClick={ () => onScreenChange(Screen.main) } />\n          }\n          <p className='iconLabel'>Macros</p>\n        </div>        \n        \n\n        {/* <i className=\"save icon fas fa-save fa-2x\" /> */}\n      <div>\n        <a\n          className='export'\n          href={ link }\n          download=\"notebook_lambdulus.json\"\n          onClick={ () => setTimeout(() => window.URL.revokeObjectURL(link), 10) }\n        >\n          <i id='download' className=\"icon fas fa-cloud-download-alt fa-2x\" />\n        </a>\n        <p className='iconLabel'>Export</p>\n      </div>\n      \n      <div>\n        <input type=\"file\" accept=\"application/json\" id=\"input\" onChange={ (e) => onFiles(e, onImport) } />\n        <label htmlFor=\"input\"><i className=\"icon fas fa-cloud-upload-alt fa-2x\"></i></label>\n        <p className='iconLabel'>Import</p>\n      </div>      \n    </div>\n  )\n}\n\nfunction dehydrateBox (box : BoxState) : BoxState {\n\n  // console.log('dehydrate')\n  const { type } : BoxState = box\n\n  if (type === BoxType.expression) {\n\n    // console.log('dehydrate expression')\n    return {\n      ...box,\n      ast : null as any,\n      history : [],\n      isRunning : false,\n      // lastReduction : null,\n      breakpoints : [],\n      timeoutID : undefined,\n    }\n  }\n\n  // console.log('dehydrate something else')\n\n  return box\n}\n\nfunction dehydrate (state : AppState) : AppState {\n  return {\n    ...state,\n    submittedExpressions : state.submittedExpressions.map(dehydrateBox)\n  }\n}\n\nfunction hydrateBox (box : BoxState, config : Config) : BoxState {\n  const { type } : BoxState = box\n  \n  if (type === BoxType.expression) {\n    const ast : AST = parseExpression((box as EvaluationState).expression, config)\n\n    return {\n      ...box,\n      ast,\n      history : [ { ast, lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n    }\n  }\n\n  return box\n}\n\nfunction hydrate (dehydrated : AppState) : AppState {\n  const { singleLetterVars, macroTable } = dehydrated\n  const config = { singleLetterVars, macroTable }\n\n  return {\n    ...dehydrated,\n    submittedExpressions : dehydrated.submittedExpressions.map((box) => hydrateBox(box, config))\n  }\n}\n\ninterface Config {\n  singleLetterVars : boolean\n  macroTable : MacroMap\n}\n\nfunction parseExpression (expression : string, config : Config) : AST {\n  const { singleLetterVars, macroTable } : Config = config\n  \n  const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n  const ast : AST = parse(tokens, macroTable)\n\n  return ast\n}\n\nfunction onFiles (event : ChangeEvent<HTMLInputElement>, onImport : (state : AppState) => void) : void {\n  const { target : { files } } = event\n  if (files === null) {\n    return\n  }\n\n  const file : File = files[0]\n  const reader : FileReader = new FileReader\n  reader.onload = (event : Event) => {\n    const state : AppState = JSON.parse(reader.result as string)\n\n    onImport(hydrate(state))\n  }\n\n  reader.readAsText(file)\n\n  \n}\n\nfunction createURL (content : string) : string {\n  const data = new Blob([ content ], {\n    type: 'application/json'\n  })\n\n  // If we are replacing a previously generated file we need to\n  // manually revoke the object URL to avoid memory leaks.\n  // if (textFile !== null) {\n  //   window.URL.revokeObjectURL(textFile);\n  // }\n\n  return window.URL.createObjectURL(data);\n}","import React from 'react'\nimport Box, { BoxState } from './Box';\nimport { EvaluationState } from './Evaluator';\nimport { AST } from 'lambdulus-core';\nimport { EvaluationStrategy } from '../App';\n\n\nexport interface EvaluatorProperties {\n  submittedExpressions : Array<BoxState>\n  updateState (state : BoxState, index : number) : void\n  removeExpression (index : number) : void\n  editExpression (ast : AST, strategy : EvaluationStrategy) : void\n  activeBox : number\n  makeActive (index : number) : void\n}\n\nexport default function EvaluatorSpace (props: EvaluatorProperties) : JSX.Element {\n  const { submittedExpressions, updateState, removeExpression, activeBox, makeActive } = props\n\n  return (\n    <div className='evaluatorSpace'>\n      {\n        submittedExpressions.length ?\n          <ul className='evaluatorList'>\n            { submittedExpressions.map((state : BoxState, i : number) =>\n              <li key={ state.__key }>\n                <Box\n                  state={ state }\n                  updateState={ (state : EvaluationState) => updateState(state, i) }\n                  removeExpression={ () => removeExpression(i) }\n                  editExpression={ props.editExpression }\n                  isActive={ i === activeBox }\n                  makeActive={ () => makeActive(i) }\n                />\n              </li>\n              ) }\n          </ul>\n          :\n          null\n      }\n    </div>\n  )\n}","import React from 'react'\nimport { MacroMap, builtinMacros } from 'lambdulus-core';\n\n\nexport interface MacroProperties {\n  macroTable : MacroMap\n  removeMacro (name : string) : void\n}\n\nexport default function MacroSpace (props : MacroProperties) : JSX.Element {\n  const { macroTable, removeMacro } = props\n\n  return (\n    <div className='macroSpace'>\n      <p>Built-in Macros</p>\n      <ul>\n        { Object.entries(builtinMacros).map(([macroName, macroExpression]) =>\n          <div key={ macroName }>\n            <li>\n              <div className='box boxMacro'>\n                { macroName } := { macroExpression }\n              </div>\n            </li>\n          </div>\n        ) }\n      </ul>\n\n      <p>User-defined Macros</p>\n      <ul>\n        { Object.entries(macroTable).map(([macroName, macroExpression]) =>\n            <div key={ macroName }>\n              <li>\n                <div className='box boxMacro'>\n                  { macroName } := { macroExpression }\n                  <i className=\"hiddenMacroIcon far fa-trash-alt\" onClick={ () => removeMacro(macroName) } />\n                </div>\n              </li>\n            </div>\n          ) }\n      </ul>\n    </div>\n  )\n}","import React, { Component } from 'react';\n\nimport {\n  AST,\n  tokenize,\n  parse,\n  Token,\n  MacroMap,\n  None,\n  NormalEvaluator,\n  Expansion,\n  Macro,\n  ChurchNumeral,\n  Variable,\n  Lambda,\n  Beta,\n  ASTReduction,\n  ApplicativeEvaluator,\n  OptimizeEvaluator\n} from 'lambdulus-core'\n\nimport './App.css'\nimport Editor from './components/Editor'\nimport { debounce, trimStr, HANDY_MACROS, getExpressionFromURL, isNote, isMacroDefinition, getSavedMacros } from './misc';\nimport { EvaluationState, Breakpoint, StepRecord } from './components/Evaluator';\nimport TopBar from './components/MenuBar';\nimport { BoxState, BoxType } from './components/Box';\nimport { MacroDefinitionState } from './components/MacroDefinition';\nimport { NoteState } from './components/Note';\nimport EvaluatorSpace from './components/ExpressionSpace';\nimport MacroSpace from './components/MacroSpace';\nimport { TreeComparator } from './components/TreeComparator';\n\n\nexport enum Screen {\n  main,\n  macrolist,\n  notebooks,\n}\n\nexport enum PromptPlaceholder {\n  INIT = 'type λ expression',\n  EVAL_MODE = 'HIT ENTER AGAIN FOR NEXT STEP',\n  VALIDATE_MODE = 'HIT ENTER TO VALIDATE YOUR SKILL',\n}\n\nexport enum EvaluationStrategy {\n  NORMAL = 'Normal Evaluation',\n  APPLICATIVE = 'Applicative Evaluation',\n  OPTIMISATION = 'Optimisation - η Conversion ',\n}\n\nexport type Evaluator = NormalEvaluator | ApplicativeEvaluator | OptimizeEvaluator\n\nexport function strategyToEvaluator (strategy : EvaluationStrategy) : Evaluator {\n  switch (strategy) {\n    case EvaluationStrategy.NORMAL:\n      return NormalEvaluator as any\n \n    case EvaluationStrategy.APPLICATIVE:\n      return ApplicativeEvaluator as any\n\n    case EvaluationStrategy.OPTIMISATION:\n      return OptimizeEvaluator as any\n  }\n}\n\nexport interface AppState {\n  editorState : {\n    placeholder : string\n    expression : string\n    caretPosition : number\n    syntaxError : Error | null\n    strategy : EvaluationStrategy\n  }\n  \n  singleLetterVars : boolean\n  macroTable : MacroMap\n\n  submittedExpressions : Array<BoxState>\n  screen : Screen\n  activeBox : number\n}\n\nexport default class App extends Component<{}, AppState> {\n  constructor (props : object) {\n    super(props)\n\n    this.parseExpression = this.parseExpression.bind(this)\n    this.updateFromURL = this.updateFromURL.bind(this)\n    const [update, cancel] = debounce(this.updateURL.bind(this), 500)\n    this.updateURL = update\n    this.cancelUpdate = cancel\n    this.onExpression = this.onExpression.bind(this)\n    this.onSubmit = this.onSubmit.bind(this)\n    this.onRemoveExpression = this.onRemoveExpression.bind(this)\n    this.updateMacros = this.updateMacros.bind(this)\n    this.onUpdateEvaluationState = this.onUpdateEvaluationState.bind(this)\n    this.onRemoveMacro = this.onRemoveMacro.bind(this)\n    this.onEnter = this.onEnter.bind(this)\n    this.onStep = this.onStep.bind(this)\n    this.onRemoveLastStep = this.onRemoveLastStep.bind(this)\n    this.onExerciseStep = this.onExerciseStep.bind(this)\n    this.onRun = this.onRun.bind(this)\n    this._onRun = this._onRun.bind(this)\n    this.__onRun = this.__onRun.bind(this)\n    this.onStop = this.onStop.bind(this)\n    this.onClear = this.onClear.bind(this)\n\n    this.onRun = this.onRun.bind(this)\n\n    window.addEventListener('hashchange', this.updateFromURL)\n\n    const expression : string = getExpressionFromURL()\n\n    this.state = {\n      editorState : {\n        placeholder : PromptPlaceholder.INIT,\n        expression,\n        caretPosition : expression.length,\n        syntaxError : null,\n        strategy : EvaluationStrategy.NORMAL,\n      },\n      singleLetterVars : false,\n      macroTable : { ...HANDY_MACROS, ...getSavedMacros() },\n      submittedExpressions : [],\n      screen : Screen.main,\n      activeBox : -1,\n    }\n  }\n\n  render () {\n    const {\n      editorState : { expression, caretPosition, syntaxError, placeholder },\n      singleLetterVars,\n      macroTable,\n      submittedExpressions,\n      screen,\n      activeBox,\n    } : AppState = this.state\n\n    const getEvaluatorSpace = () =>\n    <EvaluatorSpace\n      removeExpression={ this.onRemoveExpression }\n      updateState={ this.onUpdateEvaluationState }\n      submittedExpressions={ submittedExpressions }\n      editExpression={ (ast : AST, strategy : EvaluationStrategy) => this.setState({\n        ...this.state,\n        editorState : {\n          placeholder : PromptPlaceholder.INIT,\n          expression : ast.toString(),\n          caretPosition : ast.toString().length,\n          syntaxError : null,\n          strategy,\n        }\n      }) }\n      activeBox={ activeBox }\n      makeActive={ (index : number) => this.setState({\n        ...this.state,\n        activeBox : index,\n      }) }\n    />\n\n    const getMacroSpace = () =>\n    <MacroSpace\n      macroTable={ macroTable }\n      removeMacro={ this.onRemoveMacro }\n    />\n\n    const notebooks : JSX.Element = (\n      <div>\n        Notebooks are not implemented yet.\n      </div>\n    )\n\n    // const onKeyDown = (event : KeyboardEvent) => {\n    //   if (! event.shiftKey && event.key === 'Enter') {\n    //     event.preventDefault()\n    //     this.onEnter()\n    //   }\n    // }\n\n    // document.onkeydown = onKeyDown\n  \n\n    return (\n      <div className='app'>\n\n        <TopBar\n          state={this.state}\n          onImport={ (state : AppState) => this.setState(state) }\n          onScreenChange={ (screen : Screen) => this.setState({\n            ...this.state,\n            screen,\n          }) }\n         />\n\n        {\n          screen === Screen.main ?\n            getEvaluatorSpace()\n            :\n            screen === Screen.macrolist ?\n              getMacroSpace()\n              :\n              notebooks\n        }\n\n        <Editor\n          placeholder={ placeholder }\n          expression={ expression }\n          caretPosition={ caretPosition }\n          onExpression={ this.onExpression }\n          onEnter={ this.onEnter }\n          syntaxError={ syntaxError }\n          onRun={ this.onRun }\n          onReset={ this.onClear }\n          strategy={ this.state.editorState.strategy }\n          onStrategy={ (strategy : EvaluationStrategy) => this.setState({\n            ...this.state,\n            editorState : {\n              ...this.state.editorState,\n              strategy,\n            }\n          }) }\n          // onDelete={ this.onRemoveExpression }\n          // onStepBack={ this.onRemoveLastStep }\n        />\n\n        {/* <div id=\"anchor\"></div> */}\n\n      </div>\n    )\n  }\n\n  // TODO: does not have to be in this class\n  updateURL (expression : string) : void {\n    history.pushState({}, \"page title?\", \"#\" + encodeURI(expression))\n  }\n\n  // TODO: does not have to be in this class\n  cancelUpdate () : void {\n    // TODO: this is placeholder for cancel-debounced-function DONT REMOVE\n  }\n\n  onExpression (expression : string, caretPosition : number) : void {\n    this.setState({\n      ...this.state,\n      editorState : {\n        ...this.state.editorState,\n        placeholder : this.state.editorState.placeholder,\n        expression,\n        caretPosition,\n        syntaxError : null,\n      }\n    } )\n    this.updateURL(expression)\n  }\n\n  // TODO: tohle pujde v podstate pryc\n  onUpdateEvaluationState (state : BoxState, index : number) : void {\n    const { submittedExpressions } : AppState = this.state\n\n    submittedExpressions[index] = {\n      ...submittedExpressions[index],\n      ...state,\n    }\n\n    this.setState({\n      ...this.state,\n      submittedExpressions,\n    })\n  }\n\n  onRemoveExpression () {\n    // TODO: implement IMPLEMENT I M P L E M E N T\n    // const { submittedExpressions, macroTable,  } : AppState = this.state\n\n    // const removed : BoxState | undefined = submittedExpressions.pop()\n\n    // if (removed !== undefined && removed.type === BoxType.macro) {\n    //   const name : string = (removed as MacroDefinitionState).macroName\n    //   delete macroTable[name]\n    //   this.updateMacros(macroTable)\n    // }\n\n    // this.setState({\n    //   ...this.state,\n    //   macroTable,\n    //   submittedExpressions\n    // })\n  }\n\n  onRemoveLastStep () {\n    console.log('CURRENTLY NOT IMPEMENTED')\n    // const { submittedExpressions } : AppState = this.state\n\n    // const last : BoxState | undefined = submittedExpressions[submittedExpressions.length - 1]\n    \n\n    // if (last === undefined || last.type !== BoxType.expression) {\n    //   return\n    // }\n\n    // const active : EvaluationState = submittedExpressions[submittedExpressions.length - 1] as EvaluationState\n    \n    // active.\n\n    // this.setState({\n    //   ...this.state,\n    //   submittedExpressions\n    // })\n  }\n\n  //\n  // TODO: refactor heavily PLS\n  onRun () : void {\n    const { submittedExpressions, activeBox } = this.state\n    const activeExpression = submittedExpressions[activeBox]\n\n    if (activeExpression.type === BoxType.expression) {\n      const activeExp = activeExpression as EvaluationState\n\n      if (activeExp.isRunning === false) {\n        this._onRun()\n      }\n      else {\n        this.onStop()\n      }\n    }\n    else {\n      return\n    }\n  }\n\n  onUpdateBoxState (state : BoxState) : void {\n    const { submittedExpressions, activeBox } = this.state\n\n    submittedExpressions[activeBox] = state\n\n    this.setState({\n      ...this.state,\n      submittedExpressions,\n    })\n  }\n\n  _onRun () : void {\n    const { submittedExpressions, activeBox } = this.state\n    const evalState = submittedExpressions[activeBox] as EvaluationState\n\n    const { timeout, history } = evalState\n    const stepRecord = history[history.length - 1]\n  \n    if (stepRecord.isNormalForm) {\n      return\n    }\n    \n    const { ast, step, lastReduction, isNormalForm, message } = stepRecord\n    history[history.length - 1].message = 'Skipping some steps...'\n    history.push({ ast : ast.clone(), step, lastReduction, message, isNormalForm })\n\n    this.onUpdateBoxState({\n      ...evalState,\n      history,\n      isRunning : true,\n      timeoutID : window.setTimeout(this.__onRun, timeout),\n    })\n  }\n\n  __onRun () {\n    const { submittedExpressions, activeBox } = this.state\n    const evalState = submittedExpressions[activeBox] as EvaluationState\n    \n    let { history, isRunning, breakpoints, timeoutID, timeout, strategy } = evalState\n    const stepRecord : StepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { lastReduction } = stepRecord\n\n    if ( ! isRunning) {\n      return\n    }\n    \n    if (isNormalForm) {\n      this.onUpdateBoxState({\n        ...evalState,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    let ast : AST = history[history.length - 1].ast\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n    \n    if (normal.nextReduction instanceof None) {\n      history.pop()\n      history.push({\n        ast,\n        lastReduction : stepRecord.lastReduction,\n        step,\n        message : 'Expression is in normal form.',\n        isNormalForm : true\n      })\n  \n      this.onUpdateBoxState({\n        ...evalState,\n        history,\n        // steps,\n        isRunning : false,\n        timeoutID : undefined,\n      })\n  \n      return\n    }\n  \n    // TODO: maybe refactor a little\n    const breakpoint : Breakpoint | undefined = breakpoints.find(\n      (breakpoint : Breakpoint) =>\n        this.shouldBreak(breakpoint, normal.nextReduction)\n    )\n  \n    if (breakpoint !== undefined) {\n      if (normal.nextReduction instanceof Expansion) {\n        breakpoint.broken.add(normal.nextReduction.target)\n      }\n      // TODO: ADD FOR BETA AND OTHERS TOO\n\n      window.clearTimeout(timeoutID)\n      \n      this.onUpdateBoxState({\n        ...evalState,\n        isRunning : false,\n        breakpoints,\n        timeoutID : undefined,\n      })\n\n      return\n    }\n  \n    ast = normal.perform()\n    // steps++\n\n    history[history.length - 1] = { ast, lastReduction, step : step + 1, message : '', isNormalForm }\n  \n    this.onUpdateBoxState({\n      ...evalState,\n      history,\n      // steps,\n      // lastReduction,\n      timeoutID : window.setTimeout(this.__onRun, timeout),\n    })\n  }\n\n  onStop () : void {\n    const { submittedExpressions, activeBox } = this.state\n    const evalState = submittedExpressions[activeBox] as EvaluationState\n    const { timeoutID } = evalState\n  \n    window.clearTimeout(timeoutID)\n  \n    this.onUpdateBoxState({\n      ...evalState,\n      isRunning : false,\n      timeoutID : undefined\n    })\n  }\n\n  shouldBreak (breakpoint : Breakpoint, reduction : ASTReduction) : boolean {\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Beta && breakpoint.context instanceof Lambda\n        && reduction.target.identifier === breakpoint.context.body.identifier\n      ) {\n        return true\n    }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Beta && breakpoint.context instanceof Variable\n        && reduction.redex.left instanceof Lambda\n        && reduction.redex.left.argument.identifier === breakpoint.context.identifier\n        // && ! breakpoint.broken.has(reduction.redex.left.argument)\n    ) {\n      return true\n    }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof ChurchNumeral\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n    if (reduction instanceof (breakpoint.type as any)\n        && reduction instanceof Expansion && breakpoint.context instanceof Macro\n        && reduction.target.identifier === breakpoint.context.identifier\n        && ! breakpoint.broken.has(reduction.target)\n    ) {\n      return true\n    }\n  \n    return false\n  }\n\n  onClear () : void {\n    const { submittedExpressions, activeBox } = this.state\n    \n    if (submittedExpressions[activeBox] === undefined) {\n      return\n    }\n\n    if (submittedExpressions[activeBox].type !== BoxType.expression) {\n      return\n    }\n\n    const evalState = submittedExpressions[activeBox] as EvaluationState\n\n    this.onUpdateBoxState({\n      ...evalState,\n      history : [ {\n        ast : evalState.ast.clone(),\n        lastReduction : None,\n        step : 0,\n        message : '',\n        isNormalForm : false\n      } ],\n      // steps : 0,\n      isRunning : false,\n      // lastReduction : null,\n      breakpoints : [],\n    })\n  }\n\n  // TODO: hope you refactored ^^ heavily\n  //\n\n  onEnter () : void {\n    const { editorState : { expression }, submittedExpressions, activeBox } = this.state\n    const activeExpression : BoxState = submittedExpressions[activeBox]\n\n    if (activeExpression !== undefined && (activeExpression as EvaluationState).isExercise) {\n      this.onExerciseStep()\n    }\n    else if (expression.length || activeExpression === undefined || activeExpression.type !== BoxType.expression) {\n      this.onSubmit()\n    }\n    else {\n      this.onStep()\n    }\n  }\n\n  onExerciseStep () {\n    const { editorState : { expression } } = this.state\n    try {\n      const userAst : AST = this.parseExpression(expression)\n\n      const { submittedExpressions, activeBox } = this.state\n      const evalState : EvaluationState = submittedExpressions[activeBox] as EvaluationState\n      let { history, strategy } = evalState\n      const stepRecord : StepRecord = history[history.length - 1]\n      const { isNormalForm, step } = stepRecord\n      let { ast, lastReduction } = stepRecord\n      ast = ast.clone()\n\n      if (isNormalForm) {\n        // TODO: do something about it\n        // say user - there are no more steps and it is in normal form\n        stepRecord.message = 'No more steps available. Expression is in normal form.'\n\n        this.setState({\n          ...this.state,\n          submittedExpressions,\n        })\n\n        return\n      }\n    \n      // TODO: take evaluation strategy from evalState\n      const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n      lastReduction = normal.nextReduction\n    \n      if (normal.nextReduction instanceof None) {\n        // TODO: refactor PLS - update history\n        // TODO: say user it is in normal form and they are mistaken\n        stepRecord.isNormalForm = true\n        stepRecord.message = 'Expression is already in normal form.'\n        submittedExpressions[activeBox] = {\n          ...evalState,\n          history,\n        }\n\n        this.setState({\n          ...this.state,\n          submittedExpressions,\n        })\n        \n        return\n      }\n    \n      ast = normal.perform()\n    \n      let message : string = ''\n      const comparator : TreeComparator = new TreeComparator([ userAst, ast ])\n      if (comparator.equals) {\n        ast = userAst\n        message = 'Correct.'\n      }\n      else {\n        // TODO: say user it was incorrect\n        // TODO: na to se pouzije uvnitr EvaluatorState prop messages nebo tak neco\n        console.log('Incorrect step')\n        message = `Incorrect step. ${expression}`\n      }\n\n      submittedExpressions[activeBox] = {\n        ...evalState,\n        history : [ ...history, { ast, lastReduction, step : step + 1, message, isNormalForm : false } ],\n      }\n\n      this.setState({\n        ...this.state,\n        editorState : {\n          ...this.state.editorState,\n          expression : '',\n          caretPosition : 0,\n          placeholder : PromptPlaceholder.VALIDATE_MODE,\n          syntaxError : null,\n        },\n        submittedExpressions,\n      })\n\n    } catch (exception) {\n      // TODO: print syntax error\n      // TODO: do it localy - no missuse of onSubmit\n\n      this.onSubmit()\n    }\n  }\n\n  onStep () : void {\n    const { submittedExpressions, activeBox } = this.state\n    const evalState : EvaluationState = submittedExpressions[activeBox] as EvaluationState\n    let { history, strategy } = evalState\n    const stepRecord = history[history.length - 1]\n    const { isNormalForm, step } = stepRecord\n    let { ast, lastReduction } = stepRecord\n    ast = ast.clone()\n  \n    if (isNormalForm) {\n      return\n    }\n\n    const normal : Evaluator = new (strategyToEvaluator(strategy) as any)(ast)\n    lastReduction = normal.nextReduction\n  \n    if (normal.nextReduction instanceof None) {\n      stepRecord.isNormalForm = true\n      stepRecord.message = 'Expression is in normal form.'\n      submittedExpressions[activeBox] = {\n        ...evalState,\n        history,\n      }\n\n      this.setState({\n        ...this.state,\n        submittedExpressions,\n      })\n      \n      return\n    }\n  \n    ast = normal.perform()\n  \n    submittedExpressions[activeBox] = {\n      ...evalState,\n      history : [ ...history, { ast, lastReduction, step : step + 1, message : '', isNormalForm : false } ],\n    }\n\n    this.setState({\n      ...this.state,\n      submittedExpressions,\n    })\n  }\n\n  // TODO: break-down to 3 or so methods\n  onSubmit () : void {\n    // TODO: maybe cancel and clear URL only after succsessful parsing\n    this.cancelUpdate()\n    \n    const { editorState : { expression, caretPosition, },\n    submittedExpressions, macroTable, activeBox } : AppState = this.state\n    \n    // window.location.hash = encodeURI(expression)\n    history.pushState({}, \"\", \"#\" + encodeURI(expression))\n\n    //\n    // TODO: here decide if it is macro\n    // note\n    // expression to evaluate\n    // macro contains := and name must be valid expression - later i will implement own parsing endpoint in core\n    // note starts with # and can contains anything whatever user wants\n    // expression is already implemented and working\n    //\n\n    if (isMacroDefinition(expression)) {\n      history.pushState({}, \"\", \"#\" + encodeURI(''))\n\n      const [macroName, macroExpression] : Array<string> = expression.split(':=').map(trimStr)\n\n      const macroState : MacroDefinitionState = {\n        type : BoxType.macro,\n        __key : Date.now().toString(),\n        macroName,\n        macroExpression,\n      }\n\n      const newMacroTable : MacroMap = {\n        ...macroTable,\n        [macroName] : macroExpression\n      }\n\n      this.setState({\n        ...this.state,\n        editorState : {\n          placeholder : this.state.editorState.placeholder,\n          expression : '',\n          caretPosition : 0,\n          syntaxError : null,\n          strategy : this.state.editorState.strategy,\n        },\n        submittedExpressions : [ ...submittedExpressions, macroState ],\n        macroTable : newMacroTable,\n        activeBox : submittedExpressions.length,\n      })\n\n      this.updateMacros(newMacroTable)\n    }\n\n    else if (isNote(expression)) {\n      history.pushState({}, \"\", \"#\" + encodeURI(''))\n\n      const noteState : NoteState = {\n        type : BoxType.note,\n        __key : Date.now().toString(),\n        note : expression.substring(1)\n      }\n\n      this.setState({\n        ...this.state,\n        editorState : {\n          placeholder : this.state.editorState.placeholder,\n          expression : '',\n          caretPosition : 0,\n          syntaxError : null,\n          strategy : this.state.editorState.strategy,\n        },\n        submittedExpressions : [ ...submittedExpressions, noteState ],\n        activeBox : submittedExpressions.length,\n      })\n    }\n\n    else {\n      try {\n        const ast : AST = this.parseExpression(expression)\n        // window.location.hash = encodeURI('')\n        history.pushState({}, \"\", \"#\" + encodeURI(''))\n  \n        const evaluationState : EvaluationState = {\n          type : BoxType.expression,\n          __key : Date.now().toString(),\n          expression,\n          ast,\n          history : [ { ast : ast.clone(), lastReduction : None, step : 0, message : '', isNormalForm : false } ],\n          // isStepping : false,\n          isRunning : false,\n          breakpoints : [],\n          timeoutID : undefined,\n          timeout : 10,\n          isExercise : false,\n          strategy : this.state.editorState.strategy,\n\n        }\n  \n        this.setState({\n          ...this.state,\n          editorState : {\n            placeholder : PromptPlaceholder.EVAL_MODE,\n            expression : '',\n            caretPosition : 0,\n            syntaxError : null,\n            strategy : this.state.editorState.strategy,\n          },\n          submittedExpressions : [ ...submittedExpressions, evaluationState ],\n          activeBox : submittedExpressions.length,\n        })\n    \n      } catch (exception) {\n        this.updateURL(expression)\n        console.log(exception)\n        \n        this.setState({\n          ...this.state,\n          editorState : {\n            placeholder : this.state.editorState.placeholder,\n            expression,\n            caretPosition,\n            syntaxError : exception,\n            strategy : this.state.editorState.strategy\n          }\n        })\n      }\n    }\n  }\n\n  updateFromURL () : void {\n    const { editorState : { expression : currentExpr } } : AppState = this.state\n    const expression : string = getExpressionFromURL()\n\n    if (currentExpr === expression) {\n      // breaking cyclic update\n      console.log('ALREADY SYNCED')\n      return\n    }\n\n    this.setState({\n      ...this.state,\n      editorState : {\n        placeholder : this.state.editorState.placeholder,\n        expression,\n        caretPosition : expression.length,\n        syntaxError : null,\n        strategy : this.state.editorState.strategy,\n      }\n    })\n  }\n\n  // THROWS Exceptions\n  parseExpression (expression : string) : AST {\n    const { singleLetterVars, macroTable } : AppState = this.state\n    \n    const tokens : Array<Token> = tokenize(expression, { lambdaLetters : ['λ'], singleLetterVars })\n    const ast : AST = parse(tokens, macroTable)\n\n    return ast\n  }\n\n  onRemoveMacro (name : string) : void {\n    const { macroTable } = this.state\n    \n    const newMacroTable = { ...macroTable }\n    delete newMacroTable[name]\n\n    this.setState({\n      ...this.state,\n      macroTable : newMacroTable\n    })\n\n    this.updateMacros(newMacroTable)\n  }\n\n  updateMacros (macroTable : MacroMap) : void {\n    window.localStorage.setItem('macrotable', JSON.stringify(macroTable))\n  }\n}","import { AST, Lambda, Application, Macro, ChurchNumeral, Variable } from \"lambdulus-core\";\n\n///////////////////////////////////////////////////////////////////////////////////////\n\ntype Pair<T> = [T, T]\ntype Triple<T> = [T, T, T]\n\n\n// TODO: fix the public equals interface, maybe public get and private set?\n// maybe implement public get method and bool itself leave private?\n//\n// first I need more trees, I need the previous AST\nexport class TreeComparator {\n  private translator : Map<string, string> = new Map\n  public equals : boolean = true\n  private context : Pair<AST>\n\n  constructor (readonly roots : Pair<AST> ) {\n    [ ...this.context ] = roots\n    // TODO: I need to compare roots first\n    this.compare()\n  }\n\n  compare () : void {\n    /**\n    TODO: compare need to compare both children if got\n    if one of them is incorrect\n    then solve that problem\n    if both of them is incorrect\n    then solve both problems and then decide how both come together\n\n    then I have an instance of knowledge system\n    I can fire up that system in this context (this node with invalid children)\n    system will need to get instance of something to call methods on\n    because system needs to ask questions - like, is this possible,\n    is this error applicable?\n    so instead of human, code will look up the AST and answer the questions\n    so it will be some kind of class which is able to observe all 3 ASTs at the same time\n    it will also have implemented query methods,\n    probably wont be many of them, just few\n    **/\n    \n    const [ left, right ] : Pair<AST> = this.context\n\n    if (left instanceof Lambda && right instanceof Lambda) {\n      const backup : Map<string, string> = new Map(this.translator.entries())\n\n      this.translator.set(left.argument.name(), right.argument.name())\n      this.context = [ left.right, right.right ]\n      this.compare()\n\n      this.translator = backup\n    }\n    else if (left instanceof Application && right instanceof Application) {\n      this.context = [ left.left, right.left ]\n      this.compare()\n\n      if ( ! this.equals) {\n        return\n      }\n\n      this.context = [ left.right, right.right ]\n      this.compare()\n    }\n    else if (left instanceof Macro && right instanceof Macro) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof ChurchNumeral && right instanceof ChurchNumeral) {\n      this.equals = left.name() === right.name()\n    }\n    else if (left instanceof Variable && right instanceof Variable) {\n      this.equals = this.translator.get(left.name()) === right.name()\n    }\n    else {\n      this.equals = false\n    }\n  }\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}